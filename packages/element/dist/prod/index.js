var Sc=Object.create;var ks=Object.defineProperty;var Mc=Object.getOwnPropertyDescriptor;var Ac=Object.getOwnPropertyNames;var Tc=Object.getPrototypeOf,vc=Object.prototype.hasOwnProperty;var Dc=(e,t)=>()=>(e&&(t=e(e=0)),t);var Lc=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Bc=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ac(t))!vc.call(e,o)&&o!==n&&ks(e,o,{get:()=>t[o],enumerable:!(i=Mc(t,o))||i.enumerable});return e};var Cc=(e,t,n)=>(n=e!=null?Sc(Tc(e)):{},Bc(t||!e||!e.__esModule?ks(n,"default",{value:e,enumerable:!0}):n,e));var v,P=Dc(()=>{v={PROD:!0}});var Od=Lc((Y1,Gd)=>{P();var Cd="Expected a function",Ld=NaN,Zf="[object Symbol]",qf=/^\s+|\s+$/g,Kf=/^[-+]0x[0-9a-f]+$/i,Qf=/^0b[01]+$/i,Jf=/^0o[0-7]+$/i,eh=parseInt,th=typeof global=="object"&&global&&global.Object===Object&&global,nh=typeof self=="object"&&self&&self.Object===Object&&self,ih=th||nh||Function("return this")(),oh=Object.prototype,rh=oh.toString,sh=Math.max,ah=Math.min,hs=function(){return ih.Date.now()};function lh(e,t,n){var i,o,r,s,a,l,d=0,c=!1,u=!1,m=!0;if(typeof e!="function")throw new TypeError(Cd);t=Bd(t)||0,ko(n)&&(c=!!n.leading,u="maxWait"in n,r=u?sh(Bd(n.maxWait)||0,t):r,m="trailing"in n?!!n.trailing:m);function p(I){var S=i,A=o;return i=o=void 0,d=I,s=e.apply(A,S),s}function f(I){return d=I,a=setTimeout(g,t),c?p(I):s}function E(I){var S=I-l,A=I-d,M=t-S;return u?ah(M,r-A):M}function h(I){var S=I-l,A=I-d;return l===void 0||S>=t||S<0||u&&A>=r}function g(){var I=hs();if(h(I))return x(I);a=setTimeout(g,E(I))}function x(I){return a=void 0,m&&i?p(I):(i=o=void 0,s)}function w(){a!==void 0&&clearTimeout(a),d=0,i=l=o=a=void 0}function b(){return a===void 0?s:x(hs())}function y(){var I=hs(),S=h(I);if(i=arguments,o=this,l=I,S){if(a===void 0)return f(l);if(u)return a=setTimeout(g,t),p(l)}return a===void 0&&(a=setTimeout(g,t)),s}return y.cancel=w,y.flush=b,y}function dh(e,t,n){var i=!0,o=!0;if(typeof e!="function")throw new TypeError(Cd);return ko(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),lh(e,t,{leading:i,maxWait:t,trailing:o})}function ko(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function ch(e){return!!e&&typeof e=="object"}function uh(e){return typeof e=="symbol"||ch(e)&&rh.call(e)==Zf}function Bd(e){if(typeof e=="number")return e;if(uh(e))return Ld;if(ko(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ko(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(qf,"");var n=Qf.test(e);return n||Jf.test(e)?eh(e.slice(2),n?2:8):Kf.test(e)?Ld:+e}Gd.exports=dh});P();import{toIterable as IE}from"@excalidraw/common";P();import{SHIFT_LOCKING_ANGLE as Ft,viewportCoordsToSceneCoords as Bo}from"@excalidraw/common";import{normalizeRadians as ud,radiansBetweenAngles as Sf,radiansDifference as Mf}from"@excalidraw/math";import{pointsEqual as Af}from"@excalidraw/math";P();P();P();P();P();P();P();P();P();function $o(e,t,n){if(e&&e.length){let[i,o]=t,r=Math.PI/180*n,s=Math.cos(r),a=Math.sin(r);for(let l of e){let[d,c]=l;l[0]=(d-i)*s-(c-o)*a+i,l[1]=(d-i)*a+(c-o)*s+o}}}function Oc(e,t,n){let i=[];e.forEach(o=>i.push(...o)),$o(i,t,n)}function kc(e,t){return e[0]===t[0]&&e[1]===t[1]}function Rs(e,t,n,i=1){let o=n,r=Math.max(t,.1),s=e[0]&&e[0][0]&&typeof e[0][0]=="number"?[e]:e,a=[0,0];if(o)for(let d of s)$o(d,a,o);let l=Rc(s,r,i);if(o){for(let d of s)$o(d,a,-o);Oc(l,a,-o)}return l}function Rc(e,t,n){let i=[];for(let d of e){let c=[...d];kc(c[0],c[c.length-1])||c.push([c[0][0],c[0][1]]),c.length>2&&i.push(c)}let o=[];t=Math.max(t,.1);let r=[];for(let d of i)for(let c=0;c<d.length-1;c++){let u=d[c],m=d[c+1];if(u[1]!==m[1]){let p=Math.min(u[1],m[1]);r.push({ymin:p,ymax:Math.max(u[1],m[1]),x:p===u[1]?u[0]:m[0],islope:(m[0]-u[0])/(m[1]-u[1])})}}if(r.sort((d,c)=>d.ymin<c.ymin?-1:d.ymin>c.ymin?1:d.x<c.x?-1:d.x>c.x?1:d.ymax===c.ymax?0:(d.ymax-c.ymax)/Math.abs(d.ymax-c.ymax)),!r.length)return o;let s=[],a=r[0].ymin,l=0;for(;s.length||r.length;){if(r.length){let d=-1;for(let u=0;u<r.length&&!(r[u].ymin>a);u++)d=u;r.splice(0,d+1).forEach(u=>{s.push({s:a,edge:u})})}if(s=s.filter(d=>!(d.edge.ymax<=a)),s.sort((d,c)=>d.edge.x===c.edge.x?0:(d.edge.x-c.edge.x)/Math.abs(d.edge.x-c.edge.x)),(n!==1||l%t===0)&&s.length>1)for(let d=0;d<s.length;d=d+2){let c=d+1;if(c>=s.length)break;let u=s[d].edge,m=s[c].edge;o.push([[Math.round(u.x),a],[Math.round(m.x),a]])}a+=n,s.forEach(d=>{d.edge.x=d.edge.x+n*d.edge.islope}),l++}return o}function at(e,t){var n;let i=t.hachureAngle+90,o=t.hachureGap;o<0&&(o=t.strokeWidth*4),o=Math.max(o,.1);let r=1;return t.roughness>=1&&(((n=t.randomizer)===null||n===void 0?void 0:n.next())||Math.random())>.7&&(r=o),Rs(e,o,i,r||1)}var _t=class{constructor(t){this.helper=t}fillPolygons(t,n){return this._fillPolygons(t,n)}_fillPolygons(t,n){let i=at(t,n);return{type:"fillSketch",ops:this.renderLines(i,n)}}renderLines(t,n){let i=[];for(let o of t)i.push(...this.helper.doubleLineOps(o[0][0],o[0][1],o[1][0],o[1][1],n));return i}};P();P();function Ut(e){let t=e[0],n=e[1];return Math.sqrt(Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2))}var Ti=class extends _t{fillPolygons(t,n){let i=n.hachureGap;i<0&&(i=n.strokeWidth*4),i=Math.max(i,.1);let o=Object.assign({},n,{hachureGap:i}),r=at(t,o),s=Math.PI/180*n.hachureAngle,a=[],l=i*.5*Math.cos(s),d=i*.5*Math.sin(s);for(let[u,m]of r)Ut([u,m])&&a.push([[u[0]-l,u[1]+d],[...m]],[[u[0]+l,u[1]-d],[...m]]);return{type:"fillSketch",ops:this.renderLines(a,n)}}};P();var vi=class extends _t{fillPolygons(t,n){let i=this._fillPolygons(t,n),o=Object.assign({},n,{hachureAngle:n.hachureAngle+90}),r=this._fillPolygons(t,o);return i.ops=i.ops.concat(r.ops),i}};P();var Di=class{constructor(t){this.helper=t}fillPolygons(t,n){n=Object.assign({},n,{hachureAngle:0});let i=at(t,n);return this.dotsOnLines(i,n)}dotsOnLines(t,n){let i=[],o=n.hachureGap;o<0&&(o=n.strokeWidth*4),o=Math.max(o,.1);let r=n.fillWeight;r<0&&(r=n.strokeWidth/2);let s=o/4;for(let a of t){let l=Ut(a),d=l/o,c=Math.ceil(d)-1,u=l-c*o,m=(a[0][0]+a[1][0])/2-o/4,p=Math.min(a[0][1],a[1][1]);for(let f=0;f<c;f++){let E=p+u+f*o,h=m-s+Math.random()*2*s,g=E-s+Math.random()*2*s,x=this.helper.ellipse(h,g,r,r,n);i.push(...x.ops)}}return{type:"fillSketch",ops:i}}};P();var Li=class{constructor(t){this.helper=t}fillPolygons(t,n){let i=at(t,n);return{type:"fillSketch",ops:this.dashedLine(i,n)}}dashedLine(t,n){let i=n.dashOffset<0?n.hachureGap<0?n.strokeWidth*4:n.hachureGap:n.dashOffset,o=n.dashGap<0?n.hachureGap<0?n.strokeWidth*4:n.hachureGap:n.dashGap,r=[];return t.forEach(s=>{let a=Ut(s),l=Math.floor(a/(i+o)),d=(a+o-l*(i+o))/2,c=s[0],u=s[1];c[0]>u[0]&&(c=s[1],u=s[0]);let m=Math.atan((u[1]-c[1])/(u[0]-c[0]));for(let p=0;p<l;p++){let f=p*(i+o),E=f+i,h=[c[0]+f*Math.cos(m)+d*Math.cos(m),c[1]+f*Math.sin(m)+d*Math.sin(m)],g=[c[0]+E*Math.cos(m)+d*Math.cos(m),c[1]+E*Math.sin(m)+d*Math.sin(m)];r.push(...this.helper.doubleLineOps(h[0],h[1],g[0],g[1],n))}}),r}};P();var Bi=class{constructor(t){this.helper=t}fillPolygons(t,n){let i=n.hachureGap<0?n.strokeWidth*4:n.hachureGap,o=n.zigzagOffset<0?i:n.zigzagOffset;n=Object.assign({},n,{hachureGap:i+o});let r=at(t,n);return{type:"fillSketch",ops:this.zigzagLines(r,o,n)}}zigzagLines(t,n,i){let o=[];return t.forEach(r=>{let s=Ut(r),a=Math.round(s/(2*n)),l=r[0],d=r[1];l[0]>d[0]&&(l=r[1],d=r[0]);let c=Math.atan((d[1]-l[1])/(d[0]-l[0]));for(let u=0;u<a;u++){let m=u*2*n,p=(u+1)*2*n,f=Math.sqrt(2*Math.pow(n,2)),E=[l[0]+m*Math.cos(c),l[1]+m*Math.sin(c)],h=[l[0]+p*Math.cos(c),l[1]+p*Math.sin(c)],g=[E[0]+f*Math.cos(c+Math.PI/4),E[1]+f*Math.sin(c+Math.PI/4)];o.push(...this.helper.doubleLineOps(E[0],E[1],g[0],g[1],i),...this.helper.doubleLineOps(g[0],g[1],h[0],h[1],i))}}),o}};var De={};function Fs(e,t){let n=e.fillStyle||"hachure";if(!De[n])switch(n){case"zigzag":De[n]||(De[n]=new Ti(t));break;case"cross-hatch":De[n]||(De[n]=new vi(t));break;case"dots":De[n]||(De[n]=new Di(t));break;case"dashed":De[n]||(De[n]=new Li(t));break;case"zigzag-line":De[n]||(De[n]=new Bi(t));break;case"hachure":default:n="hachure",De[n]||(De[n]=new _t(t));break}return De[n]}P();function Ns(){return Math.floor(Math.random()*2**31)}var Ci=class{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}};P();P();var Gi={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function Fc(e){let t=new Array;for(;e!=="";)if(e.match(/^([ \t\r\n,]+)/))e=e.substr(RegExp.$1.length);else if(e.match(/^([aAcChHlLmMqQsStTvVzZ])/))t[t.length]={type:0,text:RegExp.$1},e=e.substr(RegExp.$1.length);else if(e.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))t[t.length]={type:1,text:`${parseFloat(RegExp.$1)}`},e=e.substr(RegExp.$1.length);else return[];return t[t.length]={type:2,text:""},t}function Zo(e,t){return e.type===t}function Mn(e){let t=[],n=Fc(e),i="BOD",o=0,r=n[o];for(;!Zo(r,2);){let s=0,a=[];if(i==="BOD")if(r.text==="M"||r.text==="m")o++,s=Gi[r.text],i=r.text;else return Mn("M0,0"+e);else Zo(r,1)?s=Gi[i]:(o++,s=Gi[r.text],i=r.text);if(o+s<n.length){for(let l=o;l<o+s;l++){let d=n[l];if(Zo(d,1))a[a.length]=+d.text;else throw new Error("Param not a number: "+i+","+d.text)}if(typeof Gi[i]=="number"){let l={key:i,data:a};t.push(l),o+=s,r=n[o],i==="M"&&(i="L"),i==="m"&&(i="l")}else throw new Error("Bad segment: "+i)}else throw new Error("Path data ended short")}return t}P();function jn(e){let t=0,n=0,i=0,o=0,r=[];for(let{key:s,data:a}of e)switch(s){case"M":r.push({key:"M",data:[...a]}),[t,n]=a,[i,o]=a;break;case"m":t+=a[0],n+=a[1],r.push({key:"M",data:[t,n]}),i=t,o=n;break;case"L":r.push({key:"L",data:[...a]}),[t,n]=a;break;case"l":t+=a[0],n+=a[1],r.push({key:"L",data:[t,n]});break;case"C":r.push({key:"C",data:[...a]}),t=a[4],n=a[5];break;case"c":{let l=a.map((d,c)=>c%2?d+n:d+t);r.push({key:"C",data:l}),t=l[4],n=l[5];break}case"Q":r.push({key:"Q",data:[...a]}),t=a[2],n=a[3];break;case"q":{let l=a.map((d,c)=>c%2?d+n:d+t);r.push({key:"Q",data:l}),t=l[2],n=l[3];break}case"A":r.push({key:"A",data:[...a]}),t=a[5],n=a[6];break;case"a":t+=a[5],n+=a[6],r.push({key:"A",data:[a[0],a[1],a[2],a[3],a[4],t,n]});break;case"H":r.push({key:"H",data:[...a]}),t=a[0];break;case"h":t+=a[0],r.push({key:"H",data:[t]});break;case"V":r.push({key:"V",data:[...a]}),n=a[0];break;case"v":n+=a[0],r.push({key:"V",data:[n]});break;case"S":r.push({key:"S",data:[...a]}),t=a[2],n=a[3];break;case"s":{let l=a.map((d,c)=>c%2?d+n:d+t);r.push({key:"S",data:l}),t=l[2],n=l[3];break}case"T":r.push({key:"T",data:[...a]}),t=a[0],n=a[1];break;case"t":t+=a[0],n+=a[1],r.push({key:"T",data:[t,n]});break;case"Z":case"z":r.push({key:"Z",data:[]}),t=i,n=o;break}return r}P();function Vn(e){let t=[],n="",i=0,o=0,r=0,s=0,a=0,l=0;for(let{key:d,data:c}of e){switch(d){case"M":t.push({key:"M",data:[...c]}),[i,o]=c,[r,s]=c;break;case"C":t.push({key:"C",data:[...c]}),i=c[4],o=c[5],a=c[2],l=c[3];break;case"L":t.push({key:"L",data:[...c]}),[i,o]=c;break;case"H":i=c[0],t.push({key:"L",data:[i,o]});break;case"V":o=c[0],t.push({key:"L",data:[i,o]});break;case"S":{let u=0,m=0;n==="C"||n==="S"?(u=i+(i-a),m=o+(o-l)):(u=i,m=o),t.push({key:"C",data:[u,m,...c]}),a=c[0],l=c[1],i=c[2],o=c[3];break}case"T":{let[u,m]=c,p=0,f=0;n==="Q"||n==="T"?(p=i+(i-a),f=o+(o-l)):(p=i,f=o);let E=i+2*(p-i)/3,h=o+2*(f-o)/3,g=u+2*(p-u)/3,x=m+2*(f-m)/3;t.push({key:"C",data:[E,h,g,x,u,m]}),a=p,l=f,i=u,o=m;break}case"Q":{let[u,m,p,f]=c,E=i+2*(u-i)/3,h=o+2*(m-o)/3,g=p+2*(u-p)/3,x=f+2*(m-f)/3;t.push({key:"C",data:[E,h,g,x,p,f]}),a=u,l=m,i=p,o=f;break}case"A":{let u=Math.abs(c[0]),m=Math.abs(c[1]),p=c[2],f=c[3],E=c[4],h=c[5],g=c[6];u===0||m===0?(t.push({key:"C",data:[i,o,h,g,h,g]}),i=h,o=g):(i!==h||o!==g)&&(Hs(i,o,h,g,u,m,p,f,E).forEach(function(w){t.push({key:"C",data:w})}),i=h,o=g);break}case"Z":t.push({key:"Z",data:[]}),i=r,o=s;break}n=d}return t}function Nc(e){return Math.PI*e/180}function Wn(e,t,n){let i=e*Math.cos(n)-t*Math.sin(n),o=e*Math.sin(n)+t*Math.cos(n);return[i,o]}function Hs(e,t,n,i,o,r,s,a,l,d){let c=Nc(s),u=[],m=0,p=0,f=0,E=0;if(d)[m,p,f,E]=d;else{[e,t]=Wn(e,t,-c),[n,i]=Wn(n,i,-c);let G=(e-n)/2,B=(t-i)/2,U=G*G/(o*o)+B*B/(r*r);U>1&&(U=Math.sqrt(U),o=U*o,r=U*r);let N=a===l?-1:1,Y=o*o,F=r*r,T=Y*F-Y*B*B-F*G*G,$=Y*B*B+F*G*G,Z=N*Math.sqrt(Math.abs(T/$));f=Z*o*B/r+(e+n)/2,E=Z*-r*G/o+(t+i)/2,m=Math.asin(parseFloat(((t-E)/r).toFixed(9))),p=Math.asin(parseFloat(((i-E)/r).toFixed(9))),e<f&&(m=Math.PI-m),n<f&&(p=Math.PI-p),m<0&&(m=Math.PI*2+m),p<0&&(p=Math.PI*2+p),l&&m>p&&(m=m-Math.PI*2),!l&&p>m&&(p=p-Math.PI*2)}let h=p-m;if(Math.abs(h)>Math.PI*120/180){let G=p,B=n,U=i;l&&p>m?p=m+Math.PI*120/180*1:p=m+Math.PI*120/180*-1,n=f+o*Math.cos(p),i=E+r*Math.sin(p),u=Hs(n,i,B,U,o,r,s,0,l,[p,G,f,E])}h=p-m;let g=Math.cos(m),x=Math.sin(m),w=Math.cos(p),b=Math.sin(p),y=Math.tan(h/4),I=4/3*o*y,S=4/3*r*y,A=[e,t],M=[e+I*x,t-S*g],O=[n+I*b,i-S*w],L=[n,i];if(M[0]=2*A[0]-M[0],M[1]=2*A[1]-M[1],d)return[M,O,L].concat(u);{u=[M,O,L].concat(u);let G=[];for(let B=0;B<u.length;B+=3){let U=Wn(u[B][0],u[B][1],c),N=Wn(u[B+1][0],u[B+1][1],c),Y=Wn(u[B+2][0],u[B+2][1],c);G.push([U[0],U[1],N[0],N[1],Y[0],Y[1]])}return G}}var Hc={randOffset:Uc,randOffsetWithRange:Yc,ellipse:_c,doubleLineOps:Xc};function qo(e,t,n,i,o){return{type:"path",ops:gt(e,t,n,i,o)}}function $n(e,t,n){let i=(e||[]).length;if(i>2){let o=[];for(let r=0;r<i-1;r++)o.push(...gt(e[r][0],e[r][1],e[r+1][0],e[r+1][1],n));return t&&o.push(...gt(e[i-1][0],e[i-1][1],e[0][0],e[0][1],n)),{type:"path",ops:o}}else if(i===2)return qo(e[0][0],e[0][1],e[1][0],e[1][1],n);return{type:"path",ops:[]}}function zc(e,t){return $n(e,!0,t)}function Xs(e,t,n,i,o){let r=[[e,t],[e+n,t],[e+n,t+i],[e,t+i]];return zc(r,o)}function Ko(e,t){let n=_s(e,1*(1+t.roughness*.2),t);if(!t.disableMultiStroke){let i=_s(e,1.5*(1+t.roughness*.22),jc(t));n=n.concat(i)}return{type:"path",ops:n}}function _c(e,t,n,i,o){let r=Qo(n,i,o);return Ri(e,t,o,r).opset}function Qo(e,t,n){let i=Math.sqrt(Math.PI*2*Math.sqrt((Math.pow(e/2,2)+Math.pow(t/2,2))/2)),o=Math.ceil(Math.max(n.curveStepCount,n.curveStepCount/Math.sqrt(200)*i)),r=Math.PI*2/o,s=Math.abs(e/2),a=Math.abs(t/2),l=1-n.curveFitting;return s+=k(s*l,n),a+=k(a*l,n),{increment:r,rx:s,ry:a}}function Ri(e,t,n,i){let[o,r]=Us(i.increment,e,t,i.rx,i.ry,1,i.increment*Oi(.1,Oi(.4,1,n),n),n),s=ki(o,null,n);if(!n.disableMultiStroke&&n.roughness!==0){let[a]=Us(i.increment,e,t,i.rx,i.ry,1.5,0,n),l=ki(a,null,n);s=s.concat(l)}return{estimatedPoints:r,opset:{type:"path",ops:s}}}function Jo(e,t,n,i,o,r,s,a,l){let d=e,c=t,u=Math.abs(n/2),m=Math.abs(i/2);u+=k(u*.01,l),m+=k(m*.01,l);let p=o,f=r;for(;p<0;)p+=Math.PI*2,f+=Math.PI*2;f-p>Math.PI*2&&(p=0,f=Math.PI*2);let E=Math.PI*2/l.curveStepCount,h=Math.min(E/2,(f-p)/2),g=Ys(h,d,c,u,m,p,f,1,l);if(!l.disableMultiStroke){let x=Ys(h,d,c,u,m,p,f,1.5,l);g.push(...x)}return s&&(a?g.push(...gt(d,c,d+u*Math.cos(p),c+m*Math.sin(p),l),...gt(d,c,d+u*Math.cos(f),c+m*Math.sin(f),l)):g.push({op:"lineTo",data:[d,c]},{op:"lineTo",data:[d+u*Math.cos(p),c+m*Math.sin(p)]})),{type:"path",ops:g}}function er(e,t){let n=Vn(jn(Mn(e))),i=[],o=[0,0],r=[0,0];for(let{key:s,data:a}of n)switch(s){case"M":{r=[a[0],a[1]],o=[a[0],a[1]];break}case"L":i.push(...gt(r[0],r[1],a[0],a[1],t)),r=[a[0],a[1]];break;case"C":{let[l,d,c,u,m,p]=a;i.push(...Wc(l,d,c,u,m,p,r,t)),r=[m,p];break}case"Z":i.push(...gt(r[0],r[1],o[0],o[1],t)),r=[o[0],o[1]];break}return{type:"path",ops:i}}function Fi(e,t){let n=[];for(let i of e)if(i.length){let o=t.maxRandomnessOffset||0,r=i.length;if(r>2){n.push({op:"move",data:[i[0][0]+k(o,t),i[0][1]+k(o,t)]});for(let s=1;s<r;s++)n.push({op:"lineTo",data:[i[s][0]+k(o,t),i[s][1]+k(o,t)]})}}return{type:"fillPath",ops:n}}function fn(e,t){return Fs(t,Hc).fillPolygons(e,t)}function js(e,t,n,i,o,r,s){let a=e,l=t,d=Math.abs(n/2),c=Math.abs(i/2);d+=k(d*.01,s),c+=k(c*.01,s);let u=o,m=r;for(;u<0;)u+=Math.PI*2,m+=Math.PI*2;m-u>Math.PI*2&&(u=0,m=Math.PI*2);let p=(m-u)/s.curveStepCount,f=[];for(let E=u;E<=m;E=E+p)f.push([a+d*Math.cos(E),l+c*Math.sin(E)]);return f.push([a+d*Math.cos(m),l+c*Math.sin(m)]),f.push([a,l]),fn([f],s)}function Uc(e,t){return k(e,t)}function Yc(e,t,n){return Oi(e,t,n)}function Xc(e,t,n,i,o){return gt(e,t,n,i,o,!0)}function jc(e){let t=Object.assign({},e);return t.randomizer=void 0,e.seed&&(t.seed=e.seed+1),t}function Ws(e){return e.randomizer||(e.randomizer=new Ci(e.seed||0)),e.randomizer.next()}function Oi(e,t,n,i=1){return n.roughness*i*(Ws(n)*(t-e)+e)}function k(e,t,n=1){return Oi(-e,e,t,n)}function gt(e,t,n,i,o,r=!1){let s=r?o.disableMultiStrokeFill:o.disableMultiStroke,a=zs(e,t,n,i,o,!0,!1);if(s)return a;let l=zs(e,t,n,i,o,!0,!0);return a.concat(l)}function zs(e,t,n,i,o,r,s){let a=Math.pow(e-n,2)+Math.pow(t-i,2),l=Math.sqrt(a),d=1;l<200?d=1:l>500?d=.4:d=-.0016668*l+1.233334;let c=o.maxRandomnessOffset||0;c*c*100>a&&(c=l/10);let u=c/2,m=.2+Ws(o)*.2,p=o.bowing*o.maxRandomnessOffset*(i-t)/200,f=o.bowing*o.maxRandomnessOffset*(e-n)/200;p=k(p,o,d),f=k(f,o,d);let E=[],h=()=>k(u,o,d),g=()=>k(c,o,d),x=o.preserveVertices;return r&&(s?E.push({op:"move",data:[e+(x?0:h()),t+(x?0:h())]}):E.push({op:"move",data:[e+(x?0:k(c,o,d)),t+(x?0:k(c,o,d))]})),s?E.push({op:"bcurveTo",data:[p+e+(n-e)*m+h(),f+t+(i-t)*m+h(),p+e+2*(n-e)*m+h(),f+t+2*(i-t)*m+h(),n+(x?0:h()),i+(x?0:h())]}):E.push({op:"bcurveTo",data:[p+e+(n-e)*m+g(),f+t+(i-t)*m+g(),p+e+2*(n-e)*m+g(),f+t+2*(i-t)*m+g(),n+(x?0:g()),i+(x?0:g())]}),E}function _s(e,t,n){let i=[];i.push([e[0][0]+k(t,n),e[0][1]+k(t,n)]),i.push([e[0][0]+k(t,n),e[0][1]+k(t,n)]);for(let o=1;o<e.length;o++)i.push([e[o][0]+k(t,n),e[o][1]+k(t,n)]),o===e.length-1&&i.push([e[o][0]+k(t,n),e[o][1]+k(t,n)]);return ki(i,null,n)}function ki(e,t,n){let i=e.length,o=[];if(i>3){let r=[],s=1-n.curveTightness;o.push({op:"move",data:[e[1][0],e[1][1]]});for(let a=1;a+2<i;a++){let l=e[a];r[0]=[l[0],l[1]],r[1]=[l[0]+(s*e[a+1][0]-s*e[a-1][0])/6,l[1]+(s*e[a+1][1]-s*e[a-1][1])/6],r[2]=[e[a+1][0]+(s*e[a][0]-s*e[a+2][0])/6,e[a+1][1]+(s*e[a][1]-s*e[a+2][1])/6],r[3]=[e[a+1][0],e[a+1][1]],o.push({op:"bcurveTo",data:[r[1][0],r[1][1],r[2][0],r[2][1],r[3][0],r[3][1]]})}if(t&&t.length===2){let a=n.maxRandomnessOffset;o.push({op:"lineTo",data:[t[0]+k(a,n),t[1]+k(a,n)]})}}else i===3?(o.push({op:"move",data:[e[1][0],e[1][1]]}),o.push({op:"bcurveTo",data:[e[1][0],e[1][1],e[2][0],e[2][1],e[2][0],e[2][1]]})):i===2&&o.push(...gt(e[0][0],e[0][1],e[1][0],e[1][1],n));return o}function Us(e,t,n,i,o,r,s,a){let l=a.roughness===0,d=[],c=[];if(l){e=e/4,c.push([t+i*Math.cos(-e),n+o*Math.sin(-e)]);for(let u=0;u<=Math.PI*2;u=u+e){let m=[t+i*Math.cos(u),n+o*Math.sin(u)];d.push(m),c.push(m)}c.push([t+i*Math.cos(0),n+o*Math.sin(0)]),c.push([t+i*Math.cos(e),n+o*Math.sin(e)])}else{let u=k(.5,a)-Math.PI/2;c.push([k(r,a)+t+.9*i*Math.cos(u-e),k(r,a)+n+.9*o*Math.sin(u-e)]);let m=Math.PI*2+u-.01;for(let p=u;p<m;p=p+e){let f=[k(r,a)+t+i*Math.cos(p),k(r,a)+n+o*Math.sin(p)];d.push(f),c.push(f)}c.push([k(r,a)+t+i*Math.cos(u+Math.PI*2+s*.5),k(r,a)+n+o*Math.sin(u+Math.PI*2+s*.5)]),c.push([k(r,a)+t+.98*i*Math.cos(u+s),k(r,a)+n+.98*o*Math.sin(u+s)]),c.push([k(r,a)+t+.9*i*Math.cos(u+s*.5),k(r,a)+n+.9*o*Math.sin(u+s*.5)])}return[c,d]}function Ys(e,t,n,i,o,r,s,a,l){let d=r+k(.1,l),c=[];c.push([k(a,l)+t+.9*i*Math.cos(d-e),k(a,l)+n+.9*o*Math.sin(d-e)]);for(let u=d;u<=s;u=u+e)c.push([k(a,l)+t+i*Math.cos(u),k(a,l)+n+o*Math.sin(u)]);return c.push([t+i*Math.cos(s),n+o*Math.sin(s)]),c.push([t+i*Math.cos(s),n+o*Math.sin(s)]),ki(c,null,l)}function Wc(e,t,n,i,o,r,s,a){let l=[],d=[a.maxRandomnessOffset||1,(a.maxRandomnessOffset||1)+.3],c=[0,0],u=a.disableMultiStroke?1:2,m=a.preserveVertices;for(let p=0;p<u;p++)p===0?l.push({op:"move",data:[s[0],s[1]]}):l.push({op:"move",data:[s[0]+(m?0:k(d[0],a)),s[1]+(m?0:k(d[0],a))]}),c=m?[o,r]:[o+k(d[p],a),r+k(d[p],a)],l.push({op:"bcurveTo",data:[e+k(d[p],a),t+k(d[p],a),n+k(d[p],a),i+k(d[p],a),c[0],c[1]]});return l}P();function Zn(e){return[...e]}function Vs(e,t=0){let n=e.length;if(n<3)throw new Error("A curve must have at least three points.");let i=[];if(n===3)i.push(Zn(e[0]),Zn(e[1]),Zn(e[2]),Zn(e[2]));else{let o=[];o.push(e[0],e[0]);for(let a=1;a<e.length;a++)o.push(e[a]),a===e.length-1&&o.push(e[a]);let r=[],s=1-t;i.push(Zn(o[0]));for(let a=1;a+2<o.length;a++){let l=o[a];r[0]=[l[0],l[1]],r[1]=[l[0]+(s*o[a+1][0]-s*o[a-1][0])/6,l[1]+(s*o[a+1][1]-s*o[a-1][1])/6],r[2]=[o[a+1][0]+(s*o[a][0]-s*o[a+2][0])/6,o[a+1][1]+(s*o[a][1]-s*o[a+2][1])/6],r[3]=[o[a+1][0],o[a+1][1]],i.push(r[1],r[2],r[3])}}return i}P();function Vc(e,t){return Math.sqrt(Ni(e,t))}function Ni(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}function $c(e,t,n){let i=Ni(t,n);if(i===0)return Ni(e,t);let o=((e[0]-t[0])*(n[0]-t[0])+(e[1]-t[1])*(n[1]-t[1]))/i;return o=Math.max(0,Math.min(1,o)),Ni(e,hn(t,n,o))}function hn(e,t,n){return[e[0]+(t[0]-e[0])*n,e[1]+(t[1]-e[1])*n]}function Zc(e,t){let n=e[t+0],i=e[t+1],o=e[t+2],r=e[t+3],s=3*i[0]-2*n[0]-r[0];s*=s;let a=3*i[1]-2*n[1]-r[1];a*=a;let l=3*o[0]-2*r[0]-n[0];l*=l;let d=3*o[1]-2*r[1]-n[1];return d*=d,s<l&&(s=l),a<d&&(a=d),s+a}function tr(e,t,n,i){let o=i||[];if(Zc(e,t)<n){let r=e[t+0];o.length?Vc(o[o.length-1],r)>1&&o.push(r):o.push(r),o.push(e[t+3])}else{let s=e[t+0],a=e[t+1],l=e[t+2],d=e[t+3],c=hn(s,a,.5),u=hn(a,l,.5),m=hn(l,d,.5),p=hn(c,u,.5),f=hn(u,m,.5),E=hn(p,f,.5);tr([s,c,p,E],0,n,o),tr([E,f,m,d],0,n,o)}return o}function qn(e,t){return Hi(e,0,e.length,t)}function Hi(e,t,n,i,o){let r=o||[],s=e[t],a=e[n-1],l=0,d=1;for(let c=t+1;c<n-1;++c){let u=$c(e[c],s,a);u>l&&(l=u,d=c)}return Math.sqrt(l)>i?(Hi(e,t,d+1,i,r),Hi(e,d,n,i,r)):(r.length||r.push(s),r.push(a)),r}function xt(e,t=.15,n){let i=[],o=(e.length-1)/3;for(let r=0;r<o;r++){let s=r*3;tr(e,s,t,i)}return n&&n>0?Hi(i,0,i.length,n):i}P();function $s(e,t,n){let i=Mn(e),o=Vn(jn(i)),r=[],s=[],a=[0,0],l=[],d=()=>{l.length>=4&&s.push(...xt(l,t)),l=[]},c=()=>{d(),s.length&&(r.push(s),s=[])};for(let{key:m,data:p}of o)switch(m){case"M":c(),a=[p[0],p[1]],s.push(a);break;case"L":d(),s.push([p[0],p[1]]);break;case"C":if(!l.length){let f=s.length?s[s.length-1]:a;l.push([f[0],f[1]])}l.push([p[0],p[1]]),l.push([p[2],p[3]]),l.push([p[4],p[5]]);break;case"Z":d(),s.push([a[0],a[1]]);break}if(c(),!n)return r;let u=[];for(let m of r){let p=qn(m,n);p.length&&u.push(p)}return u}var Ne="none",je=class{constructor(t){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1,fillShapeRoughnessGain:.8},this.config=t||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Ns()}_o(t){return t?Object.assign({},this.defaultOptions,t):this.defaultOptions}_d(t,n,i){return{shape:t,sets:n||[],options:i||this.defaultOptions}}line(t,n,i,o,r){let s=this._o(r);return this._d("line",[qo(t,n,i,o,s)],s)}rectangle(t,n,i,o,r){let s=this._o(r),a=[],l=Xs(t,n,i,o,s);if(s.fill){let d=[[t,n],[t+i,n],[t+i,n+o],[t,n+o]];s.fillStyle==="solid"?a.push(Fi([d],s)):a.push(fn([d],s))}return s.stroke!==Ne&&a.push(l),this._d("rectangle",a,s)}ellipse(t,n,i,o,r){let s=this._o(r),a=[],l=Qo(i,o,s),d=Ri(t,n,s,l);if(s.fill)if(s.fillStyle==="solid"){let c=Ri(t,n,s,l).opset;c.type="fillPath",a.push(c)}else a.push(fn([d.estimatedPoints],s));return s.stroke!==Ne&&a.push(d.opset),this._d("ellipse",a,s)}circle(t,n,i,o){let r=this.ellipse(t,n,i,i,o);return r.shape="circle",r}linearPath(t,n){let i=this._o(n);return this._d("linearPath",[$n(t,!1,i)],i)}arc(t,n,i,o,r,s,a=!1,l){let d=this._o(l),c=[],u=Jo(t,n,i,o,r,s,a,!0,d);if(a&&d.fill)if(d.fillStyle==="solid"){let m=Object.assign({},d);m.disableMultiStroke=!0;let p=Jo(t,n,i,o,r,s,!0,!1,m);p.type="fillPath",c.push(p)}else c.push(js(t,n,i,o,r,s,d));return d.stroke!==Ne&&c.push(u),this._d("arc",c,d)}curve(t,n){let i=this._o(n),o=[],r=Ko(t,i);if(i.fill&&i.fill!==Ne&&t.length>=3)if(i.fillStyle==="solid"){let s=Ko(t,Object.assign(Object.assign({},i),{disableMultiStroke:!0,roughness:i.roughness?i.roughness+i.fillShapeRoughnessGain:0}));o.push({type:"fillPath",ops:this._mergedShape(s.ops)})}else{let s=Vs(t),a=xt(s,10,(1+i.roughness)/2);o.push(fn([a],i))}return i.stroke!==Ne&&o.push(r),this._d("curve",o,i)}polygon(t,n){let i=this._o(n),o=[],r=$n(t,!0,i);return i.fill&&(i.fillStyle==="solid"?o.push(Fi([t],i)):o.push(fn([t],i))),i.stroke!==Ne&&o.push(r),this._d("polygon",o,i)}path(t,n){let i=this._o(n),o=[];if(!t)return this._d("path",o,i);t=(t||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");let r=i.fill&&i.fill!=="transparent"&&i.fill!==Ne,s=i.stroke!==Ne,a=!!(i.simplification&&i.simplification<1),l=a?4-4*(i.simplification||1):(1+i.roughness)/2,d=$s(t,1,l),c=er(t,i);if(r)if(i.fillStyle==="solid")if(d.length===1){let u=er(t,Object.assign(Object.assign({},i),{disableMultiStroke:!0,roughness:i.roughness?i.roughness+i.fillShapeRoughnessGain:0}));o.push({type:"fillPath",ops:this._mergedShape(u.ops)})}else o.push(Fi(d,i));else o.push(fn(d,i));return s&&(a?d.forEach(u=>{o.push($n(u,!1,i))}):o.push(c)),this._d("path",o,i)}opsToPath(t,n){let i="";for(let o of t.ops){let r=typeof n=="number"&&n>=0?o.data.map(s=>+s.toFixed(n)):o.data;switch(o.op){case"move":i+=`M${r[0]} ${r[1]} `;break;case"bcurveTo":i+=`C${r[0]} ${r[1]}, ${r[2]} ${r[3]}, ${r[4]} ${r[5]} `;break;case"lineTo":i+=`L${r[0]} ${r[1]} `;break}}return i.trim()}toPaths(t){let n=t.sets||[],i=t.options||this.defaultOptions,o=[];for(let r of n){let s=null;switch(r.type){case"path":s={d:this.opsToPath(r),stroke:i.stroke,strokeWidth:i.strokeWidth,fill:Ne};break;case"fillPath":s={d:this.opsToPath(r),stroke:Ne,strokeWidth:0,fill:i.fill||Ne};break;case"fillSketch":s=this.fillSketch(r,i);break}s&&o.push(s)}return o}fillSketch(t,n){let i=n.fillWeight;return i<0&&(i=n.strokeWidth/2),{d:this.opsToPath(t),stroke:n.fill||Ne,strokeWidth:i,fill:Ne}}_mergedShape(t){return t.filter((n,i)=>i===0?!0:n.op!=="move")}};var zi=class{constructor(t,n){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.gen=new je(n)}draw(t){let n=t.sets||[],i=t.options||this.getDefaultOptions(),o=this.ctx,r=t.options.fixedDecimalPlaceDigits;for(let s of n)switch(s.type){case"path":o.save(),o.strokeStyle=i.stroke==="none"?"transparent":i.stroke,o.lineWidth=i.strokeWidth,i.strokeLineDash&&o.setLineDash(i.strokeLineDash),i.strokeLineDashOffset&&(o.lineDashOffset=i.strokeLineDashOffset),this._drawToContext(o,s,r),o.restore();break;case"fillPath":{o.save(),o.fillStyle=i.fill||"";let a=t.shape==="curve"||t.shape==="polygon"||t.shape==="path"?"evenodd":"nonzero";this._drawToContext(o,s,r,a),o.restore();break}case"fillSketch":this.fillSketch(o,s,i);break}}fillSketch(t,n,i){let o=i.fillWeight;o<0&&(o=i.strokeWidth/2),t.save(),i.fillLineDash&&t.setLineDash(i.fillLineDash),i.fillLineDashOffset&&(t.lineDashOffset=i.fillLineDashOffset),t.strokeStyle=i.fill||"",t.lineWidth=o,this._drawToContext(t,n,i.fixedDecimalPlaceDigits),t.restore()}_drawToContext(t,n,i,o="nonzero"){t.beginPath();for(let r of n.ops){let s=typeof i=="number"&&i>=0?r.data.map(a=>+a.toFixed(i)):r.data;switch(r.op){case"move":t.moveTo(s[0],s[1]);break;case"bcurveTo":t.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case"lineTo":t.lineTo(s[0],s[1]);break}}n.type==="fillPath"?t.fill(o):t.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(t,n,i,o,r){let s=this.gen.line(t,n,i,o,r);return this.draw(s),s}rectangle(t,n,i,o,r){let s=this.gen.rectangle(t,n,i,o,r);return this.draw(s),s}ellipse(t,n,i,o,r){let s=this.gen.ellipse(t,n,i,o,r);return this.draw(s),s}circle(t,n,i,o){let r=this.gen.circle(t,n,i,o);return this.draw(r),r}linearPath(t,n){let i=this.gen.linearPath(t,n);return this.draw(i),i}polygon(t,n){let i=this.gen.polygon(t,n);return this.draw(i),i}arc(t,n,i,o,r,s,a=!1,l){let d=this.gen.arc(t,n,i,o,r,s,a,l);return this.draw(d),d}curve(t,n){let i=this.gen.curve(t,n);return this.draw(i),i}path(t,n){let i=this.gen.path(t,n);return this.draw(i),i}};P();P();var Kn="http://www.w3.org/2000/svg";var _i=class{constructor(t,n){this.svg=t,this.gen=new je(n)}draw(t){let n=t.sets||[],i=t.options||this.getDefaultOptions(),o=this.svg.ownerDocument||window.document,r=o.createElementNS(Kn,"g"),s=t.options.fixedDecimalPlaceDigits;for(let a of n){let l=null;switch(a.type){case"path":{l=o.createElementNS(Kn,"path"),l.setAttribute("d",this.opsToPath(a,s)),l.setAttribute("stroke",i.stroke),l.setAttribute("stroke-width",i.strokeWidth+""),l.setAttribute("fill","none"),i.strokeLineDash&&l.setAttribute("stroke-dasharray",i.strokeLineDash.join(" ").trim()),i.strokeLineDashOffset&&l.setAttribute("stroke-dashoffset",`${i.strokeLineDashOffset}`);break}case"fillPath":{l=o.createElementNS(Kn,"path"),l.setAttribute("d",this.opsToPath(a,s)),l.setAttribute("stroke","none"),l.setAttribute("stroke-width","0"),l.setAttribute("fill",i.fill||""),(t.shape==="curve"||t.shape==="polygon")&&l.setAttribute("fill-rule","evenodd");break}case"fillSketch":{l=this.fillSketch(o,a,i);break}}l&&r.appendChild(l)}return r}fillSketch(t,n,i){let o=i.fillWeight;o<0&&(o=i.strokeWidth/2);let r=t.createElementNS(Kn,"path");return r.setAttribute("d",this.opsToPath(n,i.fixedDecimalPlaceDigits)),r.setAttribute("stroke",i.fill||""),r.setAttribute("stroke-width",o+""),r.setAttribute("fill","none"),i.fillLineDash&&r.setAttribute("stroke-dasharray",i.fillLineDash.join(" ").trim()),i.fillLineDashOffset&&r.setAttribute("stroke-dashoffset",`${i.fillLineDashOffset}`),r}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(t,n){return this.gen.opsToPath(t,n)}line(t,n,i,o,r){let s=this.gen.line(t,n,i,o,r);return this.draw(s)}rectangle(t,n,i,o,r){let s=this.gen.rectangle(t,n,i,o,r);return this.draw(s)}ellipse(t,n,i,o,r){let s=this.gen.ellipse(t,n,i,o,r);return this.draw(s)}circle(t,n,i,o){let r=this.gen.circle(t,n,i,o);return this.draw(r)}linearPath(t,n){let i=this.gen.linearPath(t,n);return this.draw(i)}polygon(t,n){let i=this.gen.polygon(t,n);return this.draw(i)}arc(t,n,i,o,r,s,a=!1,l){let d=this.gen.arc(t,n,i,o,r,s,a,l);return this.draw(d)}curve(t,n){let i=this.gen.curve(t,n);return this.draw(i)}path(t,n){let i=this.gen.path(t,n);return this.draw(i)}};var En={canvas(e,t){return new zi(e,t)},svg(e,t){return new _i(e,t)},generator(e){return new je(e)},newSeed(){return je.newSeed()}};import{arrayToMap as dd,invariant as ns,rescalePoints as od,sizeOf as hf}from"@excalidraw/common";import{degreesToRadians as ts,lineSegment as Ee,pointDistance as Ef,pointFrom as D,pointFromArray as cd,pointRotateRads as oe}from"@excalidraw/math";P();import{invariant as qc}from"@excalidraw/common";import{curve as Kc,lineSegment as Qc,pointFrom as re,pointDistance as ax,pointFromArray as Jc,pointFromVector as eu,pointRotateRads as Ke,polygon as Zs,polygonFromPoints as nr,PRECISION as lx,segmentsIntersectAt as dx,vector as tu,vectorAdd as nu,vectorFromPoint as iu,vectorScale as cx}from"@excalidraw/math";import{getElementAbsoluteCoords as mx}from"@excalidraw/element";var qs=e=>{let{angle:t,width:n,height:i,x:o,y:r}=e,s=o+n/2,a=r+i/2,l=re(s,a),d;return e.type==="diamond"?d=Zs(Ke(re(s,r),l,t),Ke(re(o+n,a),l,t),Ke(re(s,r+i),l,t),Ke(re(o,a),l,t)):d=Zs(Ke(re(o,r),l,t),Ke(re(o+n,r),l,t),Ke(re(o+n,r+i),l,t),Ke(re(o,r+i),l,t)),{type:"polygon",data:d}};var Ks=e=>{let{width:t,height:n,angle:i,x:o,y:r}=e;return{type:"ellipse",data:{center:re(o+t/2,r+n/2),angle:i,halfWidth:t/2,halfHeight:n/2}}},wt=e=>{if(!e)return[];for(let t of e.sets)if(t.type==="path")return t.ops;return e.sets[0].ops},Qs=(e,t=re(0,0),n,i)=>{let o=l=>Ke(re(l[0]+t[0],l[1]+t[1]),i,n),r=wt(e),s=[],a=re(0,0);for(let l of r){if(l.op==="move"){let d=Jc(l.data);qc(d!=null,"Ops data is not a point"),a=o(d)}if(l.op==="bcurveTo"){let d=o(re(l.data[0],l.data[1])),c=o(re(l.data[2],l.data[3])),u=o(re(l.data[4],l.data[5]));s.push(Kc(a,d,c,u)),a=u}}return{type:"polycurve",data:s}},ou=e=>{let t=e[0],n=[];for(let i=1;i<e.length;i++){let o=e[i];n.push(Qc(t,o)),t=o}return n},Js=(e,t,n=!1)=>{let i=r=>Ke(eu(nu(iu(r),tu(e.x,e.y))),t,e.angle),o=ou(e.points.map(r=>i(r)));return n?{type:"polygon",data:nr(o.flat())}:{type:"polyline",data:o}},ea=(e,t,n=re(0,0),i,o)=>{let r=c=>Ke(re(c[0]+n[0],c[1]+n[1]),o,i);if(e.roundness===null)return{type:"polygon",data:nr(e.points.map(c=>r(c)))};let s=wt(t),a=[],l=!1;for(let c of s)c.op==="move"?(l=!l,l&&a.push(re(c.data[0],c.data[1]))):c.op==="bcurveTo"?l&&(a.push(re(c.data[0],c.data[1])),a.push(re(c.data[2],c.data[3])),a.push(re(c.data[4],c.data[5]))):c.op==="lineTo"&&l&&a.push(re(c.data[0],c.data[1]));let d=xt(a,10,5).map(c=>r(c));return{type:"polygon",data:nr(d)}};P();import{pointFrom as ae,pointDistance as Ql,pointRotateRads as kt}from"@excalidraw/math";import{ROUGHNESS as lf,isTransparent as xi,assertNever as df,COLOR_PALETTE as cf,LINE_POLYGON_POINT_MERGE_DISTANCE as uf}from"@excalidraw/common";P();P();function ta(e,t,n,i=o=>o){return e*i(.5-t*(.5-n))}function ru(e){return[-e[0],-e[1]]}function Je(e,t){return[e[0]+t[0],e[1]+t[1]]}function We(e,t){return[e[0]-t[0],e[1]-t[1]]}function Qe(e,t){return[e[0]*t,e[1]*t]}function su(e,t){return[e[0]/t,e[1]/t]}function Qn(e){return[e[1],-e[0]]}function na(e,t){return e[0]*t[0]+e[1]*t[1]}function au(e,t){return e[0]===t[0]&&e[1]===t[1]}function lu(e){return Math.hypot(e[0],e[1])}function du(e){return e[0]*e[0]+e[1]*e[1]}function ia(e,t){return du(We(e,t))}function sa(e){return su(e,lu(e))}function cu(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function Jn(e,t,n){let i=Math.sin(n),o=Math.cos(n),r=e[0]-t[0],s=e[1]-t[1],a=r*o-s*i,l=r*i+s*o;return[a+t[0],l+t[1]]}function ir(e,t,n){return Je(e,Qe(We(t,e),n))}function oa(e,t,n){return Je(e,Qe(t,n))}var{min:An,PI:uu}=Math,ra=.275,ei=uu+1e-4;function mu(e,t={}){let{size:n=16,smoothing:i=.5,thinning:o=.5,simulatePressure:r=!0,easing:s=F=>F,start:a={},end:l={},last:d=!1}=t,{cap:c=!0,easing:u=F=>F*(2-F)}=a,{cap:m=!0,easing:p=F=>--F*F*F+1}=l;if(e.length===0||n<=0)return[];let f=e[e.length-1].runningLength,E=a.taper===!1?0:a.taper===!0?Math.max(n,f):a.taper,h=l.taper===!1?0:l.taper===!0?Math.max(n,f):l.taper,g=Math.pow(n*i,2),x=[],w=[],b=e.slice(0,10).reduce((F,T)=>{let $=T.pressure;if(r){let Z=An(1,T.distance/n),ht=An(1,1-Z);$=An(1,F+(ht-F)*(Z*ra))}return(F+$)/2},e[0].pressure),y=ta(n,o,e[e.length-1].pressure,s),I,S=e[0].vector,A=e[0].point,M=A,O=A,L=M,G=!1;for(let F=0;F<e.length;F++){let{pressure:T}=e[F],{point:$,vector:Z,distance:ht,runningLength:st}=e[F];if(F<e.length-1&&f-st<3)continue;if(o){if(r){let Fe=An(1,ht/n),Xe=An(1,1-Fe);T=An(1,b+(Xe-b)*(Fe*ra))}y=ta(n,o,T,s)}else y=n/2;I===void 0&&(I=y);let Ii=st<E?u(st/E):1,Wo=f-st<h?p((f-st)/h):1;y=Math.max(.01,y*Math.min(Ii,Wo));let Si=(F<e.length-1?e[F+1]:e[F]).vector,Xn=F<e.length-1?na(Z,Si):1,Vo=na(Z,S)<0&&!G,Mi=Xn!==null&&Xn<0;if(Vo||Mi){let Fe=Qe(Qn(S),y);for(let Xe=1/13,zt=0;zt<=1;zt+=Xe)O=Jn(We($,Fe),$,ei*zt),x.push(O),L=Jn(Je($,Fe),$,ei*-zt),w.push(L);A=O,M=L,Mi&&(G=!0);continue}if(G=!1,F===e.length-1){let Fe=Qe(Qn(Z),y);x.push(We($,Fe)),w.push(Je($,Fe));continue}let Ai=Qe(Qn(ir(Si,Z,Xn)),y);O=We($,Ai),(F<=1||ia(A,O)>g)&&(x.push(O),A=O),L=Je($,Ai),(F<=1||ia(M,L)>g)&&(w.push(L),M=L),b=T,S=Z}let B=e[0].point.slice(0,2),U=e.length>1?e[e.length-1].point.slice(0,2):Je(e[0].point,[1,1]),N=[],Y=[];if(e.length===1){if(!(E||h)||d){let F=oa(B,sa(Qn(We(B,U))),-(I||y)),T=[];for(let $=1/13,Z=$;Z<=1;Z+=$)T.push(Jn(F,B,ei*2*Z));return T}}else{if(!(E||h&&e.length===1))if(c)for(let T=1/13,$=T;$<=1;$+=T){let Z=Jn(w[0],B,ei*$);N.push(Z)}else{let T=We(x[0],w[0]),$=Qe(T,.5),Z=Qe(T,.51);N.push(We(B,$),We(B,Z),Je(B,Z),Je(B,$))}let F=Qn(ru(e[e.length-1].vector));if(h||E&&e.length===1)Y.push(U);else if(m){let T=oa(U,F,y);for(let $=1/29,Z=$;Z<1;Z+=$)Y.push(Jn(T,U,ei*3*Z))}else Y.push(Je(U,Qe(F,y)),Je(U,Qe(F,y*.99)),We(U,Qe(F,y*.99)),We(U,Qe(F,y)))}return x.concat(Y,w.reverse(),N)}function pu(e,t={}){var n;let{streamline:i=.5,size:o=16,last:r=!1}=t;if(e.length===0)return[];let s=.15+(1-i)*.85,a=Array.isArray(e[0])?e:e.map(({x:p,y:f,pressure:E=.5})=>[p,f,E]);if(a.length===2){let p=a[1];a=a.slice(0,-1);for(let f=1;f<5;f++)a.push(ir(a[0],p,f/4))}a.length===1&&(a=[...a,[...Je(a[0],[1,1]),...a[0].slice(2)]]);let l=[{point:[a[0][0],a[0][1]],pressure:a[0][2]>=0?a[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],d=!1,c=0,u=l[0],m=a.length-1;for(let p=1;p<a.length;p++){let f=r&&p===m?a[p].slice(0,2):ir(u.point,a[p],s);if(au(u.point,f))continue;let E=cu(f,u.point);if(c+=E,p<m&&!d){if(c<o)continue;d=!0}u={point:f,pressure:a[p][2]>=0?a[p][2]:.5,vector:sa(We(u.point,f)),distance:E,runningLength:c},l.push(u)}return l[0].vector=((n=l[1])==null?void 0:n.vector)||[0,0],l}function aa(e,t={}){return mu(pu(e,t),t)}import{isRightAngleRads as jp,lineSegment as zl,pointFrom as Mo,pointRotateRads as Kr}from"@excalidraw/math";import{BOUND_TEXT_PADDING as Ao,DEFAULT_REDUCED_GLOBAL_ALPHA as Wp,ELEMENT_READY_TO_ERASE_OPACITY as Vp,FRAME_STYLE as To,MIME_TYPES as Jr,THEME as Yl,distance as an,getFontString as $p,isRTL as Zp,getVerticalOffset as qp,invariant as Kp}from"@excalidraw/common";P();import{pointFrom as yt,pointCenter as fu,pointRotateRads as Yt,vectorFromPoint as or,vectorNormalize as la,vectorSubtract as da,vectorAdd as Ui,vectorScale as Yi,pointFromVector as ca,clamp as be,isCloseTo as ua}from"@excalidraw/math";var Pe=10,wx=(e,t,n,i,o,r,s,a)=>{let{width:l,height:d}=rr(e),c=i/l,u=o/d,m=(e.crop?.x??0)/c,p=(e.crop?.y??0)/u,f=Yt(yt(r,s),fe(e,t),-e.angle);r=f[0],s=f[1];let E=e.width,h=e.height,g=e.crop??{x:0,y:0,width:i,height:o,naturalWidth:i,naturalHeight:o},x=g.height,w=g.width,b=e.scale[0]===-1,y=e.scale[1]===-1,I=s-e.y,S=r-e.x;n.includes("n")&&(h=be(e.height-I,Pe,y?d-p:e.height+p)),n.includes("s")&&(I=s-e.y-e.height,h=be(e.height+I,Pe,y?e.height+p:d-p)),n.includes("e")&&(S=r-e.x-e.width,E=be(e.width+S,Pe,b?e.width+m:l-m)),n.includes("w")&&(E=be(e.width-S,Pe,b?l-m:e.width+m));let A=L=>{L.height=h*u,L.width=E*c};A(g);let M=(L,G)=>{A(G),L.includes("n")&&(y||(G.y+=x-G.height)),L.includes("s")&&y&&(G.y+=x-G.height),L.includes("e")&&b&&(G.x+=w-G.width),L.includes("w")&&(b||(G.x+=w-G.width))};switch(n){case"n":{if(a){let L=m+e.width/2,G=l-m-e.width/2,B=Math.min(L,G)*2;E=be(h*a,Pe,B),h=E/a}M(n,g),a&&(g.x+=(w-g.width)/2);break}case"s":{if(a){let L=m+e.width/2,G=l-m-e.width/2,B=Math.min(L,G)*2;E=be(h*a,Pe,B),h=E/a}M(n,g),a&&(g.x+=(w-g.width)/2);break}case"w":{if(a){let L=p+e.height/2,G=d-p-e.height/2,B=Math.min(L,G)*2;h=be(E/a,Pe,B),E=h*a}M(n,g),a&&(g.y+=(x-g.height)/2);break}case"e":{if(a){let L=p+e.height/2,G=d-p-e.height/2,B=Math.min(L,G)*2;h=be(E/a,Pe,B),E=h*a}M(n,g),a&&(g.y+=(x-g.height)/2);break}case"ne":{if(a)if(S>-I){let L=y?d-p:p+e.height;h=be(E/a,Pe,L),E=h*a}else{let L=b?m+e.width:l-m;E=be(h*a,Pe,L),h=E/a}M(n,g);break}case"nw":{if(a)if(S<I){let L=y?d-p:p+e.height;h=be(E/a,Pe,L),E=h*a}else{let L=b?l-m:m+e.width;E=be(h*a,Pe,L),h=E/a}M(n,g);break}case"se":{if(a)if(S>I){let L=y?p+e.height:d-p;h=be(E/a,Pe,L),E=h*a}else{let L=b?m+e.width:l-m;E=be(h*a,Pe,L),h=E/a}M(n,g);break}case"sw":{if(a)if(-S>I){let L=y?p+e.height:d-p;h=be(E/a,Pe,L),E=h*a}else{let L=b?l-m:m+e.width;E=be(h*a,Pe,L),h=E/a}M(n,g);break}default:break}let O=hu(e,n,E,h,!!a);return ua(g.width,g.naturalWidth)&&ua(g.height,g.naturalHeight)&&(g=null),{x:O[0],y:O[1],width:E,height:h,crop:g}},hu=(e,t,n,i,o)=>{let[r,s,a,l]=Xt(e,e.width,e.height,!0),d=yt(r,s),c=yt(a,l),u=fu(d,c),[m,p,f,E]=Xt(e,n,i,!0),h=f-m,g=E-p,x=[...d];if(["n","w","nw"].includes(t)&&(x=[c[0]-Math.abs(h),c[1]-Math.abs(g)]),t==="ne"){let A=[d[0],c[1]];x=[A[0],A[1]-Math.abs(g)]}if(t==="sw"){let A=[c[0],d[1]];x=[A[0]-Math.abs(h),A[1]]}o&&(["s","n"].includes(t)&&(x[0]=u[0]-h/2),["e","w"].includes(t)&&(x[1]=u[1]-g/2));let w=e.angle,b=Yt(x,u,w),y=[x[0]+Math.abs(h)/2,x[1]+Math.abs(g)/2],I=Yt(y,u,w);x=Yt(b,I,-w);let S=[...x];return S[0]+=e.x-m,S[1]+=e.y-p,S},ma=(e,t)=>{if(e.crop){let{width:n,height:i}=rr(e),[o,r,s,a,l,d]=W(e,t),c=or(Yt(yt(o,r),yt(l,d),e.angle)),u=or(Yt(yt(s,r),yt(l,d),e.angle)),m=la(da(u,c)),p=or(Yt(yt(o,a),yt(l,d),e.angle)),f=da(p,c),E=la(f),{cropX:h,cropY:g}=Eu(e.crop,e.scale),x=Ui(Ui(c,Yi(m,-h*n/e.crop.naturalWidth)),Yi(E,-g*i/e.crop.naturalHeight)),w=ca(Ui(Ui(x,Yi(m,n/2)),Yi(E,i/2))),b=Yt(ca(x),w,-e.angle);return{...e,x:b[0],y:b[1],width:n,height:i,crop:null}}return e},rr=e=>{if(e.crop){let t=e.width/(e.crop.width/e.crop.naturalWidth),n=e.height/(e.crop.height/e.crop.naturalHeight);return{width:t,height:n}}return{width:e.width,height:e.height}},Eu=(e,t)=>{let n=e.x,i=e.y,o=t[0]===-1,r=t[1]===-1;return o&&(n=e.naturalWidth-Math.abs(n)-e.width),r&&(i=e.naturalHeight-Math.abs(i)-e.height),{cropX:n,cropY:i}},yx=(e,t=!1)=>{let n=e.crop;if(!n)return null;let i=e.scale[0]===-1,o=e.scale[1]===-1,r=n.x,s=n.y;if(i&&(r=n.naturalWidth-n.width-n.x),o&&(s=n.naturalHeight-n.height-n.y),t)return{x:r,y:s};let{width:a,height:l}=rr(e);return{x:r/(n.naturalWidth/a),y:s/(n.naturalHeight/l)}};P();import{pointCenter as ll,pointFrom as C,pointRotateRads as Ae,pointsEqual as dl,pointDistance as nn,vectorFromPoint as lp,curveLength as dp,curvePointAtLength as cp,lineSegment as cl}from"@excalidraw/math";import{DRAGGING_THRESHOLD as up,KEYS as In,shouldRotateWithDiscreteAngle as hi,getGridPoint as ul,invariant as Te,isShallowEqual as mp,getFeatureFlag as Ei}from"@excalidraw/common";import{deconstructLinearOrFreeDrawElement as ml,isPathALoop as pp,moveArrowAboveBindable as pl,projectFixedPointOntoDiagonal as fl}from"@excalidraw/element";P();import{KEYS as $m,arrayToMap as el,getFeatureFlag as Zm,invariant as it,isTransparent as qm}from"@excalidraw/common";import{PRECISION as Km,clamp as zr,lineSegment as mi,pointDistance as Ct,pointDistanceSq as ui,pointFrom as ne,pointFromVector as On,pointRotateRads as pe,vectorFromPoint as Rn,vectorNormalize as fo,vectorScale as kn}from"@excalidraw/math";P();import{invariant as cm,isTransparent as Ra}from"@excalidraw/common";import{curveIntersectLineSegment as Fa,isPointWithinBounds as eo,lineSegment as si,lineSegmentIntersectionPoints as Na,pointFrom as ce,pointFromVector as um,pointRotateRads as ze,pointsEqual as mm,vectorFromPoint as pm,vectorNormalize as fm,vectorScale as hm}from"@excalidraw/math";import{ellipse as Em,ellipseSegmentInterceptPoints as gm}from"@excalidraw/math/ellipse";P();import{DEFAULT_ADAPTIVE_RADIUS as Su,DEFAULT_PROPORTIONAL_RADIUS as dr,invariant as Mu,LINE_CONFIRM_THRESHOLD as Au,ROUNDNESS as cr}from"@excalidraw/common";import{curve as Pt,curveCatmullRomCubicApproxPoints as ba,curveOffsetPoints as Pa,lineSegment as he,lineSegmentIntersectionPoints as wa,pointDistance as Tn,pointFrom as z,pointFromArray as Tu,pointFromVector as vu,pointRotateRads as Wt,pointTranslate as ya,rectangle as Du,vectorFromPoint as Ia,vectorNormalize as Lu,vectorScale as ur}from"@excalidraw/math";P();import{ROUNDNESS as ti,assertNever as gu}from"@excalidraw/common";import{pointsEqual as pa}from"@excalidraw/math";var jt=e=>!!e&&e.type==="image"&&!!e.fileId,xe=e=>!!e&&e.type==="image",fa=e=>!!e&&e.type==="embeddable",Xi=e=>!!e&&e.type==="iframe",ji=e=>!!e&&(e.type==="iframe"||e.type==="embeddable"),J=e=>e!=null&&e.type==="text",Wi=e=>e!=null&&e.type==="frame",ha=e=>e!=null&&e.type==="magicframe",q=e=>e!=null&&(e.type==="frame"||e.type==="magicframe"),Ie=e=>e!=null&&xu(e.type),xu=e=>e==="freedraw",K=e=>e!=null&&bu(e.type),bt=e=>e!=null&&e.type==="line",H=e=>e!=null&&e.type==="arrow",X=e=>H(e)&&e.elbowed,Mx=e=>H(e)&&!e.elbowed,wu=e=>H(e)&&!e.elbowed&&!e.roundness,yu=e=>H(e)&&!e.elbowed&&e.roundness!==null,bu=e=>e==="arrow"||e==="line",Le=(e,t=!0)=>e!=null&&(!e.locked||t===!0)&&Pu(e.type),Pu=e=>e==="arrow",He=(e,t=!0)=>e!=null&&(!e.locked||t===!0)&&(e.type==="rectangle"||e.type==="diamond"||e.type==="ellipse"||e.type==="image"||e.type==="iframe"||e.type==="embeddable"||e.type==="frame"||e.type==="magicframe"||e.type==="text"&&!e.containerId),sr=e=>e!=null&&(e.type==="rectangle"||e.type==="diamond"||e.type==="image"||e.type==="iframe"||e.type==="embeddable"||e.type==="frame"||e.type==="magicframe"||e.type==="text"&&!e.containerId),ar=e=>e!=null&&(e.type==="rectangle"||e.type==="image"||e.type==="text"||e.type==="iframe"||e.type==="embeddable"||e.type==="frame"||e.type==="magicframe"||e.type==="freedraw"),Iu=(e,t=!0)=>e!=null&&(!e.locked||t===!0)&&(e.type==="rectangle"||e.type==="diamond"||e.type==="ellipse"||H(e)),Ax=e=>{let t=e?.type;if(!t)return!1;switch(t){case"text":case"diamond":case"rectangle":case"iframe":case"embeddable":case"ellipse":case"arrow":case"freedraw":case"line":case"frame":case"magicframe":case"image":case"selection":return!0;default:return gu(t,null),!1}},lr=e=>e.type==="rectangle"||e.type==="ellipse"||e.type==="diamond",lt=e=>Iu(e)&&!!e.boundElements?.some(({type:t})=>t==="text"),le=e=>e!==null&&"containerId"in e&&e.containerId!==null&&J(e),Tx=e=>!!e.startBinding||!!e.endBinding,Ea=e=>e==="rectangle"||e==="embeddable"||e==="iframe"||e==="image",ga=e=>e==="line"||e==="arrow"||e==="diamond",vx=(e,t)=>!!((e===ti.ADAPTIVE_RADIUS||e===ti.LEGACY)&&Ea(t.type)||e===ti.PROPORTIONAL_RADIUS&&ga(t.type)),Dx=e=>ga(e.type)?{type:ti.PROPORTIONAL_RADIUS}:Ea(e.type)?{type:ti.ADAPTIVE_RADIUS}:null,Lx=e=>Array.isArray(e)&&e.length===4&&typeof e[0]=="number"&&typeof e[1]=="number"&&typeof e[2]=="number"&&typeof e[3]=="number",Bx=e=>wu(e)?"sharpArrow":yu(e)?"curvedArrow":X(e)?"elbowArrow":"line",Cx=e=>e.length>3&&pa(e[0],e[e.length-1]),xa=e=>e.length>3||e.length===3&&!pa(e[0],e[e.length-1]);var ni=new WeakMap,mr=(e,t)=>{let n=ni.get(e);if(!n)return;let{version:i,shapes:o}=n;if(i!==e.version){ni.delete(e);return}return o.get(t)},pr=(e,t,n)=>{let i=ni.get(e);if(!i){ni.set(e,{version:e.version,shapes:new Map([[n,t]])});return}let{version:o,shapes:r}=i;if(o!==e.version){ni.set(e,{version:e.version,shapes:new Map([[n,t]])});return}r.set(n,t)};function Vi(e){let t=mr(e,0);if(t)return t;let n=Sa(e),i=[],o=[];for(let s=0;s<n.length;s+=1){let a=n[s],l=n[s-1]&&Tu(n[s-1].data.slice(-2));switch(a.op){case"move":continue;case"lineTo":if(!l)throw new Error("prevPoint is undefined");i.push(he(z(e.x+l[0],e.y+l[1]),z(e.x+a.data[0],e.y+a.data[1])));continue;case"bcurveTo":if(!l)throw new Error("prevPoint is undefined");o.push(Pt(z(e.x+l[0],e.y+l[1]),z(e.x+a.data[0],e.y+a.data[1]),z(e.x+a.data[2],e.y+a.data[3]),z(e.x+a.data[4],e.y+a.data[5])));continue;default:console.error("Unknown op type",a.op)}}let r=[i,o];return pr(e,r,0),r}function vn(e,t=0){let n=mr(e,t);if(n)return n;let i=It(Math.min(e.width,e.height),e);i===0&&(i=.01);let o=Du(z(e.x,e.y),z(e.x+e.width,e.y+e.height)),r=he(z(o[0][0]+i,o[0][1]),z(o[1][0]-i,o[0][1])),s=he(z(o[1][0],o[0][1]+i),z(o[1][0],o[1][1]-i)),a=he(z(o[0][0]+i,o[1][1]),z(o[1][0]-i,o[1][1])),l=he(z(o[0][0],o[1][1]-i),z(o[0][0],o[0][1]+i)),d=[Pt(l[1],z(l[1][0]+2/3*(o[0][0]-l[1][0]),l[1][1]+2/3*(o[0][1]-l[1][1])),z(r[0][0]+2/3*(o[0][0]-r[0][0]),r[0][1]+2/3*(o[0][1]-r[0][1])),r[0]),Pt(r[1],z(r[1][0]+2/3*(o[1][0]-r[1][0]),r[1][1]+2/3*(o[0][1]-r[1][1])),z(s[0][0]+2/3*(o[1][0]-s[0][0]),s[0][1]+2/3*(o[0][1]-s[0][1])),s[0]),Pt(s[1],z(s[1][0]+2/3*(o[1][0]-s[1][0]),s[1][1]+2/3*(o[1][1]-s[1][1])),z(a[1][0]+2/3*(o[1][0]-a[1][0]),a[1][1]+2/3*(o[1][1]-a[1][1])),a[1]),Pt(a[0],z(a[0][0]+2/3*(o[0][0]-a[0][0]),a[0][1]+2/3*(o[1][1]-a[0][1])),z(l[0][0]+2/3*(o[0][0]-l[0][0]),l[0][1]+2/3*(o[1][1]-l[0][1])),l[0])],c=t>0?d.map(p=>ba(Pa(p,t))):[[d[0]],[d[1]],[d[2]],[d[3]]],m=[[he(c[0][c[0].length-1][3],c[1][0][0]),he(c[1][c[1].length-1][3],c[2][0][0]),he(c[2][c[2].length-1][3],c[3][0][0]),he(c[3][c[3].length-1][3],c[0][0][0])],c.flat()];return pr(e,m,t),m}function Dn(e,t=0){let n=mr(e,t);if(n)return n;let[i,o,r,s,a,l,d,c]=Ln(e),u=e.roundness?It(Math.abs(i-d),e):(i-d)*.01,m=e.roundness?It(Math.abs(s-o),e):(s-o)*.01,[p,f,E,h]=[z(e.x+i,e.y+o),z(e.x+r,e.y+s),z(e.x+a,e.y+l),z(e.x+d,e.y+c)],x=[Pt(z(f[0]-u,f[1]-m),f,f,z(f[0]-u,f[1]+m)),Pt(z(E[0]+u,E[1]-m),E,E,z(E[0]-u,E[1]-m)),Pt(z(h[0]+u,h[1]+m),h,h,z(h[0]+u,h[1]-m)),Pt(z(p[0]-u,p[1]+m),p,p,z(p[0]+u,p[1]+m))].map(y=>ba(Pa(y,t))),b=[[he(x[0][x[0].length-1][3],x[1][0][0]),he(x[1][x[1].length-1][3],x[2][0][0]),he(x[2][x[2].length-1][3],x[3][0][0]),he(x[3][x[3].length-1][3],x[0][0][0])],x.flat()];return pr(e,b,t),b}var gn=(e,t=1)=>{if(e.length>=3){let[n,i]=[e[0],e[e.length-1]];return Tn(n,i)<=Au/t}return!1},It=(e,t)=>{if(t.roundness?.type===cr.PROPORTIONAL_RADIUS||t.roundness?.type===cr.LEGACY)return e*dr;if(t.roundness?.type===cr.ADAPTIVE_RADIUS){let n=t.roundness?.value??Su,i=n/dr;return e<=i?e*dr:n}return 0},Bu=(e,t)=>{let n=e.type==="rectangle"?15:0,i=a=>{let l=Lu(Ia(a[1],a[0])),d=ur(l,n);return he(ya(a[0],d),ya(a[1],ur(d,-1)))},o=fe(e,t),r=i(ar(e)?he(Wt(z(e.x,e.y),o,e.angle),Wt(z(e.x+e.width,e.y+e.height),o,e.angle)):he(Wt(z(e.x+e.width/2,e.y),o,e.angle),Wt(z(e.x+e.width/2,e.y+e.height),o,e.angle))),s=i(ar(e)?he(Wt(z(e.x+e.width,e.y),o,e.angle),Wt(z(e.x,e.y+e.height),o,e.angle)):he(Wt(z(e.x,e.y+e.height/2),o,e.angle),Wt(z(e.x+e.width,e.y+e.height/2),o,e.angle)));return[r,s]},fr=(e,t,n,i,o)=>{if(Mu(e.points.length>=2,"Arrow must have at least two points"),e.width<3&&e.height<3)return null;let[r,s]=Bu(n,o),a=R.getPointAtIndexGlobalCoordinates(e,i==="start"?1:e.points.length-2,o),l=vu(ur(Ia(t,a),2*Tn(a,t)+Math.max(Tn(r[0],r[1]),Tn(s[0],s[1]))),a),d=he(t,l),c=wa(r,d),u=wa(s,d),m=c&&Tn(a,c),p=u&&Tn(a,u),f=null;return m!=null&&p!=null?f=m<p?c:u:f=c||u||null,f&&St(f,n,o)?f:null};P();import{ARROW_LABEL_FONT_SIZE_TO_MIN_WIDTH_RATIO as Ku,ARROW_LABEL_WIDTH_FRACTION as Qu,BOUND_TEXT_PADDING as dt,DEFAULT_FONT_SIZE as Ju,TEXT_ALIGN as Ba,VERTICAL_ALIGN as Ca,getFontString as Ji,isProdEnv as em,invariant as tm}from"@excalidraw/common";import{pointFrom as Ga,pointRotateRads as nm}from"@excalidraw/math";P();var ii={},Ma=(e,t)=>{let n=ii[e]||(ii[e]={height:t});return n.height=t,n},Aa=e=>{ii[e]&&delete ii[e]},Xx=e=>ii[e]?.height??null;P();import{BOUND_TEXT_PADDING as Zi,DEFAULT_FONT_SIZE as Cu,DEFAULT_FONT_FAMILY as Gu,getFontString as Ou,isTestEnv as ku,normalizeEOL as Ru}from"@excalidraw/common";var et=(e,t,n)=>{let i=e.split(`
`).map(a=>a||" ").join(`
`),o=parseFloat(t),r=Fu(i,o,n);return{width:La(i,t),height:r}},Ta="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".toLocaleUpperCase(),va=(e,t)=>{let n=Nu(e);return n===0?et(Ta.split("").join(`
`),e,t).width+Zi*2:n+Zi*2},qi=(e,t)=>et("",e,t).width+Zi*2,$x=()=>La(Ta,Ou({fontSize:Cu,fontFamily:Gu}))>0,Er=e=>Ru(e).replace(/\t/g,"        "),gr=e=>Er(e).split(`
`),Zx=e=>{let t=gr(e.text).length;return e.height/t/e.fontSize},Ki=(e,t)=>e*t,Da=(e,t)=>Ki(e,t)+Zi*2,$i,qx=e=>{$i=e},hr=class{canvas;constructor(){this.canvas=document.createElement("canvas")}getLineWidth(t,n){let i=this.canvas.getContext("2d");i.font=n;let r=i.measureText(t).width;return ku()?r*10:r}},Vt=(e,t)=>($i||($i=new hr),$i.getLineWidth(e,t)),La=(e,t)=>{let n=gr(e),i=0;return n.forEach(o=>{i=Math.max(i,Vt(o,t))}),i},Fu=(e,t,n)=>{let i=gr(e).length;return Ki(t,n)*i},Bn=(()=>{let e={};return{calculate:(o,r)=>{let s=o.charCodeAt(0);if(e[r]||(e[r]=[]),!e[r][s]){let a=Vt(o,r);e[r][s]=a}return e[r][s]},getCache:o=>e[o],clearCache:o=>{e[o]=[]}}})(),Kx=e=>{let t=Bn.getCache(e);if(!t)return 0;let n=t.filter(i=>i!==void 0);return Math.min(...n)},Nu=e=>{let t=Bn.getCache(e);if(!t)return 0;let n=t.filter(i=>i!==void 0);return Math.max(...n)};P();import{isDevEnv as Hu,isTestEnv as zu}from"@excalidraw/common";var xr,Qi,wr,nw=e=>(xr||(xr=ee.class(...Object.values(Mt))),xr.test(e)),_u=()=>{if(!Qi)try{Qi=Yu()}catch{Qi=Uu()}return Qi},yr=()=>(wr||(wr=Xu()),wr),Ve={WHITESPACE:/\s/u,HYPHEN:/-/u,OPENING:/<\(\[\{/u,CLOSING:/>\)\]\}.,:;!\?\//u},Mt={CHAR:/\p{Script=Han}\p{Script=Hiragana}\p{Script=Katakana}\p{Script=Hangul}/u,OPENING://u,CLOSING://u,CURRENCY://u},xn={FLAG:/\p{RI}\p{RI}/u,JOINER:/(?:\p{Emoji_Modifier}|\uFE0F\u20E3?|[\u{E0020}-\u{E007E}]+\u{E007F})?/u,ZWJ:/\u200D/u,ANY:/[\p{Emoji}]/u,MOST:/[\p{Extended_Pictographic}\p{Emoji_Presentation}]/u},Uu=()=>ee.or(yr(),de.On(Ve.HYPHEN,Ve.WHITESPACE,Mt.CHAR)),Yu=()=>ee.or(yr(),de.Before(Ve.WHITESPACE).Build(),de.After(Ve.WHITESPACE,Ve.HYPHEN).Build(),de.Before(Mt.CHAR,Mt.CURRENCY).NotPrecededBy(Ve.OPENING,Mt.OPENING).Build(),de.After(Mt.CHAR).NotFollowedBy(Ve.HYPHEN,Ve.CLOSING,Mt.CLOSING).Build(),de.BeforeMany(Mt.OPENING).NotPrecededBy(Ve.OPENING).Build(),de.AfterMany(Mt.CLOSING).NotFollowedBy(Ve.CLOSING).Build(),de.AfterMany(Ve.CLOSING).FollowedBy(Ve.OPENING).Build()),Xu=()=>ee.group(ee.or(xn.FLAG,ee.and(xn.MOST,xn.JOINER,ee.build(`(?:${xn.ZWJ.source}(?:${xn.FLAG.source}|${xn.ANY.source}${xn.JOINER.source}))*`)))),ee={build:e=>new RegExp(e,"u"),join:(...e)=>e.map(t=>t.source).join(""),and:(...e)=>ee.build(ee.join(...e)),or:(...e)=>ee.build(e.map(t=>t.source).join("|")),group:(...e)=>ee.build(`(${ee.join(...e)})`),class:(...e)=>ee.build(`[${ee.join(...e)}]`)},de={On:(...e)=>{let t=ee.join(...e);return ee.build(`([${t}])`)},Before:(...e)=>{let t=ee.join(...e),n=()=>ee.build(`(?=[${t}])`);return de.Chain(n)},After:(...e)=>{let t=ee.join(...e),n=()=>ee.build(`(?<=[${t}])`);return de.Chain(n)},BeforeMany:(...e)=>{let t=ee.join(...e),n=()=>ee.build(`(?<![${t}])(?=[${t}])`);return de.Chain(n)},AfterMany:(...e)=>{let t=ee.join(...e),n=()=>ee.build(`(?<=[${t}])(?![${t}])`);return de.Chain(n)},NotBefore:(...e)=>{let t=ee.join(...e),n=()=>ee.build(`(?![${t}])`);return de.Chain(n)},NotAfter:(...e)=>{let t=ee.join(...e),n=()=>ee.build(`(?<![${t}])`);return de.Chain(n)},Chain:e=>({Build:e,PreceededBy:(...t)=>{let n=e(),i=de.After(...t).Build(),o=()=>ee.and(i,n);return de.Chain(o)},FollowedBy:(...t)=>{let n=e(),i=de.Before(...t).Build(),o=()=>ee.and(n,i);return de.Chain(o)},NotPrecededBy:(...t)=>{let n=e(),i=de.NotAfter(...t).Build(),o=()=>ee.and(i,n);return de.Chain(o)},NotFollowedBy:(...t)=>{let n=e(),i=de.NotBefore(...t).Build(),o=()=>ee.and(n,i);return de.Chain(o)}})},ju=e=>{let t=_u();return e.normalize("NFC").split(t).filter(Boolean)},At=(e,t,n)=>{if(!Number.isFinite(n)||n<0)return e;let i=[],o=e.split(`
`);for(let r of o){if(Vt(r,t)<=n){i.push(r);continue}let a=Wu(r,t,n);i.push(...a)}return i.join(`
`)},Wu=(e,t,n)=>{let i=[],r=ju(e)[Symbol.iterator](),s="",a=0,l=r.next();for(;!l.done;){let d=l.value,c=s+d,u=Zu(d)?a+Bn.calculate(d,t):Vt(c,t);if(/\s/.test(d)||u<=n){s=c,a=u,l=r.next();continue}if(s)i.push(s.trimEnd()),s="",a=0;else{let m=Vu(d,t,n),p=m[m.length-1]??"",f=m.slice(0,-1);i.push(...f),s=p,a=Vt(p,t),l=r.next()}}if(s){let d=$u(s,t,n);i.push(d)}return i},Vu=(e,t,n)=>{if(yr().test(e))return[e];qu(e);let i=[],o=Array.from(e),r="",s=0;for(let a of o){let l=Bn.calculate(a,t),d=s+l;if(d<=n){r=r+a,s=d;continue}r&&i.push(r),r=a,s=l}return r&&i.push(r),i},$u=(e,t,n)=>{if(!(Vt(e,t)>n))return e;let[,o,r]=e.match(/^(.+?)(\s+)$/)??[e,e.trimEnd(),""],s=Vt(o,t);for(let a of Array.from(r)){let l=Bn.calculate(a,t),d=s+l;if(d>n)break;o=o+a,s=d}return o},Zu=e=>e.codePointAt(0)!==void 0&&e.codePointAt(1)===void 0,qu=e=>{if((zu()||Hu())&&/\s/.test(e))throw new Error("Word should not contain any whitespaces!")};var Oa=(e,t,n)=>{let i=n.getNonDeletedElementsMap(),o;em()||tm(!t||!H(t)||e.angle===0,"text element angle must be 0 if bound to arrow container");let r={x:e.x,y:e.y,text:e.text,width:e.width,height:e.height,angle:t?H(t)?0:t.angle:e.angle};r.text=e.text,(t||!e.autoResize)&&(o=t?tt(t,e):e.width,r.text=At(e.originalText,Ji(e),o));let s=et(r.text,Ji(e),e.lineHeight);if(e.autoResize&&(r.width=s.width),r.height=s.height,t){let a=ri(t,e),l=tt(t,e);if(!H(t)&&s.height>a){let m=br(s.height,t.type);n.mutateElement(t,{height:m}),Ma(t.id,m)}if(s.width>l){let m=br(s.width,t.type);n.mutateElement(t,{width:m})}let d={...e,...r},{x:c,y:u}=oi(t,d,i);r.x=c,r.y=u}n.mutateElement(e,r)},wn=(e,t,n,i=!1)=>{let o=t.getNonDeletedElementsMap();if(!Tt(e))return;Aa(e.id);let s=V(e,o);if(s&&s.text){if(!e)return;let a=s.text,l=s.height,d=s.width,c=tt(e,s),u=ri(e,s),m=e.height;if(i||n!=="n"&&n!=="s"){a&&(a=At(s.originalText,Ji(s),c));let p=et(a,Ji(s),s.lineHeight);l=p.height,d=p.width}if(l>u){m=br(l,e.type);let p=m-e.height,f=!H(e)&&(n==="ne"||n==="nw"||n==="n")?e.y-p:e.y;t.mutateElement(e,{height:m,y:f})}t.mutateElement(s,{text:a,width:d,height:l}),H(e)||t.mutateElement(s,oi(e,s,o))}},oi=(e,t,n)=>{if(H(e))return R.getBoundTextElementPosition(e,t,n);let i=Pr(e),o=ri(e,t),r=tt(e,t),s,a;t.verticalAlign===Ca.TOP?a=i.y:t.verticalAlign===Ca.BOTTOM?a=i.y+(o-t.height):a=i.y+(o/2-t.height/2),t.textAlign===Ba.LEFT?s=i.x:t.textAlign===Ba.RIGHT?s=i.x+(r-t.width):s=i.x+(r/2-t.width/2);let l=e.angle??0;if(l!==0){let d=Ga(i.x+r/2,i.y+o/2),c=Ga(s+t.width/2,a+t.height/2),[u,m]=nm(c,d,l);return{x:u-t.width/2,y:m-t.height/2}}return{x:s,y:a}},Tt=e=>e?.boundElements?.length&&e?.boundElements?.find(t=>t.type==="text")?.id||null,V=(e,t)=>{if(!e)return null;let n=Tt(e);return n&&t.get(n)||null},Se=(e,t)=>e&&e.containerId&&t.get(e.containerId)||null,mw=(e,t,n)=>{if(!H(e))return{x:e.x+e.width/2,y:e.y+e.height/2};if(R.getPointsGlobalCoordinates(e,n).length%2===1){let s=Math.floor(e.points.length/2),a=R.getPointGlobalCoordinates(e,e.points[s],n);return{x:a[0],y:a[1]}}let o=e.points.length/2-1,r=R.getEditorMidPoints(e,n,t)[o];return r||(r=R.getSegmentMidPoint(e,o+1)),{x:r[0],y:r[1]}},Pr=e=>{let t=dt,n=dt;return e.type==="ellipse"&&(t+=e.width/2*(1-Math.sqrt(2)/2),n+=e.height/2*(1-Math.sqrt(2)/2)),e.type==="diamond"&&(t+=e.width/4,n+=e.height/4),{x:e.x+t,y:e.y+n}},pw=(e,t)=>H(t)?0:t?t.angle:e.angle,fw=(e,t,n)=>{if(H(e))return R.getBoundTextElementPosition(e,t,n)},hw=(e,t)=>e.some(n=>{if(le(n)){let i=Se(n,t);return!H(i)}return!1}),Ew=(e,t)=>e.some(n=>{if(le(n)){let i=Se(n,t);return!H(i)}return J(n)}),im=new Set(["rectangle","ellipse","diamond","arrow"]),gw=e=>im.has(e.type),br=(e,t)=>{e=Math.ceil(e);let n=dt*2;return t==="ellipse"?Math.round((e+n)/Math.sqrt(2)*2):t==="arrow"?e+n*8:t==="diamond"?2*(e+n):e+n},tt=(e,t)=>{let{width:n}=e;if(H(e)){let i=(t?.fontSize??Ju)*Ku;return Math.max(Qu*n,i)}return e.type==="ellipse"?Math.round(n/2*Math.sqrt(2))-dt*2:e.type==="diamond"?Math.round(n/2)-dt*2:n-dt*2},ri=(e,t)=>{let{height:n}=e;return H(e)?n-dt*8*2<=0?t.height:n:e.type==="ellipse"?Math.round(n/2*Math.sqrt(2))-dt*2:e.type==="diamond"?Math.round(n/2)-dt*2:n-dt*2},xw=(e,t=`

`)=>e.reduce((i,o)=>(J(o)&&i.push(o.text),i),[]).join(t);P();import{curvePointDistance as Ir,distanceToLineSegment as Sr,pointRotateRads as Mr}from"@excalidraw/math";import{ellipse as om,ellipseDistanceFromPoint as rm}from"@excalidraw/math/ellipse";var yn=(e,t,n)=>{switch(e.type){case"selection":case"rectangle":case"image":case"text":case"iframe":case"embeddable":case"frame":case"magicframe":return sm(e,t,n);case"diamond":return am(e,t,n);case"ellipse":return lm(e,t,n);case"line":case"arrow":case"freedraw":return dm(e,n)}},sm=(e,t,n)=>{let i=fe(e,t),o=Mr(n,i,-e.angle),[r,s]=vn(e);return Math.min(...r.map(a=>Sr(o,a)),...s.map(a=>Ir(a,o)).filter(a=>a!==null))},am=(e,t,n)=>{let i=fe(e,t),o=Mr(n,i,-e.angle),[r,s]=Dn(e);return Math.min(...r.map(a=>Sr(o,a)),...s.map(a=>Ir(a,o)).filter(a=>a!==null))},lm=(e,t,n)=>{let i=fe(e,t);return rm(Mr(n,i,-e.angle),om(i,e.width/2,e.height/2))},dm=(e,t)=>{let[n,i]=Vi(e);return Math.min(...n.map(o=>Sr(t,o)),...i.map(o=>Ir(o,t)))};var to=e=>{if(e.type==="arrow")return!1;let t=!Ra(e.backgroundColor)||lt(e)||ji(e)||J(e);return e.type==="line"?t&&gn(e.points):e.type==="freedraw"?t&&gn(e.points):t||xe(e)},xm=({point:e,element:t,threshold:n,elementsMap:i,frameNameBound:o=null,overrideShouldTestInside:r=!1})=>{let s=o?eo(ce(o.x-n,o.y-n),e,ce(o.x+o.width+n,o.y+o.height+n)):!1,a=se(t,i,!0);return!eo(ce(a[0]-n,a[1]-n),ze(e,ct(a),-t.angle),ce(a[2]+n,a[3]+n))&&!s?!1:(r||to(t))&&St(e,t,i)||ka(e,t,i,n)||s},wm=(e,t,n,i=0)=>{let[o,r,s,a]=se(t,n);return o-=i,r-=i,s+=i,a+=i,eo(ce(o,r),e,ce(s,a))},Fw=(e,t)=>!xm(e)&&!ym(e.point,e.element,t)&&wm(e.point,e.element,t),ym=(e,t,n)=>{let i=V(t,n);if(!i)return!1;let o=K(t)?{...i,...R.getBoundTextElementPosition(t,i,n)}:i;return St(e,o,n)},bm=(e,[t,n],i,o=0)=>{let r=ce(t,n),s=!q(e),a=Math.max(1,o),l=[t-a,n-a,t+a,n+a],d=se(e,i);if(!bn(l,d))return!1;if(e.frameId){let m=i.get(e.frameId);if(m&&q(m)){let p=se(m,i);if(!Zt(r,p))return!1}}let c=$t(e,i,si(fe(e,i),r)),u=yn(e,i,r);return s?c.length===0||u<=o:c.length>0&&u<=a},no=(e,t,n,i)=>{let o=[];for(let r=t.length-1;r>=0;--r){let s=t[r];if(cm(!s.isDeleted,"Elements in the function parameter for getAllElementsAtPositionForBinding() should not contain deleted elements"),He(s,!1)&&bm(s,e,n,i?.(s))&&(o.push(s),!Ra(s.backgroundColor)))break}return o},vt=(e,t,n,i)=>{let o=no(e,t,n,i);return!o||o.length===0?null:o.length===1?o[0]:o.sort((r,s)=>s.width**2+s.height**2-(r.width**2+r.height**2)).pop()},$t=(e,t,n,i=0,o=!1)=>{let r=[Math.min(n[0][0]-i,n[1][0]-i),Math.min(n[0][1]-i,n[1][1]-i),Math.max(n[0][0]+i,n[1][0]+i),Math.max(n[0][1]+i,n[1][1]+i)],s=se(e,t);if(!bn(r,s))return[];switch(e.type){case"rectangle":case"image":case"text":case"iframe":case"embeddable":case"frame":case"selection":case"magicframe":return Im(e,t,n,i,o);case"diamond":return Sm(e,t,n,i,o);case"ellipse":return Mm(e,t,n,i);case"line":case"freedraw":case"arrow":return Pm(e,n,o)}},Ha=(e,t,n,i,o,r=!1)=>{for(let s of e){let a=io(s[0],s[1],s[2],s[3]),l=[Math.min(t[0][0],t[1][0]),Math.min(t[0][1],t[1][1]),Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])];if(!bn(a,l))continue;let d=Fa(s,t);if(d.length>0){for(let c of d)n.push(ze(c,i,o));if(r)return n}}return n},za=(e,t,n,i,o,r=!1)=>{for(let s of e){let a=Na(s,t);if(a&&(n.push(ze(a,i,o)),r))return n}return n},Pm=(e,t,n=!1)=>{let[i,o]=Vi(e),r=[];for(let s of i){let a=Na(s,t);if(a&&(r.push(a),n))return r}for(let s of o){let a=io(s[0],s[1],s[2],s[3]),l=[Math.min(t[0][0],t[1][0]),Math.min(t[0][1],t[1][1]),Math.max(t[0][0],t[1][0]),Math.max(t[0][1],t[1][1])];if(!bn(a,l))continue;let d=Fa(s,t);if(d.length>0&&(r.push(...d),n))return r}return r},Im=(e,t,n,i=0,o=!1)=>{let r=fe(e,t),s=ze(n[0],r,-e.angle),a=ze(n[1],r,-e.angle),l=si(s,a),[d,c]=vn(e,i),u=[];return za(d,l,u,r,e.angle,o),o&&u.length>0||Ha(c,l,u,r,e.angle,o),u},Sm=(e,t,n,i=0,o=!1)=>{let r=fe(e,t),s=ze(n[0],r,-e.angle),a=ze(n[1],r,-e.angle),l=si(s,a),[d,c]=Dn(e,i),u=[];return za(d,l,u,r,e.angle,o),o&&u.length>0||Ha(c,l,u,r,e.angle,o),u},Mm=(e,t,n,i=0)=>{let o=fe(e,t),r=ze(n[0],o,-e.angle),s=ze(n[1],o,-e.angle);return gm(Em(o,e.width/2+i,e.height/2+i),si(r,s)).map(a=>ze(a,o,e.angle))},ka=(e,t,n,i=1)=>yn(t,n,e)<=i,St=(e,t,n)=>{if((K(t)||Ie(t))&&!gn(t.points))return!1;let[i,o,r,s]=se(t,n);if(!eo(ce(i,o),e,ce(r,s)))return!1;let a=ce((i+r)/2,(o+s)/2),l=um(hm(fm(pm(e,a,.1)),Math.max(t.width,t.height)*2),a),d=si(e,l);return $t(t,n,d).filter((u,m,p)=>p.findIndex(f=>mm(f,u))===m).length%2===1},Ar=(e,t,n)=>{let i=(s,a)=>{let{x:l,y:d,width:c,height:u,angle:m}=s,p=fe(s,n);if(s.type==="diamond"){let[E,h,g,x,w,b,y,I]=Ln(s);return[ce(l+E,d+h-a),ce(l+g+a,d+x),ce(l+w,d+b+a),ce(l+y-a,d+I)].map(A=>ze(A,p,m))}if(s.type==="ellipse"){let E=l+c/2,h=d+u/2,g=c/2,x=u/2;return[ce(E,h-x-a),ce(E+g+a,h),ce(E,h+x+a),ce(E-g-a,h)].map(b=>ze(b,p,m))}return[ce(l-a,d-a),ce(l+c+a,d-a),ce(l+c+a,d+u+a),ce(l-a,d+u+a)].map(E=>ze(E,p,m))},o=-1*Math.max(e.width,e.height)/20;return i(e,o).every(s=>St(s,t,n))};P();import{invariant as _a,isDevEnv as Am,isTestEnv as Tm}from"@excalidraw/common";import{pointFrom as qt,pointFromVector as oo,pointRotateRads as ro,pointScaleFromOrigin as so,pointsEqual as vm,triangleIncludesPoint as Tr,vectorCross as Be,vectorFromPoint as Q,vectorScale as ao}from"@excalidraw/math";var me=[1,0],we=[0,1],Ge=[-1,0],_e=[0,-1],Dt=e=>{let[t,n]=e,i=Math.abs(t),o=Math.abs(n);return t>o?me:t<=-o?Ge:n>i?we:_e},Ce=(e,t)=>Dt(Q(e,t)),nt=(e,t)=>Oe(Ce(e,t)),ue=(e,t)=>e[0]===t[0]&&e[1]===t[1],Oe=e=>ue(e,me)||ue(e,Ge),Yw=e=>!Oe(e),Dm=(e,t,n)=>{let i=ct(t);(Am()||Tm())&&(_a(e.width>0&&e.height>0,"Diamond element has no width or height"),_a(!vm(i,n),"The point is too close to the element mid point to determine heading"));let o=.95,r=oo(ao(Q(ro(qt(e.x+e.width/2,e.y),i,e.angle),i),o),i),s=oo(ao(Q(ro(qt(e.x+e.width,e.y+e.height/2),i,e.angle),i),o),i),a=oo(ao(Q(ro(qt(e.x+e.width/2,e.y+e.height),i,e.angle),i),o),i),l=oo(ao(Q(ro(qt(e.x,e.y+e.height/2),i,e.angle),i),o),i);if(Be(Q(n,r),Q(r,s))<=0&&Be(Q(n,r),Q(r,l))>0)return Ce(r,i);if(Be(Q(n,s),Q(s,a))<=0&&Be(Q(n,s),Q(s,r))>0)return Ce(s,i);if(Be(Q(n,a),Q(a,l))<=0&&Be(Q(n,a),Q(a,s))>0)return Ce(a,i);if(Be(Q(n,l),Q(l,r))<=0&&Be(Q(n,l),Q(l,a))>0)return Ce(l,i);if(Be(Q(n,i),Q(r,i))<=0&&Be(Q(n,i),Q(s,i))>0){let c=e.width>e.height?r:s;return Ce(c,i)}else if(Be(Q(n,i),Q(s,i))<=0&&Be(Q(n,i),Q(a,i))>0){let c=e.width>e.height?a:s;return Ce(c,i)}else if(Be(Q(n,i),Q(a,i))<=0&&Be(Q(n,i),Q(l,i))>0){let c=e.width>e.height?a:l;return Ce(c,i)}let d=e.width>e.height?r:l;return Ce(d,i)},ai=(e,t,n)=>{let o=ct(t);if(e.type==="diamond")return Dm(e,t,n);let r=so(qt(t[0],t[1]),o,2),s=so(qt(t[2],t[1]),o,2),a=so(qt(t[0],t[3]),o,2),l=so(qt(t[2],t[3]),o,2);return Tr([r,s,o],n)?_e:Tr([s,l,o],n)?me:Tr([l,a,o],n)?we:Ge},vr=e=>[e[0]===0?0:e[0]>0?-1:1,e[1]===0?0:e[1]>0?-1:1];P();import{getSizeFromPoints as Vm,randomInteger as Nr,getUpdatedTimestamp as Hr}from"@excalidraw/common";P();import{clamp as lo,pointDistance as Br,pointFrom as j,pointScaleFromOrigin as Lm,pointsEqual as di,pointTranslate as Lr,vector as ut,vectorCross as co,vectorFromPoint as Cr,vectorScale as Bm}from"@excalidraw/math";import{BinaryHeap as Cm,invariant as Cn,isAnyTrue as Gm,getSizeFromPoints as Ua,isDevEnv as Om,arrayToMap as km}from"@excalidraw/common";var Gr=1,te=40,Rm=(e,t)=>{let n=e.fixedSegments?e.fixedSegments.slice():null;if(n){let i=[];e.points.map(s=>j(e.x+s[0],e.y+s[1])).forEach((s,a,l)=>{if(a<2)return i.push(s);let d=Ce(s,l[a-1]),c=Ce(l[a-1],l[a-2]);if(ue(d,c)){let u=n?.findIndex(p=>p.index===a-1)??-1,m=n?.findIndex(p=>p.index===a)??-1;m!==-1&&(n[m].start=j(l[a-2][0]-e.x,l[a-2][1]-e.y)),u!==-1&&n.splice(u,1),i.splice(-1,1),n.forEach(p=>{p.index>a-1&&(p.index-=1)})}return i.push(s)});let o=[];i.forEach((s,a,l)=>{if(a<3)return o.push(s);if(Br(l[a-2],l[a-1])<Gr){let d=n?.findIndex(m=>m.index===a-2)??-1,c=n?.findIndex(m=>m.index===a-1)??-1;c!==-1&&n.splice(c,1),d!==-1&&n.splice(d,1),o.splice(-2,2),n.forEach(m=>{m.index>a-2&&(m.index-=2)});let u=nt(s,l[a-1]);return o.push(j(u?s[0]:l[a-2][0],u?l[a-2][1]:s[1]))}o.push(s)});let r=n.filter(s=>s.index!==1&&s.index!==o.length-1);return r.length===0?Bt(Rr(Fr(kr(e,Or(e,t,o.map(s=>j(s[0]-e.x,s[1]-e.y))))??[])),r,null,null):(Om()&&Cn(Za(o),"Invalid elbow points with fixed segments"),Bt(o,r,e.startIsSpecial,e.endIsSpecial))}return{x:e.x,y:e.y,points:e.points,fixedSegments:e.fixedSegments,startIsSpecial:e.startIsSpecial,endIsSpecial:e.endIsSpecial}},Fm=(e,t,n)=>{let i=t.map(M=>M.index),r=(e.fixedSegments?.map(M=>M.index)??[]).findIndex(M=>!i.includes(M));if(r===-1||!e.fixedSegments?.[r])return{points:e.points};let s=e.fixedSegments[r].index,a=e.fixedSegments[r-1],l=e.fixedSegments[r+1],d=e.x+(a?a.end[0]:0),c=e.y+(a?a.end[1]:0),u=a?null:e.startBinding,m=l?null:e.endBinding,{startHeading:p,endHeading:f,startGlobalPoint:E,endGlobalPoint:h,hoveredStartElement:g,hoveredEndElement:x,...w}=Or({x:d,y:c,startBinding:u,endBinding:m,startArrowhead:null,endArrowhead:null,points:e.points},n,[j(0,0),j(e.x+(l?.start[0]??e.points[e.points.length-1][0])-d,e.y+(l?.start[1]??e.points[e.points.length-1][1])-c)],{isDragging:!1}),{points:b}=Bt(Rr(Fr(kr(e,{startHeading:p,endHeading:f,startGlobalPoint:E,endGlobalPoint:h,hoveredStartElement:g,hoveredEndElement:x,...w})??[])),t,null,null);if(!b||b.length<2)throw new Error("Property 'points' is required in the update returned by normalizeArrowElementUpdate()");let y=[];if(a)for(let M=0;M<a.index;M++)y.push(j(e.x+e.points[M][0],e.y+e.points[M][1]));if(b.forEach(M=>{y.push(j(e.x+(a?a.end[0]:0)+M[0],e.y+(a?a.end[1]:0)+M[1]))}),l)for(let M=l.index;M<e.points.length;M++)y.push(j(e.x+e.points[M][0],e.y+e.points[M][1]));let I=(l?.index??e.points.length)-(a?.index??0)-1,S=t.map(M=>M.index>s?{...M,index:M.index-I+(b.length-1)}:M),A=y.flatMap((M,O)=>{let L=y[O-1],G=y[O+1];if(L&&G){let B=Ce(M,L),U=Ce(G,M);if(ue(B,U))return S.forEach(N=>{N.index>O&&(N.index-=1)}),[];if(ue(B,vr(U)))return S.forEach(N=>{N.index>O&&(N.index+=1)}),[M,M]}return[M]});return Bt(A,S,!1,!1)},Nm=(e,t,n,i,o,r)=>{let s=t.map((y,I)=>e.fixedSegments==null||e.fixedSegments[I]===void 0||e.fixedSegments[I].index!==y.index||(y.start[0]!==e.fixedSegments[I].start[0]&&y.end[0]!==e.fixedSegments[I].end[0])!=(y.start[1]!==e.fixedSegments[I].start[1]&&y.end[1]!==e.fixedSegments[I].end[1])?I:null).filter(y=>y!==null).shift();if(s==null)return{points:e.points};let a=e.fixedSegments?.findIndex(y=>y.index===1)??-1,l=e.fixedSegments?.findIndex(y=>y.index===e.points.length-1)??-1,d=Br(t[s].start,t[s].end),c=d<te+5;if(a===-1&&t[s].index===1&&o){let y=Oe(n),S=(y?ue(n,me):ue(n,we))?c?d/2:te:c?-d/2:-te;t[s].start=j(t[s].start[0]+(y?S:0),t[s].start[1]+(y?0:S))}if(l===-1&&t[s].index===e.points.length-1&&r){let y=Oe(i),S=(y?ue(i,me):ue(i,we))?c?d/2:te:c?-d/2:-te;t[s].end=j(t[s].end[0]+(y?S:0),t[s].end[1]+(y?0:S))}let u=t.map(y=>({...y,start:j(e.x+y.start[0],e.y+y.start[1]),end:j(e.x+y.end[0],e.y+y.end[1])})),m=e.points.map((y,I)=>j(e.x+y[0],e.y+y[1])),p=u[s].index-1,f=u[s].index,E=u[s].start,h=u[s].end,g=m[p-1]&&!di(m[p],m[p-1])?nt(m[p-1],m[p]):void 0,x=m[f+1]&&!di(m[f],m[f+1])?nt(m[f+1],m[f]):void 0;if(g!==void 0){let y=g?1:0;m[p-1][y]=E[y]}if(m[p]=E,m[f]=h,x!==void 0){let y=x?1:0;m[f+1][y]=h[y]}let w=u.findIndex(y=>y.index===p);if(w!==-1){let y=nt(u[w].end,u[w].start)?1:0;u[w].start[y]=E[y],u[w].end=E}let b=u.findIndex(y=>y.index===f+1);if(b!==-1){let y=nt(u[b].end,u[b].start)?1:0;u[b].end[y]=h[y],u[b].start=h}if(a===-1&&p===0){let y=o?Oe(n):nt(m[1],m[0]);m.unshift(j(y?E[0]:e.x+e.points[0][0],y?e.y+e.points[0][1]:E[1])),o&&m.unshift(j(e.x+e.points[0][0],e.y+e.points[0][1]));for(let I of u)I.index+=o?2:1}if(l===-1&&f===e.points.length-1){let y=Oe(i);m.push(j(y?h[0]:e.x+e.points[e.points.length-1][0],y?e.y+e.points[e.points.length-1][1]:h[1])),r&&m.push(j(e.x+e.points[e.points.length-1][0],e.y+e.points[e.points.length-1][1]))}return Bt(m,u.map(y=>({...y,start:j(y.start[0]-e.x,y.start[1]-e.y),end:j(y.end[0]-e.x,y.end[1]-e.y)})),!1,!1)},Hm=(e,t,n,i,o,r,s,a,l)=>{let d=e.startIsSpecial??null,c=e.endIsSpecial??null,u=t.map((h,g)=>g===0?j(e.x+h[0],e.y+h[1]):g===t.length-1?j(e.x+h[0],e.y+h[1]):j(e.x+e.points[g][0],e.y+e.points[g][1])),m=n.map(h=>({...h,start:j(e.x+(h.start[0]-t[0][0]),e.y+(h.start[1]-t[0][1])),end:j(e.x+(h.end[0]-t[0][0]),e.y+(h.end[1]-t[0][1]))})),p=[],f=2+(d?1:0),E=2+(c?1:0);for(;p.length+f<u.length-E;)p.push(u[p.length+f]);{let h=u.at(d?2:1),g=u.at(d?3:2);if(!h||!g)throw new Error(`Second and third points must exist when handling endpoint drag (${d})`);let x=Oe(i),w=Oe(Dt(Cr(h,g)));if(a&&x===w){let b=x?ue(i,me):ue(i,we);if(p.unshift(j(w?r[0]+(b?te:-te):g[0],w?g[1]:r[1]+(b?te:-te))),p.unshift(j(x?r[0]+(b?te:-te):r[0],x?r[1]:r[1]+(b?te:-te))),!d){d=!0;for(let y of m)y.index>1&&(y.index+=1)}}else if(p.unshift(j(w?r[0]:h[0],w?h[1]:r[1])),d){d=!1;for(let b of m)b.index>1&&(b.index-=1)}p.unshift(r)}{let h=u.at(u.length-(c?3:2)),g=u.at(u.length-(c?4:3));if(!h||!g)throw new Error(`Second and third to last points must exist when handling endpoint drag (${c})`);let x=Oe(o),w=nt(g,h);if(l&&x===w){let b=x?ue(o,me):ue(o,we);p.push(j(w?s[0]+(b?te:-te):g[0],w?g[1]:s[1]+(b?te:-te))),p.push(j(x?s[0]+(b?te:-te):s[0],x?s[1]:s[1]+(b?te:-te))),c||(c=!0)}else p.push(j(w?s[0]:h[0],w?h[1]:s[1])),c&&(c=!1)}return p.push(s),Bt(p,m.map(({index:h})=>({index:h,start:p[h-1],end:p[h]})).map(h=>({...h,start:j(h.start[0]-r[0],h.start[1]-r[1]),end:j(h.end[0]-r[0],h.end[1]-r[1])})),d,c)},Kt=1e6,Gn=(e,t,n,i)=>{if(e.points.length<2)return{points:n.points??e.points};v.PROD||(Cn(!n.points||n.points.length>=2,"Updated point array length must match the arrow point length, contain exactly the new start and end points or not be specified at all (i.e. you can't add new points between start and end manually to elbow arrows)"),Cn(!e.fixedSegments||e.fixedSegments.map(y=>y.start[0]===y.end[0]||y.start[1]===y.end[1]).every(Boolean),"Fixed segments must be either horizontal or vertical"),Cn(!n.fixedSegments||n.fixedSegments.map(y=>y.start[0]===y.end[0]||y.start[1]===y.end[1]).every(Boolean),"Updates to fixed segments must be either horizontal or vertical"),Cn(e.points.slice(1).map((y,I)=>y[0]===e.points[I][0]||y[1]===e.points[I][1]),"Elbow arrow segments must be either horizontal or vertical"),Cn(n.fixedSegments?.find(y=>y.index===1&&di(y.start,(n.points??e.points)[0]))==null&&n.fixedSegments?.find(y=>y.index===(n.points??e.points).length-1&&di(y.end,(n.points??e.points)[(n.points??e.points).length-1]))==null,"The first and last segments cannot be fixed"));let o=n.fixedSegments??e.fixedSegments??[],r=n.points?n.points&&n.points.length===2?e.points.map((y,I)=>I===0?n.points[0]:I===e.points.length-1?n.points[1]:y):n.points.slice():e.points.slice(),{startBinding:s,endBinding:a,...l}=n,d=typeof s<"u"?s:e.startBinding,c=typeof a<"u"?a:e.endBinding,u=d&&mo(d.elementId,t),m=c&&mo(c.elementId,t),p=Za(r);if(d&&!u&&p||c&&!m&&p||t.size===0&&p||Object.keys(l).length===0&&(u?.id!==d?.elementId||m?.id!==c?.elementId))return Bt(r.map(y=>j(e.x+y[0],e.y+y[1])),e.fixedSegments,e.startIsSpecial,e.endIsSpecial);let{startHeading:f,endHeading:E,startGlobalPoint:h,endGlobalPoint:g,hoveredStartElement:x,hoveredEndElement:w,...b}=Or({x:e.x,y:e.y,startBinding:d,endBinding:c,startArrowhead:e.startArrowhead,endArrowhead:e.endArrowhead,points:e.points},t,r,i);return t.size===0&&p?Bt(r.map(y=>j(e.x+y[0],e.y+y[1])),e.fixedSegments,e.startIsSpecial,e.endIsSpecial):!n.points&&!n.fixedSegments&&!n.startBinding&&!n.endBinding?Rm(e,t):n.startBinding===e.startBinding&&n.endBinding===e.endBinding&&(n.points??[]).every((y,I)=>di(y,e.points[I]??j(1/0,1/0)))&&p?{}:o.length===0?Bt(Rr(Fr(kr(e,{startHeading:f,endHeading:E,startGlobalPoint:h,endGlobalPoint:g,hoveredStartElement:x,hoveredEndElement:w,...b})??[])),o,null,null):(e.fixedSegments?.length??0)>o.length?Fm(e,o,t):n.points?n.points&&n.fixedSegments?n:Hm(e,r,o,f,E,h,g,x,w):Nm(e,o,f,E,x,w)},Or=(e,t,n,i)=>{let o=Lr(n[0],ut(e.x,e.y)),r=Lr(n[n.length-1],ut(e.x,e.y)),s=null,a=null;if(i?.isDragging){let y=Array.from(t.values());s=Wa(o,t,y,i?.zoom)||null,a=Wa(r,t,y,i?.zoom)||null}else s=e.startBinding&&mo(e.startBinding.elementId,t)||null,a=e.endBinding&&mo(e.endBinding.elementId,t)||null;let l=Xa({...e,angle:0,type:"arrow",elbowed:!0,points:n},"start",e.startBinding?.fixedPoint,o,s,t,i?.isDragging),d=Xa({...e,angle:0,type:"arrow",elbowed:!0,points:n},"end",e.endBinding?.fixedPoint,r,a,t,i?.isDragging),c=ja(l,d,s,o,t,i?.zoom),u=ja(d,l,a,r,t,i?.zoom),m=[l[0]-2,l[1]-2,l[0]+2,l[1]+2],p=[d[0]-2,d[1]-2,d[0]+2,d[1]+2],f=s?$e(s,t,Qt(c,e.startArrowhead?Lt(s,{elbowed:!0})*6:Lt(s,{elbowed:!0})*2,1)):m,E=a?$e(a,t,Qt(u,e.endArrowhead?Lt(a,{elbowed:!0})*6:Lt(a,{elbowed:!0})*2,1)):p,h=Zt(l,a?$e(a,t,Qt(u,te,te)):p)||Zt(d,s?$e(s,t,Qt(c,te,te)):m),g=$a(h?[m,p]:[f,E]),x=Um(h?m:f,h?p:E,g,h?Qt(c,!s&&!a?0:te,0):Qt(c,!s&&!a?0:te-(e.startArrowhead?Pn*6:Pn*2),te),h?Qt(u,!s&&!a?0:te,0):Qt(u,!s&&!a?0:te-(e.endArrowhead?Pn*6:Pn*2),te),h,s&&$e(s,t),a&&$e(a,t)),w=Ya(x[0],c,l),b=Ya(x[1],u,d);return{dynamicAABBs:x,startDonglePosition:w,startGlobalPoint:l,startHeading:c,endDonglePosition:b,endGlobalPoint:d,endHeading:u,commonBounds:g,hoveredStartElement:s,hoveredEndElement:a,boundsOverlap:h,startElementBounds:f,endElementBounds:E}},kr=(e,t)=>{let{dynamicAABBs:n,startDonglePosition:i,startGlobalPoint:o,startHeading:r,endDonglePosition:s,endGlobalPoint:a,endHeading:l,commonBounds:d,hoveredEndElement:c}=t,u=Ym(n,i||o,r,s||a,l,d),m=i&&uo(i,u),p=s&&uo(s,u),f=uo(a,u);f&&c&&(f.closed=!0);let E=uo(o,u);E&&e.startBinding&&(E.closed=!0);let h=m&&p&&(Zt(m.pos,n[1])||Zt(p.pos,n[0])),g=zm(m||E,p||f,u,r||me,l||me,h?[]:n);if(g){let x=g.map(w=>[w.pos[0],w.pos[1]]);return m&&x.unshift(o),p&&x.push(a),x}return null},Qt=(e,t,n)=>{switch(e){case _e:return[t,n,n,n];case me:return[n,t,n,n];case we:return[n,n,t,n]}return[n,n,n,t]},zm=(e,t,n,i,o,r)=>{let s=Dr(e.pos,t.pos),a=new Cm(l=>l.f);for(a.push(e);a.size()>0;){let l=a.pop();if(!l||l.closed)continue;if(l===t)return _m(e,l);l.closed=!0;let d=jm(l.addr,n);for(let c=0;c<4;c++){let u=d[c];if(!u||u.closed)continue;let m=Lm(u.pos,l.pos,.5);if(Gm(...r.map(b=>Zt(m,b))))continue;let p=Wm(c),f=l.parent?Dt(Cr(l.pos,l.parent.pos)):i,E=vr(f);if(ue(E,p)||Va(e.addr,u.addr)&&ue(p,i)||Va(t.addr,u.addr)&&ue(p,o))continue;let g=f!==p,x=l.g+Dr(u.pos,l.pos)+(g?Math.pow(s,3):0),w=u.visited;if(!w||x<u.g){let b=Xm(u,t,p,o);u.visited=!0,u.parent=l,u.h=Dr(t.pos,u.pos)+b*Math.pow(s,2),u.g=x,u.f=u.g+u.h,w?a.rescoreElement(u):a.push(u)}}}return null},_m=(e,t)=>{let n=t,i=[];for(;n.parent;)i.unshift(n),n=n.parent;return i.unshift(e),i},Dr=(e,t)=>Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1]),Um=(e,t,n,i,o,r,s,a)=>{let l=s??e,d=a??t,[c,u,m,p]=i??[0,0,0,0],[f,E,h,g]=o??[0,0,0,0],x=[e[0]>t[2]?e[1]>t[3]||e[3]<t[1]?Math.min((l[0]+d[2])/2,e[0]-p):(l[0]+d[2])/2:e[0]>t[0]?e[0]-p:n[0]-p,e[1]>t[3]?e[0]>t[2]||e[2]<t[0]?Math.min((l[1]+d[3])/2,e[1]-c):(l[1]+d[3])/2:e[1]>t[1]?e[1]-c:n[1]-c,e[2]<t[0]?e[1]>t[3]||e[3]<t[1]?Math.max((l[2]+d[0])/2,e[2]+u):(l[2]+d[0])/2:e[2]<t[2]?e[2]+u:n[2]+u,e[3]<t[1]?e[0]>t[2]||e[2]<t[0]?Math.max((l[3]+d[1])/2,e[3]+m):(l[3]+d[1])/2:e[3]<t[3]?e[3]+m:n[3]+m],w=[t[0]>e[2]?t[1]>e[3]||t[3]<e[1]?Math.min((d[0]+l[2])/2,t[0]-g):(d[0]+l[2])/2:t[0]>e[0]?t[0]-g:n[0]-g,t[1]>e[3]?t[0]>e[2]||t[2]<e[0]?Math.min((d[1]+l[3])/2,t[1]-f):(d[1]+l[3])/2:t[1]>e[1]?t[1]-f:n[1]-f,t[2]<e[0]?t[1]>e[3]||t[3]<e[1]?Math.max((d[2]+l[0])/2,t[2]+E):(d[2]+l[0])/2:t[2]<e[2]?t[2]+E:n[2]+E,t[3]<e[1]?t[0]>e[2]||t[2]<e[0]?Math.max((d[3]+l[1])/2,t[3]+h):(d[3]+l[1])/2:t[3]<e[3]?t[3]+h:n[3]+h],b=$a([x,w]);if(!r&&x[2]-x[0]+w[2]-w[0]>b[2]-b[0]+1e-11&&x[3]-x[1]+w[3]-w[1]>b[3]-b[1]+1e-11){let[y,I]=[(w[0]+w[2])/2,(w[1]+w[3])/2];if(t[0]>e[2]&&e[1]>t[3]){let S=x[2]+(w[0]-x[2])/2,A=w[3]+(x[1]-w[3])/2;return co(ut(e[2]-y,e[1]-I),ut(e[0]-y,e[3]-I))>0?[[x[0],x[1],S,x[3]],[S,w[1],w[2],w[3]]]:[[x[0],A,x[2],x[3]],[w[0],w[1],w[2],A]]}else if(e[2]<t[0]&&e[3]<t[1]){let S=x[2]+(w[0]-x[2])/2,A=x[3]+(w[1]-x[3])/2;return co(ut(e[0]-y,e[1]-I),ut(e[2]-y,e[3]-I))>0?[[x[0],x[1],x[2],A],[w[0],A,w[2],w[3]]]:[[x[0],x[1],S,x[3]],[S,w[1],w[2],w[3]]]}else if(e[0]>t[2]&&e[3]<t[1]){let S=w[2]+(x[0]-w[2])/2,A=x[3]+(w[1]-x[3])/2;return co(ut(e[2]-y,e[1]-I),ut(e[0]-y,e[3]-I))>0?[[S,x[1],x[2],x[3]],[w[0],w[1],S,w[3]]]:[[x[0],x[1],x[2],A],[w[0],A,w[2],w[3]]]}else if(e[0]>t[2]&&e[1]>t[3]){let S=w[2]+(x[0]-w[2])/2,A=w[3]+(x[1]-w[3])/2;return co(ut(e[0]-y,e[1]-I),ut(e[2]-y,e[3]-I))>0?[[S,x[1],x[2],x[3]],[w[0],w[1],S,w[3]]]:[[x[0],A,x[2],x[3]],[w[0],w[1],w[2],A]]}}return[x,w]},Ym=(e,t,n,i,o,r)=>{let s=new Set,a=new Set;n===Ge||n===me?a.add(t[1]):s.add(t[0]),o===Ge||o===me?a.add(i[1]):s.add(i[0]),e.forEach(c=>{s.add(c[0]),s.add(c[2]),a.add(c[1]),a.add(c[3])}),s.add(r[0]),s.add(r[2]),a.add(r[1]),a.add(r[3]);let l=Array.from(a).sort((c,u)=>c-u),d=Array.from(s).sort((c,u)=>c-u);return{row:l.length,col:d.length,data:l.flatMap((c,u)=>d.map((m,p)=>({f:0,g:0,h:0,closed:!1,visited:!1,parent:null,addr:[p,u],pos:[m,c]})))}},Ya=(e,t,n)=>{switch(t){case _e:return j(n[0],e[1]);case me:return j(e[2],n[1]);case we:return j(n[0],e[3])}return j(e[0],n[1])},Xm=(e,t,n,i)=>{if(i===me)switch(n){case me:return e.pos[0]>=t.pos[0]?4:e.pos[1]===t.pos[1]?0:2;case _e:return e.pos[1]>t.pos[1]&&e.pos[0]<t.pos[0]?1:3;case we:return e.pos[1]<t.pos[1]&&e.pos[0]<t.pos[0]?1:3;case Ge:return e.pos[1]===t.pos[1]?4:2}else if(i===Ge)switch(n){case me:return e.pos[1]===t.pos[1]?4:2;case _e:return e.pos[1]>t.pos[1]&&e.pos[0]>t.pos[0]?1:3;case we:return e.pos[1]<t.pos[1]&&e.pos[0]>t.pos[0]?1:3;case Ge:return e.pos[0]<=t.pos[0]?4:e.pos[1]===t.pos[1]?0:2}else if(i===_e)switch(n){case me:return e.pos[1]>t.pos[1]&&e.pos[0]<t.pos[0]?1:3;case _e:return e.pos[1]>=t.pos[1]?4:e.pos[0]===t.pos[0]?0:2;case we:return e.pos[0]===t.pos[0]?4:2;case Ge:return e.pos[1]>t.pos[1]&&e.pos[0]>t.pos[0]?1:3}else if(i===we)switch(n){case me:return e.pos[1]<t.pos[1]&&e.pos[0]<t.pos[0]?1:3;case _e:return e.pos[0]===t.pos[0]?4:2;case we:return e.pos[1]<=t.pos[1]?4:e.pos[0]===t.pos[0]?0:2;case Ge:return e.pos[1]<t.pos[1]&&e.pos[0]>t.pos[0]?1:3}return 0},jm=([e,t],n)=>[li([e,t-1],n),li([e+1,t],n),li([e,t+1],n),li([e-1,t],n)],li=([e,t],n)=>e<0||e>=n.col||t<0||t>=n.row?null:n.data[t*n.col+e]??null,uo=(e,t)=>{for(let n=0;n<t.col;n++)for(let i=0;i<t.row;i++){let o=li([n,i],t);if(o&&e[0]===o.pos[0]&&e[1]===o.pos[1])return o}return null},$a=e=>[Math.min(...e.map(t=>t[0])),Math.min(...e.map(t=>t[1])),Math.max(...e.map(t=>t[2])),Math.max(...e.map(t=>t[3]))],mo=(e,t)=>{let n=t.get(e);return n&&He(n)?n:null},Bt=(e,t,n,i)=>{let o=e[0][0],r=e[0][1],s=e.map(a=>Lr(a,Bm(Cr(e[0]),-1)));return(o<-Kt||o>Kt||r<-Kt||r>Kt||o+s[s.length-1][0]<-Kt||r+s[s.length-1][0]>Kt||o+s[s.length-1][1]<-Kt||r+s[s.length-1][1]>Kt)&&console.error("Elbow arrow normalization is outside reasonable bounds (> 1e6)",{x:o,y:r,points:s,...Ua(s)}),s=s.map(([a,l])=>j(lo(a,-1e6,1e6),lo(l,-1e6,1e6))),{points:s,x:lo(o,-1e6,1e6),y:lo(r,-1e6,1e6),fixedSegments:(t?.length??0)>0?t:null,...Ua(s),startIsSpecial:n,endIsSpecial:i}},Rr=e=>{if(e.length>1){let t=Math.abs(e[0][1]-e[1][1])<Math.abs(e[0][0]-e[1][0]);return e.filter((n,i)=>{if(i===0||i===e.length-1)return!0;let o=e[i+1],r=Math.abs(n[1]-o[1])<Math.abs(n[0]-o[0]);return t===r?(t=r,!1):(t=r,!0)})}return e},Fr=e=>e.length>=4?e.filter((t,n)=>{if(n===0||n===e.length-1)return!0;let i=e[n-1];return Br(i,t)>Gr}):e,Wm=e=>{switch(e){case 0:return _e;case 1:return me;case 2:return we}return Ge},Xa=(e,t,n,i,o,r,s)=>s?o&&r?po(e,o,t,r):i:o?Jt(n||[0,0],o,r??km([o])):i,ja=(e,t,n,i,o,r)=>qa(e,t,n,n&&$e(n,o,Array(4).fill(yn(n,o,e))),i,o,r),Wa=(e,t,n,i)=>vt(e,n,t,o=>ci(i)),Va=(e,t)=>e[0]===t[0]&&e[1]===t[1],Za=(e,t=Gr)=>e.slice(1).map((n,i)=>Math.abs(n[0]-e[i][0])<t||Math.abs(n[1]-e[i][1])<t).every(Boolean);var ye=(e,t,n,i)=>{let o=!1,{points:r,fixedSegments:s,fileId:a}=n;X(e)&&(Object.keys(n).length===0||typeof r<"u"||typeof s<"u")?n={...n,angle:0,...Gn({...e,x:n.x||e.x,y:n.y||e.y},t,n,i)}:typeof r<"u"&&(n={...Vm(r),...n});for(let l in n){let d=n[l];if(typeof d<"u"){if(e[l]===d&&(typeof d!="object"||d===null||l==="groupIds"||l==="scale"))continue;if(l==="scale"){let c=e[l],u=d;if(c[0]===u[0]&&c[1]===u[1])continue}else if(l==="points"){let c=e[l],u=d;if(c.length===u.length){let m=!1,p=c.length;for(;--p;){let f=c[p],E=u[p];if(f[0]!==E[0]||f[1]!==E[1]){m=!0;break}}if(!m)continue}}e[l]=d,o=!0}}return o&&((typeof n.height<"u"||typeof n.width<"u"||typeof a<"u"||typeof r<"u")&&Me.delete(e),e.version=n.version??e.version+1,e.versionNonce=n.versionNonce??Nr(),e.updated=Hr()),e},ge=(e,t,n=!1)=>{let i=!1;for(let o in t){let r=t[o];if(typeof r<"u"){if(e[o]===r&&(typeof r!="object"||r===null))continue;i=!0}}return!i&&!n?e:{...e,...t,version:t.version??e.version+1,versionNonce:t.versionNonce??Nr(),updated:Hr()}},Ka=(e,t)=>(e.version=(t??e.version)+1,e.versionNonce=Nr(),e.updated=Hr(),e);var tl=10,Pn=5,Lt=(e,t)=>(t.elbowed?Pn:tl)+e.strokeWidth/2,ci=e=>{let t=Math.max(tl,15),n=e?.value&&e.value<1?e.value:1;return zr(t/(n*1.5),t,t*2)},by=e=>!e[$m.CTRL_OR_CMD],fi=e=>e.isBindingEnabled,nl=(e,t,n,i,o,r,s)=>{let{start:a,end:l}=_r(e,t,n,i,o.getNonDeletedElementsMap(),o.getNonDeletedElements(),r,{...s,finalize:!0});if(Qa(e,a,"start",o),Qa(e,l,"end",o),a.focusPoint||l.focusPoint){let d=new Map;a.focusPoint&&d.set(0,{point:Fn(e,"startBinding",e.startBinding,a.element,o.getNonDeletedElementsMap())||e.points[0]}),l.focusPoint&&d.set(e.points.length-1,{point:Fn(e,"endBinding",e.endBinding,l.element,o.getNonDeletedElementsMap())||e.points[e.points.length-1]}),R.movePoints(e,o,d)}return{start:a,end:l}},Qa=(e,{mode:t,element:n,focusPoint:i},o,r)=>{t===null?Ze(e,o,r):t!==void 0&&go(e,n,t,o,r,i)},il=(e,t,n,i,o)=>{it(t.size===1,"Bound elbow arrows cannot be moved");let r=t.entries().next().value;it(r,"There should be a position update for dragging an elbow arrow endpoint");let[s,{point:a}]=r,l=R.getPointGlobalCoordinates(e,a,n),d=vt(l,i,n,m=>ci(o)),c=d?{element:d,mode:"orbit",focusPoint:R.getPointAtIndexGlobalCoordinates(e,s,n)}:{mode:null},u={mode:void 0};return s===0?{start:c,end:u}:{start:u,end:c}},Qm=(e,t,n,i,o,r,s,a,l,d,c)=>{let u={mode:void 0},m={mode:void 0},p=e.points.length>2,f=R.getPointGlobalCoordinates(e,t.get(o?s:a).point,n),E=vt(f,i,n);if(o)return E?u={element:E,mode:"inside",focusPoint:f}:u={mode:null},{start:u,end:m};if(r){let h=l?.selectedLinearElement?.initialState.origin;if(E&&e.startBinding?.elementId===E.id){let g=ne(E.x+E.width/2,E.y+E.height/2);return{start:p?{mode:void 0}:{mode:"inside",element:E,focusPoint:h??g},end:p?{mode:"orbit",element:E,focusPoint:f}:{mode:"inside",element:E,focusPoint:f}}}if(E&&e.startBinding){let g=e.startBinding;if(no(f,i,n).find(w=>w.id===g.elementId)){let w=n.get(e.startBinding.elementId);return it(w,"Other element must be in the elements map"),{start:p?{mode:void 0}:{mode:w.id!==E.id?"orbit":"inside",element:w,focusPoint:h??ne(e.x,e.y)},end:{mode:"orbit",element:E,focusPoint:f}}}}if(e.startBinding&&e.startBinding.elementId!==E?.id){let g=n.get(e.startBinding.elementId);it(g,"Other element must be in the elements map");let w={mode:!!l.selectedLinearElement?.initialState.arrowStartIsInside?"inside":"orbit",element:g,focusPoint:c?fe(g,n):h??ne(e.x,e.y)},b=E&&Ar(g,E,n),y;if(E){let I=d==="inside"||d==="skip";y={mode:I&&!b?"inside":"orbit",element:E,focusPoint:f}}else y={mode:null};return{start:p?{mode:void 0}:w,end:y}}if(!e.startBinding)return E?m={mode:d==="inside"||d==="skip"?"inside":"orbit",element:E,focusPoint:f}:m={mode:null},{start:u,end:m}}it(!1,"New arrow creation should not reach here")},Ja=(e,t,n,i,o,r,s,a)=>{let l={mode:void 0},d={mode:void 0},c=s.points.length>2,u=vt(e,o,i),m=n?no(e,o,i).some(h=>h.id===n.elementId):!1,p=n?i.get(n.elementId):null,f=m&&p?qm(p.backgroundColor):!1,E=u&&p&&Ar(p,u,i);return r==="inside"||r==="skip"?(l=u?{element:!m||!p||f?u:p,focusPoint:e,mode:"inside"}:{mode:null},d=a&&u&&u.id===n?.elementId?{mode:null}:d,{current:l,other:d}):u?u.id===t?.elementId&&t.mode==="inside"?{current:{mode:"inside",focusPoint:e,element:u},other:d}:n?n.elementId===u.id?n.mode==="orbit"?(l={element:u,mode:"orbit",focusPoint:e},d={mode:a?null:void 0},{current:l,other:c?{mode:void 0}:d}):(l={element:u,mode:"inside",focusPoint:e},{current:l,other:c?{mode:void 0}:d}):(m&&p&&!f?l={element:p,mode:"inside",focusPoint:e}:l={element:u,mode:"orbit",focusPoint:e},{current:l,other:c?{mode:void 0}:d}):(l={element:u,mode:"orbit",focusPoint:e},{current:l,other:c?{mode:void 0}:d}):{current:{mode:null},other:d}},_r=(e,t,n,i,o,r,s,a)=>Zm("COMPLEX_BINDINGS")?ep(e,t,o,r,s,a):Jm(e,t,n,i,o,r,s,a),Jm=(e,t,n,i,o,r,s,a)=>{let d=e.points.length-1,c=t.has(0),u=t.has(d),m={mode:void 0},p={mode:void 0};if(it(e.points.length>1,"Do not attempt to bind linear elements with a single point"),!c&&!u)return{start:m,end:p};if(c&&u)return{start:{mode:null},end:{mode:null}};if(!fi(s))return m=c?{mode:null}:m,p=u?{mode:null}:p,{start:m,end:p};if(X(e))return il(e,t,o,r,a?.zoom);let f=c?e.endBinding:e.startBinding,E=t.get(c?0:d)?.point;it(E,`Local point must be defined for ${c?"start":"end"} dragging`);let h=R.getPointGlobalCoordinates(e,E,o),g=vt(h,r,o,M=>ci(s.zoom)),x=g&&(a?.angleLocked?St(ne(n,i),g,o):St(h,g,o)),w=f?o.get(f.elementId):void 0,b=f&&w&&Jt(f.fixedPoint,w,o),y=w&&b&&St(b,w,o);if(f&&f.elementId===g?.id)return it(!a?.newArrow||s.selectedLinearElement?.initialState.origin,"appState.selectedLinearElement.initialState.origin must be defined for new arrows"),{start:{mode:"inside",element:g,focusPoint:c?h:a?.newArrow?s.selectedLinearElement.initialState.origin:R.getPointAtIndexGlobalCoordinates(e,0,o)},end:{mode:"inside",element:g,focusPoint:u?h:R.getPointAtIndexGlobalCoordinates(e,-1,o)}};if(a?.altKey)return{start:c?g?{mode:"inside",element:g,focusPoint:h}:{mode:null}:m,end:u?g?{mode:"inside",element:g,focusPoint:h}:{mode:null}:p};let I=g?x?{mode:"inside",element:g,focusPoint:h}:{mode:"orbit",element:g,focusPoint:fr(e,h,g,c?"start":"end",o)||h}:{mode:null},S=R.getPointAtIndexGlobalCoordinates(e,c?-1:0,o),A=w&&!y&&s.selectedLinearElement?.initialState.altFocusPoint?{mode:"orbit",element:w,focusPoint:s.selectedLinearElement.initialState.altFocusPoint}:a?.angleLocked&&w?{mode:"orbit",element:w,focusPoint:fr(e,S,w,c?"end":"start",o)||S}:{mode:void 0};return{start:c?I:A,end:u?I:A}},ep=(e,t,n,i,o,r)=>{let s=o.bindMode||"orbit",a=0,l=e.points.length-1,d=t.has(a),c=t.has(l),u={mode:void 0},m={mode:void 0};if(it(e.points.length>1,"Do not attempt to bind linear elements with a single point"),!d&&!c)return{start:u,end:m};if(d&&c)return{start:{mode:null},end:{mode:null}};if(!fi(o))return u=d?{mode:null}:u,m=c?{mode:null}:m,{start:u,end:m};if(X(e))return il(e,t,n,i);if(r?.newArrow){let{start:p,end:f}=Qm(e,t,n,i,d,c,a,l,o,s,r?.shiftKey);return{start:p,end:f}}if(d){let p=t.get(a)?.point;it(p,"Local point must be defined for start dragging");let f=R.getPointGlobalCoordinates(e,p,n),{current:E,other:h}=Ja(f,e.startBinding,e.endBinding,n,i,s,e,r?.finalize);return{start:E,end:h}}if(c){let p=t.get(l)?.point;it(p,"Local point must be defined for end dragging");let f=R.getPointGlobalCoordinates(e,p,n),{current:E,other:h}=Ja(f,e.endBinding,e.startBinding,n,i,s,e,r?.finalize);return{start:h,end:E}}return{start:u,end:m}},Py=(e,t,n)=>{e.forEach(i=>{nl(i,new Map,1/0,1/0,t,n)})},go=(e,t,n,i,o,r)=>{let s=o.getNonDeletedElementsMap(),a;X(e)?a={elementId:t.id,mode:"orbit",...sp(e,t,i,s)}:a={elementId:t.id,mode:n,...xo(e,t,i,s,r)},o.mutateElement(e,{[i==="start"?"startBinding":"endBinding"]:a}),el(t.boundElements||[]).has(e.id)||o.mutateElement(t,{boundElements:(t.boundElements||[]).concat({id:e.id,type:"arrow"})})},Ze=(e,t,n)=>{let i=t==="start"?"startBinding":"endBinding",o=e[i];if(o==null)return null;let r=e[t==="start"?"endBinding":"startBinding"];if(!r||r.elementId!==o.elementId){let s=n.getNonDeletedElementsMap().get(o.elementId);n.mutateElement(s,{boundElements:s.boundElements?.filter(a=>a.id!==e.id)})}return n.mutateElement(e,{[i]:null}),o.elementId},Ue=(e,t,n)=>{if(!He(e))return;let{simultaneouslyUpdated:i}=n??{},o=np(i),r=t.getNonDeletedElementsMap();n?.changedElements&&(r=new Map(r),n.changedElements.forEach(s=>{r.set(s.id,s)})),ho(r,e,s=>{if(!H(s)||s.isDeleted||!tp(s,e))return;let a=s.startBinding?r.get(s.startBinding.elementId):null,l=s.endBinding?a?.id===s.endBinding.elementId?a:r.get(s.endBinding.elementId):null;if(o.has(s.id))return;let d=Eo(r,s,(u,m)=>{if(u&&He(u)&&(m==="startBinding"||m==="endBinding")&&(e.id===s[m]?.elementId||e.id===s[m==="startBinding"?"endBinding":"startBinding"]?.elementId)){let p=Fn(s,m,s[m],u,r);if(p)return[m==="startBinding"?0:s.points.length-1,{point:p}]}return null}).filter(u=>u!==null);R.movePoints(s,t,new Map(d),{moveMidPointsWithElement:!!a&&a?.id===l?.id});let c=V(s,r);c&&!c.isDeleted&&wn(s,t,!1)})},Iy=(e,t,n,i)=>{H(e)?nl(e,new Map,1/0,1/0,t,n):Ue(e,t,{...i,changedElements:new Map([[e.id,e]])})},tp=(e,t)=>e.startBinding?.elementId===t.id||e.endBinding?.elementId===t.id,np=e=>new Set((e||[]).map(t=>t.id)),qa=(e,t,n,i,o,r,s)=>{let a=Dt(Rn(t,e));return!n||!i?a:ip(o,n,r,s)?ai(n,i,e):Dt(Rn(e,fe(n,r)))},ip=(e,t,n,i)=>{let o=yn(t,n,e),r=ci(i);return o>r?null:o},po=(e,t,n,i,o)=>{let r=X(e),s=R.getPointAtIndexGlobalCoordinates(e,n==="start"?0:-1,i);if(e.points.length<2)return s;let a=sr(t)&&r?ol(e,t,i,s):s,l=o&&!r?o[1]:R.getPointAtIndexGlobalCoordinates(e,n==="start"?1:-2,i),d=Lt(t,e),c=$e(t,i),u=ct(c),m=null;if(r){let p=Oe(ai(t,c,s)),f=op(e,t,i,a),E=ne(p?u[0]:f[0],p?f[1]:u[1]),h=o??mi(E,On(kn(fo(Rn(f,E)),Math.max(t.width,t.height)*2),E));if(m=$t(t,i,h,d).sort(ui)[0],!m){let g=ne(p?f[0]:u[0],p?u[1]:f[1]),x=mi(g,On(kn(fo(Rn(f,g)),Math.max(t.width,t.height)*2),g));m=$t(t,i,x,Pn).sort(ui)[0]}}else{let p=o;if(!p){let f=kn(fo(Rn(a,l)),Ct(a,l)+Math.max(t.width,t.height)+d*2);p=o??mi(On(f,l),On(kn(f,-1),l))}m=Ct(a,l)<1?a:$t(t,i,p,d).sort((f,E)=>ui(f,l)-ui(E,l))[0]}return!m||ui(a,m)<Km?a:m},ol=(e,t,n,i)=>{let o=fe(t,n),r=pe(i,o,-t.angle),s=Lt(t,e);return r[0]<t.x&&r[1]<t.y?r[1]-t.y>-s?pe(ne(t.x-s,t.y),o,t.angle):pe(ne(t.x,t.y-s),o,t.angle):r[0]<t.x&&r[1]>t.y+t.height?r[0]-t.x>-s?pe(ne(t.x,t.y+t.height+s),o,t.angle):pe(ne(t.x-s,t.y+t.height),o,t.angle):r[0]>t.x+t.width&&r[1]>t.y+t.height?r[0]-t.x<t.width+s?pe(ne(t.x+t.width,t.y+t.height+s),o,t.angle):pe(ne(t.x+t.width+s,t.y+t.height),o,t.angle):r[0]>t.x+t.width&&r[1]<t.y?r[0]-t.x<t.width+s?pe(ne(t.x+t.width,t.y-s),o,t.angle):pe(ne(t.x+t.width+s,t.y),o,t.angle):i},op=(e,t,n,i,o=.05)=>{let{x:r,y:s,width:a,height:l,angle:d}=t,c=fe(t,n,-.1,-.1),u=pe(i,c,-d),m=Lt(t,e),p=zr(o*l,5,80),f=zr(o*a,5,80);if(Ct(c,u)<m)return i;if(u[0]<=r+a/2&&u[1]>c[1]-p&&u[1]<c[1]+p)return pe(ne(r-m,c[1]),c,d);if(u[1]<=s+l/2&&u[0]>c[0]-f&&u[0]<c[0]+f)return pe(ne(c[0],s-m),c,d);if(u[0]>=r+a/2&&u[1]>c[1]-p&&u[1]<c[1]+p)return pe(ne(r+a+m,c[1]),c,d);if(u[1]>=s+l/2&&u[0]>c[0]-f&&u[0]<c[0]+f)return pe(ne(c[0],s+l+m),c,d);if(t.type==="diamond"){let E=m,h=ne(r+a/4-E,s+l/4-E),g=ne(r+3*a/4+E,s+l/4-E),x=ne(r+a/4-E,s+3*l/4+E),w=ne(r+3*a/4+E,s+3*l/4+E);if(Ct(h,u)<Math.max(f,p))return pe(h,c,d);if(Ct(g,u)<Math.max(f,p))return pe(g,c,d);if(Ct(x,u)<Math.max(f,p))return pe(x,c,d);if(Ct(w,u)<Math.max(f,p))return pe(w,c,d)}return i},rp=(e,t)=>t.width**2+t.height**2-(e.width**2+e.height**2),Fn=(e,t,n,i,o,r)=>{if(n==null||n.elementId!==i.id&&e.points.length>2)return null;let s=Jt(wo(n.fixedPoint),i,o),a=t==="startBinding"?0:e.points.length-1,l=X(e),d=t==="startBinding"?e.endBinding:e.startBinding,c=d&&o.get(d.elementId),u=se(i,o),m=c&&se(c,o),p=c&&rp(i,c)<(t==="endBinding"?1:0),f=m&&bn(u,m),E=!1;if(!f&&!l&&e.startBinding&&e.endBinding&&c&&e.points.length===2){let w=Jt(e.startBinding.fixedPoint,t==="startBinding"?i:c,o),b=Jt(e.endBinding.fixedPoint,t==="endBinding"?i:c,o),y=mi(w,b),I=$t(t==="endBinding"?i:c,o,y,0,!0),S=$t(t==="startBinding"?i:c,o,y,0,!0);I.length>0&&S.length>0&&(E=Ct(I[0],S[0])<40)}let h=(E||f)&&p,g=r;if(!l&&!g){let[w,b,y,I]=R.getElementAbsoluteCoords(e,o),S=ne((w+y)/2,(b+I)/2),A=sr(i)?ol(e,i,o,s):s,M=pe(ne(e.x+e.points[a===0?1:e.points.length-2][0],e.y+e.points[a===0?1:e.points.length-2][1]),S,e.angle),O=Lt(i,e),L=kn(fo(Rn(A,M)),Ct(A,M)+Math.max(i.width,i.height)+O*2);g=mi(On(L,M),On(kn(L,-1),M))}let x=n.mode==="orbit"&&i?h?s:po({...e,points:[a===0?R.createPointAt(e,o,s[0],s[1],null):e.points[0],...e.points.slice(1,-1),a===e.points.length-1?R.createPointAt(e,o,s[0],s[1],null):e.points[e.points.length-1]]},i,a===0?"start":"end",o,g):s;return R.createPointAt(e,o,x[0],x[1],null)},sp=(e,t,n,i)=>{let o=[t.x,t.y,t.x+t.width,t.y+t.height],r=po(e,t,n,i),s=ne(o[0]+(o[2]-o[0])/2,o[1]+(o[3]-o[1])/2),a=pe(r,s,-t.angle);return{fixedPoint:wo([(a[0]-t.x)/t.width,(a[1]-t.y)/t.height])}},xo=(e,t,n,i,o)=>{let r=o||R.getPointAtIndexGlobalCoordinates(e,n==="start"?0:-1,i),s=ne(t.x+t.width/2,t.y+t.height/2),a=pe(r,s,-t.angle),l=(a[0]-t.x)/t.width,d=(a[1]-t.y)/t.height;return{fixedPoint:wo([l,d])}},rl=(e,t,n)=>{for(let i of e){if("boundElements"in i&&i.boundElements&&Object.assign(i,{boundElements:i.boundElements.reduce((o,r)=>{let s=t.get(r.id);return s&&o.push({...r,id:s}),o},[])}),"containerId"in i&&i.containerId&&Object.assign(i,{containerId:t.get(i.containerId)??null}),"endBinding"in i&&i.endBinding){let o=t.get(i.endBinding.elementId);Object.assign(i,{endBinding:o?{...i.endBinding,elementId:o}:null})}if("startBinding"in i&&i.startBinding){let o=t.get(i.startBinding.elementId);Object.assign(i,{startBinding:o?{...i.startBinding,elementId:o}:null})}X(i)&&Object.assign(i,Gn(i,n,{points:[i.points[0],i.points[i.points.length-1]]}))}},Sy=(e,t)=>{let n=el(e);for(let i of t)en.unbindAffected(n,i,(o,r)=>ye(o,n,r)),tn.unbindAffected(n,i,(o,r)=>ye(o,n,r))},pi=(e,t,n=[])=>{if(!e)return null;let i=e.filter(o=>!t.has(o.id));return i.push(...n.map(o=>({id:o.id,type:o.type}))),i},sl=new Set(["boundElements","frameId","containerId","startBinding","endBinding"]),ho=(e,t,n)=>{He(t)&&(t.boundElements?.slice()??[]).forEach(({id:o})=>{n(e.get(o),"boundElements",o)})},Eo=(e,t,n)=>{let i=[];if(t.frameId){let o=t.frameId;i.push(n(e.get(o),"frameId",o))}if(le(t)){let o=t.containerId;i.push(n(e.get(o),"containerId",o))}if(H(t)){if(t.startBinding){let o=t.startBinding.elementId;i.push(n(e.get(o),"startBinding",o))}if(t.endBinding){let o=t.endBinding.elementId;i.push(n(e.get(o),"endBinding",o))}}return i},en=class{static unbindAffected(t,n,i){n&&Eo(t,n,o=>{!o||o.isDeleted||ho(t,o,(r,s,a)=>{a===n.id&&i(o,{boundElements:pi(o.boundElements,new Set([a]))})})})}static rebindAffected=(t,n,i)=>{!n||n.isDeleted||Eo(t,n,(o,r)=>{if(!o||o.isDeleted){i(n,{[r]:null});return}r!=="frameId"&&(o.boundElements?.find(s=>s.id===n.id)||(H(n)&&i(o,{boundElements:pi(o.boundElements,new Set,new Array(n))}),J(n)&&(o.boundElements?.find(s=>s.type==="text")?i(n,{[r]:null}):i(o,{boundElements:pi(o.boundElements,new Set,new Array(n))}))))})}},tn=class{static unbindAffected(t,n,i){n&&ho(t,n,o=>{!o||o.isDeleted||Eo(t,o,(r,s,a)=>{a===n.id&&i(o,{[s]:null})})})}static rebindAffected=(t,n,i)=>{!n||n.isDeleted||ho(t,n,(o,r,s)=>{if(!o||o.isDeleted){i(n,{boundElements:pi(n.boundElements,new Set([s]))});return}J(o)&&((n.boundElements?.slice()??[]).reverse().find(l=>l.type==="text")?.id===o.id?o.containerId!==n.id&&i(o,{containerId:n.id}):(o.containerId!==null&&i(o,{containerId:null}),i(n,{boundElements:pi(n.boundElements,new Set([o.id]))})))})}},Jt=(e,t,n)=>{let[i,o]=wo(e);return pe(ne(t.x+t.width*i,t.y+t.height*o),fe(t,n),t.angle)},ap=(e,t)=>{let n=e.startBinding&&t.get(e.startBinding.elementId),i=e.endBinding&&t.get(e.endBinding.elementId),o=n&&e.startBinding?Jt(e.startBinding.fixedPoint,n,t):ne(e.x+e.points[0][0],e.y+e.points[0][1]),r=i&&e.endBinding?Jt(e.endBinding.fixedPoint,i,t):ne(e.x+e.points[e.points.length-1][0],e.y+e.points[e.points.length-1][1]);return[o,r]},al=(e,t)=>{let[n,i]=ap(e,t);return[R.pointFromAbsoluteCoords(e,n,t),R.pointFromAbsoluteCoords(e,i,t)]},wo=e=>e&&(Math.abs(e[0]-.5)<1e-4||Math.abs(e[1]-.5)<1e-4)?e.map(t=>Math.abs(t-.5)<1e-4?.5001:t):e;var Ur=({points:e})=>{let t=e[0][0],n=e[0][1];return{points:e.map(i=>C(i[0]-t,i[1]-n)),offsetX:t,offsetY:n}},R=class e{elementId;selectedPointsIndices;initialState;isDragging;lastUncommittedPoint;lastCommittedPoint;pointerOffset;hoverPointIndex;segmentMidPointHoveredCoords;elbowed;customLineAngle;isEditing;pointerDownState;constructor(t,n,i=!1){this.elementId=t.id,dl(t.points[0],C(0,0))||(console.error("Linear element is not normalized",Error().stack),ye(t,n,e.getNormalizeElementPointsAndCoords(t))),this.selectedPointsIndices=null,this.lastUncommittedPoint=null,this.lastCommittedPoint=null,this.isDragging=!1,this.pointerOffset={x:0,y:0},this.initialState={prevSelectedPointsIndices:null,lastClickedPoint:-1,origin:null,segmentMidpoint:{value:null,index:null,added:!1},arrowStartIsInside:!1,altFocusPoint:null},this.hoverPointIndex=-1,this.segmentMidPointHoveredCoords=null,this.elbowed=X(t)&&t.elbowed,this.customLineAngle=null,this.isEditing=i}static POINT_HANDLE_SIZE=10;static getElement(t,n){let i=n.get(t);return i||null}static handleBoxSelection(t,n,i,o){if(!n.selectedLinearElement?.isEditing||!n.selectionElement)return!1;let{selectedLinearElement:r}=n,{selectedPointsIndices:s,elementId:a}=r,l=e.getElement(a,o);if(!l)return!1;let[d,c,u,m]=W(n.selectionElement,o),f=e.getPointsGlobalCoordinates(l,o).reduce((E,h,g)=>((h[0]>=d&&h[0]<=u&&h[1]>=c&&h[1]<=m||t.shiftKey&&s?.includes(g))&&E.push(g),E),[]).filter(E=>!(X(l)&&E!==0&&E!==l.points.length-1));i({selectedLinearElement:{...r,selectedPointsIndices:f.length?f:null}})}static handlePointerMove(t,n,i,o,r){let s=n.scene.getNonDeletedElementsMap(),a=n.scene.getNonDeletedElements(),{elementId:l}=r,d=e.getElement(l,s);Te(d,"Element being dragged must exist in the scene"),Te(d.points.length>1,"Element must have at least 2 points");let c=d.points.length-1,u=d.points[c],m=d.points[c-1],p=r.customLineAngle??El(m,d.points[c]),f=0,E=0;if(hi(t)){let[y,I]=e._getShiftLockedDelta(d,s,m,C(i,o),t[In.CTRL_OR_CMD]?null:n.getEffectiveGridSize(),p),S=C(y+m[0],I+m[1]);f=S[0]-u[0],E=S[1]-u[1]}else{let y=e.createPointAt(d,s,i-r.pointerOffset.x,o-r.pointerOffset.y,t[In.CTRL_OR_CMD]?null:n.getEffectiveGridSize());f=y[0]-u[0],E=y[1]-u[1]}let h=null,{positions:g,updates:x}=hl([c],f,E,i,o,s,d,a,n,hi(t),t.altKey);if(e.movePoints(d,n.scene,g,{startBinding:x?.startBinding,endBinding:x?.endBinding,moveMidPointsWithElement:x?.moveMidPointsWithElement}),Le(d,!1)&&fi(n.state)&&(h=x?.suggestedBinding??null),Le(d)&&pl(e.getPointGlobalCoordinates(d,d.points[d.points.length-1],s),d,a,s,n.scene),n.state.selectedLinearElement?.customLineAngle===p&&r.initialState.altFocusPoint&&(!h||mp(n.state.suggestedBinding??[],h)))return null;let w=Le(d)&&d.startBinding&&s.get(d.startBinding.elementId);return{selectedLinearElement:{...r,customLineAngle:p,initialState:{...r.initialState,altFocusPoint:!r.initialState.altFocusPoint&&w&&x?.suggestedBinding?.id!==w.id?fl(d,C(d.x,d.y),w,"start",s):r.initialState.altFocusPoint}},suggestedBinding:h}}static handlePointDragging(t,n,i,o,r){let s=n.scene.getNonDeletedElementsMap(),a=n.scene.getNonDeletedElements(),{elbowed:l,elementId:d,initialState:c}=r,u=Array.from(r.selectedPointsIndices??[]),{lastClickedPoint:m}=c,p=e.getElement(d,s);Te(p,"Element being dragged must exist in the scene"),Te(p.points.length>1,"Element must have at least 2 points"),Te(u,"There must be selected points in order to drag them"),l&&u.some((T,$)=>T>0&&T!==p.points.length-1?(u[$]=p.points.length-1,m=p.points.length-1,!0):!1),Te(m>-1&&u.includes(m)&&p.points[m],`There must be a valid lastClickedPoint in order to drag it. selectedPointsIndices(${JSON.stringify(u)}) points(0..${p.points.length-1}) lastClickedPoint(${m})`);let f=p.points[m],E=p.points[m===0?1:m-1],h=u.length===1,g=r.customLineAngle??El(E,p.points[m]),x=u.includes(0),w=u.includes(p.points.length-1),b=0,y=0;if(hi(t)&&h){let[T,$]=e._getShiftLockedDelta(p,s,E,C(i,o),t[In.CTRL_OR_CMD]?null:n.getEffectiveGridSize(),g),Z=C(T+E[0],$+E[1]);b=Z[0]-f[0],y=Z[1]-f[1]}else{let T=e.createPointAt(p,s,i-r.pointerOffset.x,o-r.pointerOffset.y,t[In.CTRL_OR_CMD]?null:n.getEffectiveGridSize());b=T[0]-f[0],y=T[1]-f[1]}let I=null,{positions:S,updates:A}=hl(u,b,y,i,o,s,p,a,n,hi(t)&&h,t.altKey);e.movePoints(p,n.scene,S,{startBinding:A?.startBinding,endBinding:A?.endBinding,moveMidPointsWithElement:A?.moveMidPointsWithElement}),Le(p,!1)&&fi(n.state)&&(x||w)&&(I=A?.suggestedBinding??null),Le(p)&&x!==w&&pl(e.getPointGlobalCoordinates(p,x?p.points[0]:p.points[p.points.length-1],s),p,a,s,n.scene),V(p,s)&&wn(p,n.scene,!1);let O=l?w?[p.points.length-1]:[0]:u,L=l?O[0]:m,G=!x&&!w?e.getPointGlobalCoordinates(p,f,s):null,B=L,U=Le(p)&&p.startBinding&&s.get(p.startBinding.elementId),N=Le(p)&&p.endBinding&&s.get(p.endBinding.elementId),Y=w&&U&&A?.suggestedBinding?.id!==U.id?U:x&&N&&A?.suggestedBinding?.id!==N.id?N:null;return{selectedLinearElement:{...r,selectedPointsIndices:O,initialState:{...r.initialState,lastClickedPoint:L,altFocusPoint:!r.initialState.altFocusPoint&&Le(p)&&Y?fl(p,C(p.x,p.y),Y,"start",s):r.initialState.altFocusPoint},segmentMidPointHoveredCoords:G,hoverPointIndex:B,isDragging:!0,customLineAngle:g},suggestedBinding:I}}static handlePointerUp(t,n,i,o){let r=o.getNonDeletedElementsMap(),{elementId:s,selectedPointsIndices:a,isDragging:l,initialState:d}=n,c=e.getElement(s,r);if(!c)return n;if(l&&a)for(let u of a)(u===0||u===c.points.length-1)&&pp(c.points,i.zoom.value)&&(bt(c)&&o.mutateElement(c,{...gl(c,!0)},{informMutation:!1,isDragging:!1}),e.movePoints(c,o,new Map([[u,{point:u===0?c.points[c.points.length-1]:c.points[0]}]])));return{...n,segmentMidPointHoveredCoords:null,hoverPointIndex:-1,selectedPointsIndices:l||t.shiftKey?!l&&t.shiftKey&&d.prevSelectedPointsIndices?.includes(d.lastClickedPoint)?a&&a.filter(u=>u!==d.lastClickedPoint):a:a?.includes(d.lastClickedPoint)?[d.lastClickedPoint]:a,isDragging:!1,pointerOffset:{x:0,y:0},customLineAngle:null,initialState:{...n.initialState,origin:null,arrowStartIsInside:!1}}}static getEditorMidPoints=(t,n,i)=>{let o=V(t,n);if(!X(t)&&!i.selectedLinearElement?.isEditing&&t.points.length>2&&!o)return[];let r=e.getPointsGlobalCoordinates(t,n),s=0,a=[];for(;s<r.length-1;){if(e.isSegmentTooShort(t,t.points[s],t.points[s+1],s,i.zoom)){a.push(null),s++;continue}let l=e.getSegmentMidPoint(t,s+1);a.push(l),s++}return a};static getSegmentMidpointHitCoords=(t,n,i,o)=>{let{elementId:r}=t,s=e.getElement(r,o);if(!s)return null;let a=e.getPointIndexUnderCursor(s,o,i.zoom,n.x,n.y);if(!X(s)&&a>=0||e.getPointsGlobalCoordinates(s,o).length>=3&&!i.selectedLinearElement?.isEditing&&!X(s))return null;let d=(e.POINT_HANDLE_SIZE+1)/i.zoom.value,c=t.segmentMidPointHoveredCoords;if(c&&nn(C(c[0],c[1]),C(n.x,n.y))<=d)return c;let u=0,m=e.getEditorMidPoints(s,o,i);for(;u<m.length;){if(m[u]!==null&&nn(m[u],C(n.x,n.y))<=d)return m[u];u++}return null};static isSegmentTooShort(t,n,i,o,r){if(X(t))return o>=0&&o<t.points.length?nn(n,i)*r.value<e.POINT_HANDLE_SIZE/2:!1;let s=nn(n,i);if(t.points.length>2&&t.roundness){let[a,l]=ml(t);Te(a.length===0&&l.length>0,"Only linears built out of curves are supported"),Te(a.length+l.length>=o,"Invalid segment index while calculating mid point"),s=dp(l[o])}return s*r.value<e.POINT_HANDLE_SIZE*4}static getSegmentMidPoint(t,n){if(X(t)){Te(t.points.length>=n,"Invalid segment index while calculating elbow arrow mid point");let r=ll(t.points[n-1],t.points[n]);return C(t.x+r[0],t.y+r[1])}let[i,o]=ml(t);if(Te(i.length===0&&o.length>0||i.length>0&&o.length===0,"Only linears built out of either segments or curves are supported"),Te(i.length+o.length>=n,"Invalid segment index while calculating mid point"),i.length){let r=i[n-1];return ll(r[0],r[1])}if(o.length){let r=o[n-1];return cp(r,.5)}Te(!1,"Invalid segment type while calculating mid point")}static getSegmentMidPointIndex(t,n,i,o){let r=e.getElement(t.elementId,o);if(!r)return-1;let s=e.getEditorMidPoints(r,o,n),a=0;for(;a<s.length;){if(e.arePointsEqual(i,s[a]))return a+1;a++}return-1}static handlePointerDown(t,n,i,o,r,s){let a=n.state,l=s.getNonDeletedElementsMap(),d={didAddPoint:!1,hitElement:null,linearElementEditor:null};if(!r)return d;let{elementId:c}=r,u=e.getElement(c,l);if(!u)return d;let m=e.getSegmentMidpointHitCoords(r,o,a,l),p=C(o.x,o.y),f=null;if(m)f=e.getSegmentMidPointIndex(r,a,m,l);else if(t.altKey&&a.selectedLinearElement?.isEditing)return r.lastUncommittedPoint==null&&(s.mutateElement(u,{points:[...u.points,e.createPointAt(u,l,o.x,o.y,t[In.CTRL_OR_CMD]?null:n.getEffectiveGridSize())]}),d.didAddPoint=!0),i.scheduleCapture(),d.linearElementEditor={...r,initialState:{prevSelectedPointsIndices:r.selectedPointsIndices,lastClickedPoint:-1,origin:p,segmentMidpoint:{value:m,index:f,added:!1},arrowStartIsInside:!!n.state.newElement&&(n.state.bindMode==="inside"||n.state.bindMode==="skip"),altFocusPoint:null},selectedPointsIndices:[u.points.length-1],lastUncommittedPoint:null},d.didAddPoint=!0,d;let E=e.getPointIndexUnderCursor(u,l,a.zoom,o.x,o.y);(E>=0||m)&&(d.hitElement=u);let[h,g,x,w]=W(u,l),b=(h+x)/2,y=(g+w)/2,I=E>-1&&Ae(C(u.x+u.points[E][0],u.y+u.points[E][1]),C(b,y),u.angle),S=E>-1||t.shiftKey?t.shiftKey||r.selectedPointsIndices?.includes(E)?fp([...r.selectedPointsIndices||[],E]):[E]:null;return d.linearElementEditor={...r,initialState:{prevSelectedPointsIndices:r.selectedPointsIndices,lastClickedPoint:E,origin:p,segmentMidpoint:{value:m,index:f,added:!1},arrowStartIsInside:!!n.state.newElement&&(n.state.bindMode==="inside"||n.state.bindMode==="skip"),altFocusPoint:null},selectedPointsIndices:S,pointerOffset:I?{x:o.x-I[0],y:o.y-I[1]}:{x:0,y:0}},d}static arePointsEqual(t,n){return!t&&!n?!0:!t||!n?!1:dl(t,n)}static handlePointerMoveInEditMode(t,n,i,o){let r=o.state;if(!r.selectedLinearElement?.isEditing)return null;let{elementId:s,lastUncommittedPoint:a}=r.selectedLinearElement,l=o.scene.getNonDeletedElementsMap(),d=e.getElement(s,l);if(!d)return r.selectedLinearElement;let{points:c}=d,u=c[c.length-1];if(!t.altKey)return u===a&&e.deletePoints(d,o,[c.length-1]),r.selectedLinearElement?.lastUncommittedPoint?{...r.selectedLinearElement,lastUncommittedPoint:null}:r.selectedLinearElement;let m;if(hi(t)&&c.length>=2){let p=c[c.length-2],[f,E]=e._getShiftLockedDelta(d,l,p,C(n,i),t[In.CTRL_OR_CMD]?null:o.getEffectiveGridSize());m=C(f+p[0],E+p[1])}else m=e.createPointAt(d,l,n-r.selectedLinearElement.pointerOffset.x,i-r.selectedLinearElement.pointerOffset.y,t[In.CTRL_OR_CMD]||X(d)?null:o.getEffectiveGridSize());return u===a?e.movePoints(d,o.scene,new Map([[d.points.length-1,{point:m}]])):e.addPoints(d,o.scene,[m]),{...r.selectedLinearElement,lastUncommittedPoint:d.points[d.points.length-1]}}static getPointGlobalCoordinates(t,n,i){let[o,r,s,a]=W(t,i),l=(o+s)/2,d=(r+a)/2,{x:c,y:u}=t;return Ae(C(c+n[0],u+n[1]),C(l,d),t.angle)}static getPointsGlobalCoordinates(t,n){let[i,o,r,s]=W(t,n),a=(i+r)/2,l=(o+s)/2;return t.points.map(d=>{let{x:c,y:u}=t;return Ae(C(c+d[0],u+d[1]),C(a,l),t.angle)})}static getPointAtIndexGlobalCoordinates(t,n,i){let o=n<0?t.points.length+n:n,[,,,,r,s]=W(t,i),a=C(r,s),l=t.points[o],{x:d,y:c}=t;return l?Ae(C(d+l[0],c+l[1]),a,t.angle):Ae(C(d,c),a,t.angle)}static pointFromAbsoluteCoords(t,n,i){if(X(t))return C(n[0]-t.x,n[1]-t.y);let[o,r,s,a]=W(t,i),l=(o+s)/2,d=(r+a)/2,[c,u]=Ae(C(n[0],n[1]),C(l,d),-t.angle);return C(c-t.x,u-t.y)}static getPointIndexUnderCursor(t,n,i,o,r){let s=e.getPointsGlobalCoordinates(t,n),a=s.length;for(;--a>-1;){let l=s[a];if(nn(C(o,r),C(l[0],l[1]))*i.value<e.POINT_HANDLE_SIZE+1)return a}return-1}static createPointAt(t,n,i,o,r){let s=ul(i,o,r),[a,l,d,c]=W(t,n),u=(a+d)/2,m=(l+c)/2,[p,f]=Ae(C(s[0],s[1]),C(u,m),-t.angle);return C(p-t.x,f-t.y)}static getNormalizeElementPointsAndCoords(t){let{points:n,offsetX:i,offsetY:o}=Ur(t);return{points:n,x:t.x+i,y:t.y+o}}static duplicateSelectedPoints(t,n){Te(t.selectedLinearElement?.isEditing,"Not currently editing a linear element");let i=n.getNonDeletedElementsMap(),{selectedPointsIndices:o,elementId:r}=t.selectedLinearElement,s=e.getElement(r,i);Te(s,"The linear element does not exist in the provided Scene"),Te(o!=null,"There are no selected points to duplicate");let{points:a}=s,l=[],d=!1,c=-1,u=a.reduce((m,p,f)=>{if(++c,m.push(p),o.includes(f)){let h=a[f+1];h||(d=!0),m.push(h?C((p[0]+h[0])/2,(p[1]+h[1])/2):C(p[0],p[1])),l.push(c+1),++c}return m},[]);if(n.mutateElement(s,{points:u}),d){let m=s.points[s.points.length-1];e.movePoints(s,n,new Map([[s.points.length-1,{point:C(m[0]+30,m[1]+30)}]]))}return{...t,selectedLinearElement:{...t.selectedLinearElement,selectedPointsIndices:l}}}static deletePoints(t,n,i){let o=n.state.selectedLinearElement?.isEditing&&n.state.selectedLinearElement?.lastUncommittedPoint===t.points[t.points.length-1],r=t.points.filter((c,u)=>!i.includes(u));bt(t)&&t.polygon&&(o||i.includes(0)||i.includes(t.points.length-1))&&(r[0]=C(r[r.length-1][0],r[r.length-1][1]));let{points:a,offsetX:l,offsetY:d}=Ur({points:r});e._updatePoints(t,n.scene,a,l,d)}static addPoints(t,n,i){let o=[...t.points,...i];bt(t)&&t.polygon&&(o[0]=C(o[o.length-1][0],o[o.length-1][1]));let{points:r,offsetX:s,offsetY:a}=Ur({points:o});e._updatePoints(t,n,r,s,a)}static movePoints(t,n,i,o){let{points:r}=t;if(bt(t)&&t.polygon){let c=i.get(0),u=i.get(r.length-1);c?i.set(r.length-1,{point:C(c.point[0],c.point[1]),isDragging:c.isDragging}):u&&i.set(0,{point:C(u.point[0],u.point[1]),isDragging:u.isDragging})}let s=i.get(0)?.point??C(0,0),[a,l]=s,d=X(t)?[i.get(0)?.point??r[0],i.get(r.length-1)?.point??r[r.length-1]]:r.map((c,u)=>{let m=i.get(u)?.point??c;return o?.moveMidPointsWithElement&&u!==0&&u!==r.length-1&&!i.has(u)?m:C(m[0]-a,m[1]-l)});e._updatePoints(t,n,d,a,l,o,{isDragging:Array.from(i.values()).some(c=>c.isDragging)})}static shouldAddMidpoint(t,n,i,o){let r=e.getElement(t.elementId,o);if(r&&X(r)||!r)return!1;let{segmentMidpoint:s}=t.initialState;if(s.added||s.value===null||s.index===null||t.initialState.origin===null)return!1;let a=t.initialState.origin,l=nn(a,C(n.x,n.y));return!(!i.selectedLinearElement?.isEditing&&l<up/i.zoom.value)}static addMidpoint(t,n,i,o,r){let s=r.getNonDeletedElementsMap(),a=e.getElement(t.elementId,s);if(!a)return;let{segmentMidpoint:l}=t.initialState,d={pointerDownState:t.initialState,selectedPointsIndices:t.selectedPointsIndices},c=e.createPointAt(a,s,n.x,n.y,o&&!X(a)?i.getEffectiveGridSize():null),u=[...a.points.slice(0,l.index),c,...a.points.slice(l.index)];return r.mutateElement(a,{points:u}),d.pointerDownState={...t.initialState,segmentMidpoint:{...t.initialState.segmentMidpoint,added:!0},lastClickedPoint:l.index},d.selectedPointsIndices=[l.index],d}static _updatePoints(t,n,i,o,r,s,a){if(X(t)){let l={};s?.startBinding!==void 0&&(l.startBinding=s.startBinding),s?.endBinding!==void 0&&(l.endBinding=s.endBinding),l.points=Array.from(i),n.mutateElement(t,l,{informMutation:!0,isDragging:a?.isDragging??!1})}else{let l=Yr(t,i),d=Yr(t,t.points),c=(l[0]+l[2])/2,u=(l[1]+l[3])/2,m=(d[0]+d[2])/2,p=(d[1]+d[3])/2,f=m-c,E=p-u,h=Ae(C(o,r),C(f,E),t.angle);n.mutateElement(t,{...s,points:i,x:t.x+h[0],y:t.y+h[1]})}}static _getShiftLockedDelta(t,n,i,o,r,s){let a=e.getPointGlobalCoordinates(t,i,n);if(X(t))return[o[0]-a[0],o[1]-a[1]];let[l,d]=ul(o[0],o[1],r),{width:c,height:u}=xl(a[0],a[1],l,d,s);return Ae(C(c,u),C(0,0),-t.angle)}static getBoundTextElementPosition=(t,n,i)=>{e.getPointsGlobalCoordinates(t,i).length<2&&ye(n,i,{isDeleted:!0});let r=0,s=0;if(t.points.length%2===1){let a=Math.floor(t.points.length/2),l=e.getPointGlobalCoordinates(t,t.points[a],i);r=l[0]-n.width/2,s=l[1]-n.height/2}else{let a=t.points.length/2-1,l=e.getSegmentMidPoint(t,a+1);r=l[0]-n.width/2,s=l[1]-n.height/2}return{x:r,y:s}};static getMinMaxXYWithBoundText=(t,n,i,o)=>{let[r,s,a,l]=i,d=(r+a)/2,c=(s+l)/2,{x:u,y:m}=e.getBoundTextElementPosition(t,o,n),p=u+o.width,f=m+o.height,E=C(d,c),h=Ae(C(r,s),E,t.angle),g=Ae(C(a,s),E,t.angle),x=Ae(C(u,m),E,-t.angle),w=Ae(C(p,m),E,-t.angle),b=Ae(C(u,f),E,-t.angle),y=Ae(C(p,f),E,-t.angle);return h[0]<g[0]&&h[1]>=g[1]?(r=Math.min(r,b[0]),a=Math.max(a,Math.max(w[0],y[0])),s=Math.min(s,x[1]),l=Math.max(l,y[1])):h[0]>=g[0]&&h[1]>g[1]?(r=Math.min(r,y[0]),a=Math.max(a,Math.max(x[0],w[0])),s=Math.min(s,b[1]),l=Math.max(l,w[1])):h[0]>=g[0]?(r=Math.min(r,w[0]),a=Math.max(a,b[0]),s=Math.min(s,y[1]),l=Math.max(l,x[1])):h[1]<=g[1]&&(r=Math.min(r,Math.min(w[0],x[0])),a=Math.max(a,y[0]),s=Math.min(s,w[1]),l=Math.max(l,b[1])),[r,s,a,l,d,c]};static getElementAbsoluteCoords=(t,n,i=!1)=>{let o=Me.generateElementShape(t,null),r=wt(o[0]),[s,a,l,d]=gi(r),c=s+t.x,u=a+t.y,m=l+t.x,p=d+t.y,f=(c+m)/2,E=(u+p)/2,h=i&&V(t,n);return h?e.getMinMaxXYWithBoundText(t,n,[c,u,m,p],h):[c,u,m,p,f,E]};static moveFixedSegment(t,n,i,o,r){let s=r.getNonDeletedElementsMap(),a=e.getElement(t.elementId,s);if(!a||!X(a))return t;if(n&&n>0&&n<a.points.length){let l=Oe(Dt(lp(a.points[n],a.points[n-1]))),d=(a.fixedSegments??[]).reduce((p,f)=>(p[f.index]=f,p),{});d[n]={index:n,start:C(l?a.points[n-1][0]:i-a.x,l?o-a.y:a.points[n-1][1]),end:C(l?a.points[n][0]:i-a.x,l?o-a.y:a.points[n][1])};let c=Object.values(d).sort((p,f)=>p.index-f.index),u=c.map(p=>p.index).reduce((p,f)=>f<n?p+1:p,0);r.mutateElement(a,{fixedSegments:c});let m=C(a.x+(a.fixedSegments[u].start[0]+a.fixedSegments[u].end[0])/2,a.y+(a.fixedSegments[u].start[1]+a.fixedSegments[u].end[1])/2);return{...t,segmentMidPointHoveredCoords:m,initialState:{...t.initialState,segmentMidpoint:{added:!1,index:a.fixedSegments[u].index,value:m}}}}return t}static deleteFixedSegment(t,n,i){n.mutateElement(t,{fixedSegments:t.fixedSegments?.filter(o=>o.index!==i)})}},fp=e=>{let t=[...new Set(e.filter(n=>n!==null&&n!==-1))];return t=t.sort((n,i)=>n-i),t.length?t:null},hl=(e,t,n,i,o,r,s,a,l,d,c)=>{let u=new Map(e.map(Y=>[Y,{point:C(s.points[Y][0]+t,s.points[Y][1]+n),isDragging:!0}]));if(!H(s))return{positions:u};let m=e.includes(0),p=e.includes(s.points.length-1),{start:f,end:E}=_r(s,u,i,o,r,a,l.state,{newArrow:!!l.state.newElement,angleLocked:d,altKey:c});if(X(s))return{positions:u,updates:{suggestedBinding:m?f.element:p?E.element:null}};if(m===p)return{positions:u};let h={suggestedBinding:null};f.mode===null?h.startBinding=null:f.mode?(h.startBinding={elementId:f.element.id,mode:f.mode,...xo(s,f.element,"start",r,f.focusPoint)},m&&(h.startBinding.mode==="orbit"||!Ei("COMPLEX_BINDINGS"))&&(h.suggestedBinding=f.element)):m&&(h.suggestedBinding=l.state.suggestedBinding),E.mode===null?h.endBinding=null:E.mode?(h.endBinding={elementId:E.element.id,mode:E.mode,...xo(s,E.element,"end",r,E.focusPoint)},p&&(h.endBinding.mode==="orbit"||!Ei("COMPLEX_BINDINGS"))&&(h.suggestedBinding=E.element)):p&&(h.suggestedBinding=l.state.suggestedBinding);let g=m?C(s.points[0][0]+t,s.points[0][1]+n):s.points[0],x=p?C(s.points[s.points.length-1][0]+t,s.points[s.points.length-1][1]+n):s.points[s.points.length-1],w={...s,points:[g,...s.points.slice(1,-1),x],startBinding:h.startBinding===void 0?s.startBinding:h.startBinding===null?null:h.startBinding,endBinding:h.endBinding===void 0?s.endBinding:h.endBinding===null?null:h.endBinding},b=f.focusPoint&&E.focusPoint?cl(f.focusPoint,E.focusPoint):void 0,y=f.focusPoint&&E.focusPoint?cl(E.focusPoint,f.focusPoint):void 0,I=s.endBinding&&w.startBinding&&m&&w.startBinding.elementId===s.endBinding.elementId,S=s.startBinding&&w.endBinding&&p&&s.startBinding.elementId===w.endBinding.elementId,A=w.endBinding?E.element??r.get(w.endBinding.elementId):null,M=I?w.points[w.points.length-1]:S&&l.state.bindMode!=="inside"&&Ei("COMPLEX_BINDINGS")?w.points[0]:A&&Fn(s,"endBinding",w.endBinding,A,r,y)||w.points[w.points.length-1];w.points[w.points.length-1]=M;let O=w.startBinding?f.element??r.get(w.startBinding.elementId):null,L=S&&Ei("COMPLEX_BINDINGS")?w.points[0]:I&&l.state.bindMode!=="inside"&&Ei("COMPLEX_BINDINGS")?w.points[w.points.length-1]:O&&Fn(s,"startBinding",w.startBinding,O,r,b)||w.points[0],G=nn(M,w.points[w.points.length-1])!==0,B=nn(L,w.points[0])!==0,U=new Set(e);O&&B&&U.add(0),A&&G&&U.add(s.points.length-1);let N=Array.from(U);return{updates:h.startBinding||h.suggestedBinding?{startBinding:h.startBinding,suggestedBinding:h.suggestedBinding}:void 0,positions:new Map(N.map(Y=>[Y,Y===0?{point:L,isDragging:!0}:Y===s.points.length-1?{point:M,isDragging:!0}:u.get(Y)]))}},El=(e,t)=>Math.atan2(t[1]-e[1],t[0]-e[0]);P();import{arrayToMap as pt}from"@excalidraw/common";import{isPointWithinBounds as Rp,pointFrom as $r}from"@excalidraw/math";P();import{vectorCross as Pl,vectorFromPoint as yo}from"@excalidraw/math";function wl(e){return[Math.min(e[0][0],e[1][0]),Math.min(e[0][1],e[1][1]),Math.max(e[0][0],e[1][0]),Math.max(e[0][1],e[1][1])]}function hp(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}var Ep=1e-6;function yl(e,t){let n=yo(e[1],e[0]),i=yo(t,e[0]),o=Pl(n,i);return Math.abs(o)<Ep}function Xr(e,t){let n=yo(e[1],e[0]),i=yo(t,e[0]);return Pl(n,i)<0}function bl(e,t){return yl(e,t[0])||yl(e,t[1])||(Xr(e,t[0])?!Xr(e,t[1]):Xr(e,t[1]))}function Il(e,t){return hp(wl(e),wl(t))&&bl(e,t)&&bl(t,e)}P();import{arrayToMap as gp}from"@excalidraw/common";import{getElementBounds as xp}from"@excalidraw/element";import{isArrowElement as wp,isExcalidrawElement as yp,isFreeDrawElement as bp,isLinearElement as Pp,isTextElement as Ip}from"@excalidraw/element";import{rangeIncludesValue as bo,pointFrom as Gt,pointRotateRads as Sp,rangeInclusive as Po}from"@excalidraw/math";var Mp=e=>e.type==="diamond"?[Gt(e.width/2,0),Gt(e.width,e.height/2),Gt(e.width/2,e.height),Gt(0,e.height/2)]:[Gt(0,0),Gt(0+e.width,0),Gt(0+e.width,e.height),Gt(0,e.height)],Ap=e=>Pp(e)||bp(e)?e.points:Mp(e),Sl=e=>{let t=e.reduce((n,[i,o])=>(n.minY=Math.min(n.minY,o),n.minX=Math.min(n.minX,i),n.maxX=Math.max(n.maxX,i),n.maxY=Math.max(n.maxY,o),n),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0,cx:0,cy:0});return t.cx=(t.maxX+t.minX)/2,t.cy=(t.maxY+t.minY)/2,t},Al=e=>{let t=Ap(e),{cx:n,cy:i}=Sl(t),o=Gt(n,i),r=t.map(c=>Sp(c,o,e.angle)),{minX:s,minY:a,maxX:l,maxY:d}=Sl(r);return[s+e.x,a+e.y,l+e.x,d+e.y]},Ml=(e,t,n=!1)=>{let i=Al(e),o=t[0]<=i[0]&&t[2]>=i[2]&&t[1]<=i[1]&&t[3]>=i[3];return n?o?!0:i[0]<=t[0]&&i[2]>=t[2]&&i[1]<=t[1]&&i[3]>=t[3]:o},Tp=(e,t)=>{let n=Al(e);return(bo(n[0],Po(t[0],t[2]))||bo(t[0],Po(n[0],n[2])))&&(bo(n[1],Po(t[1],t[3]))||bo(t[1],Po(n[1],n[3])))},Tl=({elements:e,bounds:t,type:n,errorMargin:i=0})=>{yp(t)&&(t=xp(t,gp(e)));let o=[t[0]-i,t[1]-i,t[2]+i,t[3]+i],r=new Set;for(let s of e){if(r.has(s.id))continue;if(n==="overlap"?Tp(s,o):n==="inside"?Ml(s,o):Ml(s,o,!0)){if(r.add(s.id),s.boundElements)for(let l of s.boundElements)r.add(l.id);Ip(s)&&s.containerId&&r.add(s.containerId),wp(s)&&(s.startBinding&&r.add(s.startBinding.elementId),s.endBinding&&r.add(s.endBinding?.elementId))}}return e.filter(s=>r.has(s.id))};P();import{arrayToMap as Gp,isShallowEqual as Op}from"@excalidraw/common";P();var vp=(e,t,n)=>{let i=n.reduce((o,r)=>(r.groupIds.includes(e)&&(o[r.id]=!0),o),{});return Object.keys(i).length<2?t.selectedGroupIds[e]||t.editingGroupId===e?{selectedElementIds:t.selectedElementIds,selectedGroupIds:{...t.selectedGroupIds,[e]:!1},editingGroupId:null}:t:{editingGroupId:t.editingGroupId,selectedGroupIds:{...t.selectedGroupIds,[e]:!0},selectedElementIds:{...t.selectedElementIds,...i}}},vl=function(){let e=null,t=null,n=null,i=(r,s,a,l)=>{if(n!==void 0&&s===t&&r===e&&a.editingGroupId===n?.editingGroupId)return n;let d={};for(let m of r){let p=m.groupIds;if(a.editingGroupId){let f=p.indexOf(a.editingGroupId);f>-1&&(p=p.slice(0,f))}if(p.length>0){let f=p[p.length-1];d[f]=!0}}let c={},u=s.reduce((m,p)=>{if(p.isDeleted)return m;let f=p.groupIds.find(E=>d[E]);return f&&(m[p.id]=!0,Array.isArray(c[f])?c[f].push(p.id):c[f]=[p.id]),m},{});for(let m of Object.keys(c))c[m].length<2&&d[m]&&(d[m]=!1);return t=s,e=r,n={editingGroupId:a.editingGroupId,selectedGroupIds:d,selectedElementIds:jr({...a.selectedElementIds,...u},l)},n},o=(r,s,a,l)=>{let d=l?l.scene.getSelectedElements({selectedElementIds:r.selectedElementIds,elements:s}):mt(s,r);return d.length?i(d,s,r,a):{selectedGroupIds:{},editingGroupId:null,selectedElementIds:jr(r.selectedElementIds,a)}};return o.clearCache=()=>{t=null,e=null,n=null},o}(),Dp=(e,t)=>Wr(e,t)!=null,Wr=(e,t)=>t.groupIds.filter(n=>n!==e.editingGroupId).find(n=>e.selectedGroupIds[n]),Lp=e=>Object.entries(e.selectedGroupIds).filter(([t,n])=>n).map(([t,n])=>t),Dl=(e,t)=>{let n={...t,selectedGroupIds:{}};for(let i of e){let o=i.groupIds;if(t.editingGroupId){let r=o.indexOf(t.editingGroupId);r>-1&&(o=o.slice(0,r))}if(o.length>0){let r=o[o.length-1];n={...n,...vp(r,n,e)}}}return n.selectedGroupIds},eb=(e,t)=>({...e,editingGroupId:t.groupIds.length?t.groupIds[0]:null,selectedGroupIds:{},selectedElementIds:{[t.id]:!0}}),Bp=(e,t)=>e.groupIds.includes(t),ve=(e,t)=>{let n=[];for(let i of e.values())Bp(i,t)&&n.push(i);return n},Cp=(e,t)=>e.groupIds.find(n=>t[n]),tb=(e,t,n)=>{let i=[...e],o=n?i.indexOf(n):-1,r=o>-1?o:i.length;return i.splice(r,0,t),i},nb=(e,t)=>e.filter(n=>!t[n]),ib=(e,t)=>{let n=new Map;return e.forEach(i=>{let o=i.groupIds.length===0?i.id:i.groupIds[i.groupIds.length-1],r=n.get(o)||[],s=V(i,t);s&&r.push(s),n.set(o,[...r,i])}),Array.from(n.values())},Ll=e=>{let t=new Set;for(let[,n]of e)if(!n.isDeleted)for(let i of n.groupIds??[])t.add(i);return t},Bl=e=>{let t=e.flatMap(o=>o.groupIds),n=new Map,i=0;for(let o of t)n.set(o,(n.get(o)??0)+1),n.get(o)>i&&(i=n.get(o));return i===e.length},Cl=e=>e.groupIds.length>0,Gl=(e,t,n)=>{let i=[...e],o=t?e.indexOf(t):-1,r=o>-1?o:e.length;for(let s=0;s<r;s++)i[s]=n(i[s]);return i},Io=(e,t,n)=>{let i=Lp(n),o=e.filter(u=>!le(u)),r=new Map,s=new Map,a=u=>{let m=s.get(u.id)||[],p=V(u,t);p&&m.push(p),s.set(u.id,[...m,u])},l=(u,m)=>{let p=r.get(m)||[],f=V(u,t);f&&p.push(f),r.set(m,[...p,u])},d=(u,m)=>{let p=u.groupIds.indexOf(m,0);return u.groupIds.slice(0,p).length>0?l(u,u.groupIds[p-1]):a(u)},c=e.every(u=>Dp(n,u));return o.forEach(u=>{let m=Cp(u,n.selectedGroupIds);m?i.length===1&&c?d(u,m):l(u,m):a(u)}),Array.from(r.values()).concat(Array.from(s.values()))};var Ol=e=>{let t=new Set;return e.forEach(n=>{q(n)&&t.add(n.id)}),e.filter(n=>!(n.frameId&&t.has(n.frameId)))},Vr=(e,t,n,i=!0)=>{let[o,r,s,a]=W(t,n),l=e.filter(d=>{let[c,u,m,p]=se(d,n),f=Ot(d,n);if(f){let[E,h,g,x]=se(f,n);c=Math.max(E,c),u=Math.max(h,u),m=Math.min(g,m),p=Math.min(x,p)}return d.locked===!1&&d.type!=="selection"&&!le(d)&&o<=c&&r<=u&&s>=m&&a>=p});return l=i?Ol(l):l,l=l.filter(d=>{let c=Ot(d,n);return c?on(d,c,n):!0}),l},pb=(e,t,n,i)=>{let o=new Set(t.map(r=>r.id));return e.filter(r=>{let s=kl(r,n.width,n.height,n,i);return!o.has(r.id)&&s})},fb=function(){let e=null,t=null,n=null,i=(o,r)=>(n!=null&&o===e&&r.selectedElementIds===t||(n=o.some(s=>r.selectedElementIds[s.id]),e=o,t=r.selectedElementIds),n);return i.clearCache=()=>{e=null,t=null,n=null},i}(),mt=(e,t,n)=>{let i=new Set,o=[];for(let r of e.values()){if(t.selectedElementIds[r.id]){o.push(r),i.add(r.id);continue}if(n?.includeBoundTextElement&&le(r)&&t.selectedElementIds[r?.containerId]){o.push(r),i.add(r.id);continue}}if(n?.includeElementsInFrames){let r=[];return o.forEach(s=>{q(s)&&rn(e,s.id).forEach(a=>!i.has(a.id)&&r.push(a)),r.push(s)}),r}return o},hb=(e,t)=>t.editingTextElement?[t.editingTextElement]:t.newElement?[t.newElement]:mt(e,t,{includeBoundTextElement:!0}),jr=(e,t)=>Op(t.selectedElementIds,e)?t.selectedElementIds:e,kp=(e,t)=>{let n=e.filter(K);if(n.length===1){let i=n[0],o=i.boundElements?.map(s=>s.id)??[];if(e.every(s=>s.id===i.id||o.includes(s.id)))return new R(i,Gp(t))}return null},Eb=(e,t,n)=>({selectedLinearElement:kp(e,t),...vl({editingGroupId:n.editingGroupId,selectedElementIds:Ol(e).reduce((i,o)=>(le(o)||(i[o.id]=!0),i),{})},t,n,null)});var Rl=(e,t,n)=>{let i=pt(e);for(let o of t)if(o.frameId){let r=n.get(o.id),s=n.get(o.frameId),a=r&&i.get(r);a&&ye(a,i,{frameId:s??null})}};function Nn(e,t,n){let i=Zr(t,n),o=Zr(e,n);return i.some(s=>o.some(a=>Il(s,a)))}var Fl=(e,t,n)=>So(Vr(e,t,n,!1)).filter(i=>!q(i)&&!i.frameId||i.frameId===t.id),qr=(e,t,n)=>Vr([t],e,n).some(i=>i.id===t.id),Db=(e,t)=>{let n=pt(e);return e.filter(i=>Nn(i,t,n))},sn=(e,t,n)=>{let[i,o,r,s]=W(t,n),[a,l,d,c]=Ye(e);return i<=a&&o<=l&&r>=d&&s>=c},on=(e,t,n)=>sn([e],t,n)||Nn(e,t,n)||qr(e,t,n),Lb=(e,t,n)=>{let[i,o,r,s]=W(t,n);return Rp($r(i,o),$r(e.x,e.y),$r(r,s))},Bb=(e,t,n)=>{let i=pt(e),o=t.flatMap(r=>ve(e,r));return o.length===0?!0:!!o.find(r=>sn([r],n,i)||Nn(r,n,i))},Cb=(e,t,n)=>{let i=pt(e),o=t.flatMap(r=>ve(e,r));return o.length===0?!0:o.find(r=>sn([r],n,i)||Nn(r,n,i))===void 0},Gb=e=>{let t=new Map;for(let n of e){let i=q(n)?n.id:n.frameId;i&&!t.has(i)&&t.set(i,rn(e,i))}return t},rn=(e,t)=>{let n=[];for(let i of e.values())i.frameId===t&&n.push(i);return n},Fp=e=>e.filter(t=>q(t)),Ob=e=>{let t=pt(Fp(e));return e.filter(n=>t.has(n.id)||!n.frameId||!t.has(n.frameId))},kb=(e,t,n,i)=>{let o=rn(e,t.id),r=new Set(o),s=new Set([...Fl(e,t,i),...o.filter(m=>qr(m,t,i))]),a=o.filter(m=>!s.has(m)),l=new Set(Array.from(s).flatMap(m=>m.groupIds));for(let m of a)if(!Nn(m,t,i))m.groupIds.length===0&&r.delete(m);else if(m.groupIds.length>0)for(let p of m.groupIds)l.add(p);for(let m of a)if(m.groupIds.length>0){let p=!0;for(let f of m.groupIds)l.has(f)&&(p=!1);p&&r.delete(m)}let d=Array.from(s).filter(m=>m.groupIds.length===0);for(let m of d)r.add(m);let c=Array.from(s).filter(m=>m.groupIds.length>0),u=Dl(c,n);for(let[m,p]of Object.entries(u))if(p){let f=ve(e,m);if(sn(f,t,i))for(let E of f)r.add(E)}return[...r].filter(m=>!(J(m)&&m.containerId))},Rb=(e,t,n)=>Np(So(e,Fl(e,t,n)),t,n),Np=(e,t,n)=>{let i=[],o=new Map;for(let r of e){let s=!1;if(r.groupIds.length>0){if(r.groupIds.some(a=>o.get(a)))s=!0;else{let a=new Set(r.groupIds.flatMap(l=>ve(n,l)));s=!sn(Array.from(a),t,n)}r.groupIds.forEach(a=>{o.set(a,s)})}s||i.push(r)}return i},Ot=(e,t)=>e.frameId&&t.get(e.frameId)||null,Fb=(e,t)=>{let n=new Set,i=pt(e);e=So(e);for(let s of e)q(s)&&s.id!==t.id&&n.add(s.id);let o=new Set,r=[];for(let s of e)if(!(q(s)||s.frameId&&n.has(s.frameId)))if(s.groupIds.length){let a=s.groupIds.at(-1);if(!o.has(a)){o.add(a);let l=ve(e,a);if(l.some(d=>on(d,t,i)))for(let d of l)r.push(d)}}else on(s,t,i)&&r.push(s);return r},Hp=(e,t,n,i)=>{let o=pt(e),r=new Map;for(let d of e.values())d.frameId===n.id&&r.set(d.id,!0);let s=new Set(t.map(d=>d.id)),a=[],l=new Set;for(let d of t)q(d)&&d.id!==n.id&&l.add(d.id);for(let d of So(e,t)){if(q(d)||d.frameId&&l.has(d.frameId)||d.frameId&&i.selectedElementIds[d.id]&&i.selectedElementIds[d.frameId])continue;r.has(d.id)||a.push(d);let c=V(d,o);c&&!s.has(c.id)&&!r.has(c.id)&&a.push(c)}for(let d of a)ye(d,o,{frameId:n.id});return e},Nl=(e,t)=>{let n=new Map,i=new Map;for(let o of e)if(o.frameId){n.set(o.id,o);let r=i.get(o.frameId)||[];r.push(o);let s=V(o,t);s&&(n.set(s.id,s),r.push(s)),i.set(o.frameId,r)}for(let[,o]of n)ye(o,t,{frameId:null})},zp=(e,t)=>{let n=rn(e,t.id);return Nl(n,pt(e)),e},Nb=(e,t,n,i)=>Hp(zp(e,n),t,n,i.state).slice(),Hb=(e,t,n)=>{let i=n.scene.getSelectedElements({selectedElementIds:t.selectedElementIds,elements:e}),o=new Set(i);if(t.editingGroupId)for(let a of i)a.groupIds.length===0?o.add(a):a.groupIds.flatMap(l=>ve(e,l)).forEach(l=>o.add(l));let r=new Set,s=pt(e);return o.forEach(a=>{a.frameId&&!q(a)&&!Hl(a,s,t)&&r.add(a)}),r.size>0&&Nl(r,s),e},So=(e,t)=>{let n=new Set,i=t||e;for(let s of i.values()){let a=s.groupIds[s.groupIds.length-1];a&&n.add(a)}let o=new Set;for(let s of n)ve(e,s).some(a=>q(a))&&o.add(s);let r=[];for(let s of i.values())o.has(s.groupIds[s.groupIds.length-1])||r.push(s);return r},_p=(e,t,n)=>{let i=J(e)&&Se(e,t)||e;return i.frameId&&n.selectedElementIds[i.id]&&n.selectedElementIds[i.frameId]?Ot(i,t):n.selectedElementIds[i.id]&&n.selectedElementsAreBeingDragged?n.frameToHighlight:Ot(i,t)},Hl=(e,t,n,i)=>{let o=i?.targetFrame??_p(e,t,n);if(!o)return!1;let r=J(e)&&Se(e,t)||e,s=l=>{i?.checkedGroups&&r.groupIds.forEach(d=>{i.checkedGroups?.set(d,l)})};if(!n.selectedElementIds[r.id]||!n.selectedElementsAreBeingDragged||n.selectedElementIds[r.id]&&n.selectedElementIds[o.id])return!0;if(r.groupIds.length===0)return on(r,o,t);for(let l of r.groupIds)if(i?.checkedGroups?.has(l))return i.checkedGroups.get(l);let a=new Set(r.groupIds.filter(l=>i?.checkedGroups?!i.checkedGroups.has(l):!0).flatMap(l=>ve(t,l)));if(n.editingGroupId&&n.selectedElementsAreBeingDragged){let l=new Set(mt(t,n));if(n.frameToHighlight!==null)return!0;l.forEach(c=>{a.delete(c)})}for(let l of a)if(q(l))return s(!1),!1;for(let l of a)if(on(l,o,t))return s(!0),!0;return!1},zb=(e,t,n,i,o)=>{if(!n.frameRendering||!n.frameRendering.clip)return!1;let r=Nn(e,t,i)||qr(e,t,i);if(r){for(let s of e.groupIds)o?.set(s,!0);return!0}if(!r&&e.groupIds.length>0&&!sn([e],t,i)){let s=!1;if(n.selectedElementsAreBeingDragged)s=Hl(e,i,n,{targetFrame:t,checkedGroups:o});else{s=e.frameId===t.id;for(let a of e.groupIds)o?.set(a,s)}for(let a of e.groupIds)o?.set(a,s);return s}return!1},Up="Frame",Yp="AI Frame",Xp=e=>Wi(e)?Up:Yp,_b=e=>e.name===null?Xp(e):e.name,Ub=(e,t)=>Tl({elements:e,bounds:t,type:"overlap"}).filter(n=>!n.frameId||n.frameId===t.id),Yb=e=>{let t=pt(e);return e.length>1&&e.some(n=>n.frameId&&t.has(n.frameId))};var Qp="invert(100%) hue-rotate(180deg) saturate(1.25)",Xl=(e,t)=>jt(e)&&!t.imageCache.has(e.fileId),jl=(e,t,n)=>n.theme===Yl.DARK&&jt(e)&&!Xl(e,t)&&t.imageCache.get(e.fileId)?.mimeType!==Jr.svg,Lo=e=>{switch(e.type){case"freedraw":return e.strokeWidth*12;case"text":return e.fontSize/2;case"arrow":return e.endArrowhead||e.endArrowhead?40:20;default:return 20}},Jp=(e,t,n,i,o=1)=>{let r=(t?.opacity??100)*e.opacity/1e4*o;return(n.has(e.id)||i&&i.some(s=>s.id===e.id)||t&&n.has(t.id))&&(r*=Vp/100),r},ef=(e,t,n)=>{let r=Lo(e),[s,a,l,d]=W(e,t),c=K(e)||Ie(e)?an(s,l):e.width,u=K(e)||Ie(e)?an(a,d):e.height,m=c*window.devicePixelRatio+r*2,p=u*window.devicePixelRatio+r*2,f=n.value;return(m*f>32767||p*f>32767)&&(f=Math.min(32767/m,32767/p)),m*p*f*f>16777216&&(f=Math.sqrt(16777216/(m*p))),m=Math.floor(m*f),p=Math.floor(p*f),{width:m,height:p,scale:f}},Wl=(e,t,n,i,o)=>{let r=document.createElement("canvas"),s=r.getContext("2d"),a=Lo(e),{width:l,height:d,scale:c}=ef(e,t,n);if(!l||!d)return null;r.width=l,r.height=d;let u=-100,m=0;if(K(e)||Ie(e)){let[g,x]=W(e,t);u=e.x>g?an(e.x,g)*window.devicePixelRatio*c:0,m=e.y>x?an(e.y,x)*window.devicePixelRatio*c:0,s.translate(u,m)}s.save(),s.translate(a*c,a*c),s.scale(window.devicePixelRatio*c,window.devicePixelRatio*c);let p=En.canvas(r);jl(e,i,o)&&(s.filter=Qp),vo(e,p,s,i),s.restore();let f=V(e,t),E=document.createElement("canvas"),h=E.getContext("2d");if(H(e)&&f){let[g,x,w,b]=W(e,t),y=Math.max(an(g,w),an(x,b));E.width=y*window.devicePixelRatio*c+a*c*10,E.height=y*window.devicePixelRatio*c+a*c*10,h.translate(E.width/2,E.height/2),h.rotate(e.angle),h.drawImage(r,-r.width/2,-r.height/2,r.width,r.height);let[,,,,I,S]=W(f,t);h.rotate(-e.angle);let A=(E.width-r.width)/2,M=(E.height-r.height)/2,O=E.width/2-(I-g)*window.devicePixelRatio*c-A-a*c,L=E.height/2-(S-x)*window.devicePixelRatio*c-M-a*c;h.translate(-O,-L),h.clearRect(-(f.width/2+Ao)*window.devicePixelRatio*c,-(f.height/2+Ao)*window.devicePixelRatio*c,(f.width+Ao*2)*window.devicePixelRatio*c,(f.height+Ao*2)*window.devicePixelRatio*c)}return{element:e,canvas:r,theme:o.theme,scale:c,zoomValue:n.value,canvasOffsetX:u,canvasOffsetY:m,boundTextElementVersion:V(e,t)?.version||null,containingFrameOpacity:Ot(e,t)?.opacity||100,boundTextCanvas:E,angle:e.angle,imageCrop:xe(e)?e.crop:null}},r0=14,Vl=typeof document<"u"?document.createElement("img"):{src:""};Vl.src=`data:${Jr.svg},${encodeURIComponent('<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="image" class="svg-inline--fa fa-image fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="#888" d="M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z"></path></svg>')}`;var $l=typeof document<"u"?document.createElement("img"):{src:""};$l.src=`data:${Jr.svg},${encodeURIComponent('<svg viewBox="0 0 668 668" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><path d="M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48ZM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56ZM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48Z" style="fill:#888;fill-rule:nonzero" transform="matrix(.81709 0 0 .81709 124.825 145.825)"/><path d="M256 8C119.034 8 8 119.033 8 256c0 136.967 111.034 248 248 248s248-111.034 248-248S392.967 8 256 8Zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676ZM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676Z" style="fill:#888;fill-rule:nonzero" transform="matrix(.30366 0 0 .30366 506.822 60.065)"/></svg>')}`;var tf=(e,t)=>{t.fillStyle="#E7E7E7",t.fillRect(0,0,e.width,e.height);let n=Math.min(e.width,e.height),i=Math.min(n,Math.min(n*.4,100));t.drawImage(e.status==="error"?$l:Vl,e.width/2-i/2,e.height/2-i/2,i,i)},vo=(e,t,n,i)=>{switch(e.type){case"rectangle":case"iframe":case"embeddable":case"diamond":case"ellipse":{n.lineJoin="round",n.lineCap="round",t.draw(Me.get(e));break}case"arrow":case"line":{n.lineJoin="round",n.lineCap="round",Me.get(e).forEach(o=>{t.draw(o)});break}case"freedraw":{n.save(),n.fillStyle=e.strokeColor;let o=nf(e),r=Me.get(e);r&&t.draw(r),n.fillStyle=e.strokeColor,n.fill(o),n.restore();break}case"image":{let o=jt(e)?i.imageCache.get(e.fileId)?.image:void 0;if(o!=null&&!(o instanceof Promise)){e.roundness&&n.roundRect&&(n.beginPath(),n.roundRect(0,0,e.width,e.height,It(Math.min(e.width,e.height),e)),n.clip());let{x:r,y:s,width:a,height:l}=e.crop?e.crop:{x:0,y:0,width:o.naturalWidth,height:o.naturalHeight};n.drawImage(o,r,s,a,l,0,0,e.width,e.height)}else tf(e,n);break}default:if(J(e)){let o=Zp(e.text),r=o&&!n.canvas.isConnected;r&&document.body.appendChild(n.canvas),n.canvas.setAttribute("dir",o?"rtl":"ltr"),n.save(),n.font=$p(e),n.fillStyle=e.strokeColor,n.textAlign=e.textAlign;let s=e.text.replace(/\r\n?/g,`
`).split(`
`),a=e.textAlign==="center"?e.width/2:e.textAlign==="right"?e.width:0,l=Ki(e.fontSize,e.lineHeight),d=qp(e.fontFamily,e.fontSize,l);for(let c=0;c<s.length;c++)n.fillText(s[c],a,c*l+d);n.restore(),r&&n.canvas.remove()}else throw new Error(`Unimplemented type ${e.type}`)}},Do=new WeakMap,_l=(e,t,n,i)=>{let o=n?i.zoom:{value:1},r=Do.get(e),s=r&&r.zoomValue!==o.value&&!i?.shouldCacheIgnoreZoom,a=V(e,t),l=a?.version||null,d=xe(e)?e.crop:null,c=Ot(e,t)?.opacity||100;if(!r||s||r.theme!==i.theme||r.boundTextElementVersion!==l||r.imageCrop!==d||r.containingFrameOpacity!==c||H(e)&&a&&e.angle!==r.angle){let u=Wl(e,t,o,n,i);return u?(Do.set(e,u),u):null}return r},Qr=(e,t,n,i,o)=>{let r=e.element,s=Lo(r),a=e.scale,[l,d,c,u]=W(r,o),m=((l+c)/2+i.scrollX)*window.devicePixelRatio,p=((d+u)/2+i.scrollY)*window.devicePixelRatio;t.save(),t.scale(1/window.devicePixelRatio,1/window.devicePixelRatio);let f=V(r,o);if(H(r)&&f){let E=(e.boundTextCanvas.width-e.canvas.width)/2,h=(e.boundTextCanvas.height-e.canvas.height)/2;t.translate(m,p),t.drawImage(e.boundTextCanvas,-(c-l)/2*window.devicePixelRatio-E/a-s,-(u-d)/2*window.devicePixelRatio-h/a-s,e.boundTextCanvas.width/a,e.boundTextCanvas.height/a)}else if(t.translate(m,p),t.rotate(r.angle),"scale"in e.element&&!Xl(r,n)&&t.scale(e.element.scale[0],e.element.scale[1]),t.translate(-m,-p),t.drawImage(e.canvas,(l+i.scrollX)*window.devicePixelRatio-s*e.scale/e.scale,(d+i.scrollY)*window.devicePixelRatio-s*e.scale/e.scale,e.canvas.width/e.scale,e.canvas.height/e.scale),v.VITE_APP_DEBUG_ENABLE_TEXT_CONTAINER_BOUNDING_BOX==="true"&&lt(r)){let E=V(r,o),h=Pr(r);t.strokeStyle="#c92a2a",t.lineWidth=3,t.strokeRect((h.x+i.scrollX)*window.devicePixelRatio,(h.y+i.scrollY)*window.devicePixelRatio,tt(r,E)*window.devicePixelRatio,ri(r,E)*window.devicePixelRatio)}t.restore()},s0=(e,t,n,i)=>{t.save(),t.translate(e.x+n.scrollX,e.y+n.scrollY),t.fillStyle="rgba(0, 0, 200, 0.04)";let o=.5/n.zoom.value;t.fillRect(o,o,e.width,e.height),t.lineWidth=1/n.zoom.value,t.strokeStyle=i,t.strokeRect(o,o,e.width,e.height),t.restore()},a0=(e,t,n,i,o,r,s)=>{let a=s.openDialog?.name==="elementLinkSelector"&&!s.selectedElementIds[e.id]&&!s.hoveredElementIds[e.id];switch(o.globalAlpha=Jp(e,Ot(e,t),r.elementsPendingErasure,r.pendingFlowchartNodes,a?Wp:1),e.type){case"magicframe":case"frame":{s.frameRendering.enabled&&s.frameRendering.outline&&(o.save(),o.translate(e.x+s.scrollX,e.y+s.scrollY),o.fillStyle="rgba(0, 0, 200, 0.04)",o.lineWidth=To.strokeWidth/s.zoom.value,o.strokeStyle=To.strokeColor,ha(e)&&(o.strokeStyle=s.theme===Yl.LIGHT?"#7affd7":"#1d8264"),To.radius&&o.roundRect?(o.beginPath(),o.roundRect(0,0,e.width,e.height,To.radius/s.zoom.value),o.stroke(),o.closePath()):o.strokeRect(0,0,e.width,e.height),o.restore());break}case"freedraw":{if(Me.generateElementShape(e,null),r.isExporting){let[l,d,c,u]=W(e,t),m=(l+c)/2+s.scrollX,p=(d+u)/2+s.scrollY,f=(c-l)/2-(e.x-l),E=(u-d)/2-(e.y-d);o.save(),o.translate(m,p),o.rotate(e.angle),o.translate(-f,-E),vo(e,i,o,r),o.restore()}else{let l=_l(e,n,r,s);if(!l)return;Qr(l,o,r,s,n)}break}case"rectangle":case"diamond":case"ellipse":case"line":case"arrow":case"image":case"text":case"iframe":case"embeddable":{if(Me.generateElementShape(e,r),r.isExporting){let[l,d,c,u]=W(e,t),m=(l+c)/2+s.scrollX,p=(d+u)/2+s.scrollY,f=(c-l)/2-(e.x-l),E=(u-d)/2-(e.y-d);if(J(e)){let g=Se(e,t);if(H(g)){let x=R.getBoundTextElementPosition(g,e,t);f=(c-l)/2-(x.x-l),E=(u-d)/2-(x.y-d)}}o.save(),o.translate(m,p),jl(e,r,s)&&(o.filter="none");let h=V(e,t);if(H(e)&&h){let g=document.createElement("canvas"),x=g.getContext("2d"),w=Math.max(an(l,c),an(d,u)),b=Lo(e);g.width=w*s.exportScale+b*10*s.exportScale,g.height=w*s.exportScale+b*10*s.exportScale,x.translate(g.width/2,g.height/2),x.scale(s.exportScale,s.exportScale),f=e.width/2-(e.x-l),E=e.height/2-(e.y-d),x.rotate(e.angle);let y=En.canvas(g);x.translate(-f,-E),vo(e,y,x,r),x.translate(f,E),x.rotate(-e.angle);let[,,,,I,S]=W(h,t),A=(l+c)/2-I,M=(d+u)/2-S;x.translate(-A,-M),x.clearRect(-h.width/2,-h.height/2,h.width,h.height),o.scale(1/s.exportScale,1/s.exportScale),o.drawImage(g,-g.width/2,-g.height/2,g.width,g.height)}else o.rotate(e.angle),e.type==="image"&&o.scale(e.scale[0],e.scale[1]),o.translate(-f,-E),vo(e,i,o,r);o.restore()}else{let l=_l(e,n,r,s);if(!l)return;let d=o.imageSmoothingEnabled;if(!s?.shouldCacheIgnoreZoom&&(!e.angle||jp(e.angle))&&(o.imageSmoothingEnabled=!1),e.id===s.croppingElementId&&xe(l.element)&&l.element.crop!==null){o.save(),o.globalAlpha=.1;let c=Wl(ma(l.element,t),n,s.zoom,r,s);c&&Qr(c,o,r,s,n),o.restore()}Qr(l,o,r,s,n),o.imageSmoothingEnabled=d}break}default:throw new Error(`Unimplemented type ${e.type}`)}o.globalAlpha=1},Zl=new WeakMap([]);function ql(e){let t=of(e),n=new Path2D(t);return Zl.set(e,n),n}function nf(e){return Zl.get(e)}function of(e){return af(rf(e))}function l0(e,t,n){let i=se({...e,angle:0},n),o=Mo((i[0]+i[2])/2,(i[1]+i[3])/2);return Kp(t.length>=2,"Freepath outline must have at least 2 points"),t.slice(2).reduce((r,s)=>(r.push(zl(r[r.length-1][1],Kr(Mo(s[0]+e.x,s[1]+e.y),o,e.angle))),r),[zl(Kr(Mo(t[0][0]+e.x,t[0][1]+e.y),o,e.angle),Kr(Mo(t[1][0]+e.x,t[1][1]+e.y),o,e.angle))])}function rf(e){let t=e.simulatePressure?e.points:e.points.length?e.points.map(([i,o],r)=>[i,o,e.pressures[r]]):[[0,0,.5]],n={simulatePressure:!1,size:e.strokeWidth*1.5,thinning:.6,smoothing:.5,streamline:0,easing:i=>Math.sin(i*Math.PI/2),last:!0};return aa(t,n)}function Ul(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}var sf=/(\s?[A-Z]?,?-?[0-9]*\.[0-9]{0,2})(([0-9]|e|-)*)/g;function af(e){if(!e.length)return"";let t=e.length-1;return e.reduce((n,i,o,r)=>(o===t?n.push(i,Ul(i,r[0]),"L",r[0],"Z"):n.push(i,Ul(i,r[o+1])),n),["M",e[0],"Q"]).join(" ").replace(sf,"$1")}P();var u0=e=>e==="rectangle"||e==="iframe"||e==="embeddable"||e==="ellipse"||e==="diamond"||e==="line"||e==="freedraw",m0=e=>e==="rectangle"||e==="ellipse"||e==="diamond"||e==="freedraw"||e==="arrow"||e==="line"||e==="text",p0=e=>e==="rectangle"||e==="iframe"||e==="embeddable"||e==="ellipse"||e==="diamond"||e==="freedraw"||e==="arrow"||e==="line",f0=e=>e==="rectangle"||e==="iframe"||e==="embeddable"||e==="ellipse"||e==="diamond"||e==="arrow"||e==="line",Kl=e=>e==="rectangle"||e==="iframe"||e==="embeddable"||e==="line"||e==="diamond"||e==="image",h0=e=>e==="arrow",E0=e=>e==="arrow";var Me=class e{static rg=new je;static cache=new WeakMap;static get=t=>e.cache.get(t);static set=(t,n)=>e.cache.set(t,n);static delete=t=>e.cache.delete(t);static destroy=()=>{e.cache=new WeakMap};static generateElementShape=(t,n)=>{let i=n?.isExporting?void 0:e.get(t);if(i!==void 0)return i;Do.delete(t);let o=ff(t,e.rg,n||{isExporting:!1,canvasBackgroundColor:cf.white,embedsValidationStatus:null});return e.cache.set(t,o),o}},mf=e=>[8,8+e],td=e=>[1.5,6+e];function pf(e){let t=e.roughness,n=Math.max(e.width,e.height),i=Math.min(e.width,e.height);return i>=20&&n>=50||i>=15&&e.roundness&&Kl(e.type)||K(e)&&n>=50?t:Math.min(t/(n<10?3:2),2.5)}var ke=(e,t=!1)=>{let n={seed:e.seed,strokeLineDash:e.strokeStyle==="dashed"?mf(e.strokeWidth):e.strokeStyle==="dotted"?td(e.strokeWidth):void 0,disableMultiStroke:e.strokeStyle!=="solid",strokeWidth:e.strokeStyle!=="solid"?e.strokeWidth+.5:e.strokeWidth,fillWeight:e.strokeWidth/2,hachureGap:e.strokeWidth*4,roughness:pf(e),stroke:e.strokeColor,preserveVertices:t||e.roughness<lf.cartoonist};switch(e.type){case"rectangle":case"iframe":case"embeddable":case"diamond":case"ellipse":return n.fillStyle=e.fillStyle,n.fill=xi(e.backgroundColor)?void 0:e.backgroundColor,e.type==="ellipse"&&(n.curveFitting=1),n;case"line":case"freedraw":return gn(e.points)&&(n.fillStyle=e.fillStyle,n.fill=e.backgroundColor==="transparent"?void 0:e.backgroundColor),n;case"arrow":return n;default:throw new Error(`Unimplemented type ${e.type}`)}},Jl=(e,t,n)=>ji(e)&&(t||fa(e)&&n?.get(e.id)!==!0)&&xi(e.backgroundColor)&&xi(e.strokeColor)?{...e,roughness:0,backgroundColor:"#d3d3d3",fillStyle:"solid"}:Xi(e)?{...e,strokeColor:xi(e.strokeColor)?"#000000":e.strokeColor,backgroundColor:xi(e.backgroundColor)?"#f4f4f6":e.backgroundColor}:e,ed=(e,t,n,i,o,r,s)=>{let a=es(e,t,n,i);if(a===null)return[];let l=(d,c)=>{if(d===null)return[];let[,,u,m,p,f]=d;return[o.line(u,m,p,f,c)]};switch(i){case"dot":case"circle":case"circle_outline":{let[d,c,u]=a;return delete r.strokeLineDash,[o.circle(d,c,u,{...r,fill:i==="circle_outline"?s:e.strokeColor,fillStyle:"solid",stroke:e.strokeColor,roughness:Math.min(.5,r.roughness||0)})]}case"triangle":case"triangle_outline":{let[d,c,u,m,p,f]=a;return delete r.strokeLineDash,[o.polygon([[d,c],[u,m],[p,f],[d,c]],{...r,fill:i==="triangle_outline"?s:e.strokeColor,fillStyle:"solid",roughness:Math.min(1,r.roughness||0)})]}case"diamond":case"diamond_outline":{let[d,c,u,m,p,f,E,h]=a;return delete r.strokeLineDash,[o.polygon([[d,c],[u,m],[p,f],[E,h],[d,c]],{...r,fill:i==="diamond_outline"?s:e.strokeColor,fillStyle:"solid",roughness:Math.min(1,r.roughness||0)})]}case"crowfoot_one":return l(a,r);case"bar":case"arrow":case"crowfoot_many":case"crowfoot_one_or_many":default:{let[d,c,u,m,p,f]=a;if(e.strokeStyle==="dotted"){let E=td(e.strokeWidth-1);r.strokeLineDash=[E[0],E[1]-1]}else delete r.strokeLineDash;return r.roughness=Math.min(1,r.roughness||0),[o.line(u,m,d,c,r),o.line(p,f,d,c,r),...i==="crowfoot_one_or_many"?l(es(e,t,n,"crowfoot_one"),r):[]]}}},Sa=e=>{let t=new je,n={seed:e.seed,disableMultiStroke:!0,disableMultiStrokeFill:!0,roughness:0,preserveVertices:!0},i=ct(e.points.reduce((o,r)=>[Math.min(e.x+r[0],o[0]),Math.min(e.y+r[1],o[1]),Math.max(e.x+r[0],o[2]),Math.max(e.y+r[1],o[3])],[1/0,1/0,-1/0,-1/0]));switch(e.type){case"line":case"arrow":{let o=e.points.length?e.points:[ae(0,0)];return X(e)?t.path(nd(o,0),n).sets[0].ops:e.roundness?t.curve(o,n).sets[0].ops.slice(0,e.points.length).map((r,s)=>{if(s===0){let a=kt(ae(e.x+r.data[0],e.y+r.data[1]),i,e.angle);return{op:"move",data:ae(a[0]-e.x,a[1]-e.y)}}return{op:"bcurveTo",data:[kt(ae(e.x+r.data[0],e.y+r.data[1]),i,e.angle),kt(ae(e.x+r.data[2],e.y+r.data[3]),i,e.angle),kt(ae(e.x+r.data[4],e.y+r.data[5]),i,e.angle)].map(a=>ae(a[0]-e.x,a[1]-e.y)).flat()}}):o.map((r,s)=>{let a=kt(ae(e.x+r[0],e.y+r[1]),i,e.angle);return{op:s===0?"move":"lineTo",data:ae(a[0]-e.x,a[1]-e.y)}})}case"freedraw":{if(e.points.length<2)return[];let o=qn(e.points,.75);return t.curve(o,n).sets[0].ops.slice(0,e.points.length).map((r,s)=>{if(s===0){let a=kt(ae(e.x+r.data[0],e.y+r.data[1]),i,e.angle);return{op:"move",data:ae(a[0]-e.x,a[1]-e.y)}}return{op:"bcurveTo",data:[kt(ae(e.x+r.data[0],e.y+r.data[1]),i,e.angle),kt(ae(e.x+r.data[2],e.y+r.data[3]),i,e.angle),kt(ae(e.x+r.data[4],e.y+r.data[5]),i,e.angle)].map(a=>ae(a[0]-e.x,a[1]-e.y)).flat()}})}}},ff=(e,t,{isExporting:n,canvasBackgroundColor:i,embedsValidationStatus:o})=>{switch(e.type){case"rectangle":case"iframe":case"embeddable":{let r;if(e.roundness){let s=e.width,a=e.height,l=It(Math.min(s,a),e);r=t.path(`M ${l} 0 L ${s-l} 0 Q ${s} 0, ${s} ${l} L ${s} ${a-l} Q ${s} ${a}, ${s-l} ${a} L ${l} ${a} Q 0 ${a}, 0 ${a-l} L 0 ${l} Q 0 0, ${l} 0`,ke(Jl(e,n,o),!0))}else r=t.rectangle(0,0,e.width,e.height,ke(Jl(e,n,o),!1));return r}case"diamond":{let r,[s,a,l,d,c,u,m,p]=Ln(e);if(e.roundness){let f=It(Math.abs(s-m),e),E=It(Math.abs(d-a),e);r=t.path(`M ${s+f} ${a+E} L ${l-f} ${d-E}
            C ${l} ${d}, ${l} ${d}, ${l-f} ${d+E}
            L ${c+f} ${u-E}
            C ${c} ${u}, ${c} ${u}, ${c-f} ${u-E}
            L ${m+f} ${p+E}
            C ${m} ${p}, ${m} ${p}, ${m+f} ${p-E}
            L ${s-f} ${a+E}
            C ${s} ${a}, ${s} ${a}, ${s+f} ${a+E}`,ke(e,!0))}else r=t.polygon([[s,a],[l,d],[c,u],[m,p]],ke(e));return r}case"ellipse":return t.ellipse(e.width/2,e.height/2,e.width,e.height,ke(e));case"line":case"arrow":{let r,s=ke(e),a=e.points.length?e.points:[ae(0,0)];if(X(e)?a.every(l=>Math.abs(l[0])<=1e6&&Math.abs(l[1])<=1e6)?r=[t.path(nd(a,0),ke(e,!0))]:(console.error("Elbow arrow with extreme point positions detected. Arrow not rendered.",e.id,JSON.stringify(a)),r=[]):e.roundness?r=[t.curve(a,s)]:s.fill?r=[t.polygon(a,s)]:r=[t.linearPath(a,s)],e.type==="arrow"){let{startArrowhead:l=null,endArrowhead:d="arrow"}=e;if(l!==null){let c=ed(e,r,"start",l,t,s,i);r.push(...c)}if(d!==null){let c=ed(e,r,"end",d,t,s,i);r.push(...c)}}return r}case"freedraw":{let r;if(ql(e),gn(e.points)){let s=qn(e.points,.75);r=t.curve(s,{...ke(e),stroke:"none"})}else r=null;return r}case"frame":case"magicframe":case"text":case"image":return null;default:return df(e,`generateElementShape(): Unimplemented type ${e?.type}`),null}},nd=(e,t)=>{let n=[];for(let o=1;o<e.length-1;o+=1){let r=e[o-1],s=e[o+1],a=e[o],l=nt(a,r),d=nt(s,a),c=Math.min(t,Ql(e[o],s)/2,Ql(e[o],r)/2);l?r[0]<a[0]?n.push([e[o][0]-c,e[o][1]]):n.push([e[o][0]+c,e[o][1]]):r[1]<a[1]?n.push([e[o][0],e[o][1]-c]):n.push([e[o][0],e[o][1]+c]),n.push(e[o]),d?s[0]<a[0]?n.push([e[o][0]-c,e[o][1]]):n.push([e[o][0]+c,e[o][1]]):s[1]<a[1]?n.push([e[o][0],e[o][1]-c]):n.push([e[o][0],e[o][1]+c])}let i=[`M ${e[0][0]} ${e[0][1]}`];for(let o=0;o<n.length;o+=3)i.push(`L ${n[o][0]} ${n[o][1]}`),i.push(`Q ${n[o+1][0]} ${n[o+1][1]}, ${n[o+2][0]} ${n[o+2][1]}`);return i.push(`L ${e[e.length-1][0]} ${e[e.length-1][1]}`),i.join(" ")},id=(e,t)=>{switch(e.type){case"rectangle":case"diamond":case"frame":case"magicframe":case"embeddable":case"image":case"iframe":case"text":case"selection":return qs(e);case"arrow":case"line":{let n=Me.get(e)?.[0]??Me.generateElementShape(e,null)[0],[,,,,i,o]=W(e,t);return to(e)?ea(e,n,ae(e.x,e.y),e.angle,ae(i,o)):Qs(n,ae(e.x,e.y),e.angle,ae(i,o))}case"ellipse":return Ks(e);case"freedraw":{let[,,,,n,i]=W(e,t);return Js(e,ae(n,i),to(e))}}},gl=(e,t)=>{let n=[...e.points];if(t){if(!xa(e.points))return null;let o=n[0],r=n[n.length-1];Math.hypot(o[0]-r[0],o[1]-r[1])>uf||n.length<4?n.push(ae(o[0],o[1])):n[n.length-1]=ae(o[0],o[1])}return{polygon:t,points:n}};var is=class e{static boundsCache=new WeakMap;static nonRotatedBoundsCache=new WeakMap;static getBounds(t,n,i=!1){let o=i&&t.angle!==0?e.nonRotatedBoundsCache.get(t):e.boundsCache.get(t);if(o?.version&&o.version===t.version&&!le(t))return o.bounds;if(i&&t.angle!==0){let s=e.calculateBounds({...t,angle:0},n);return e.nonRotatedBoundsCache.set(t,{version:t.version,bounds:s}),s}let r=e.calculateBounds(t,n);return e.boundsCache.set(t,{version:t.version,bounds:r}),r}static calculateBounds(t,n){let i,[o,r,s,a,l,d]=W(t,n);if(Ie(t)){let[c,u,m,p]=os(t.points.map(([f,E])=>oe(D(f,E),D(l-t.x,d-t.y),t.angle)));return[c+t.x,u+t.y,m+t.x,p+t.y]}else if(K(t))i=If(t,l,d,n);else if(t.type==="diamond"){let[c,u]=oe(D(l,r),D(l,d),t.angle),[m,p]=oe(D(l,a),D(l,d),t.angle),[f,E]=oe(D(o,d),D(l,d),t.angle),[h,g]=oe(D(s,d),D(l,d),t.angle),x=Math.min(c,m,f,h),w=Math.min(u,p,E,g),b=Math.max(c,m,f,h),y=Math.max(u,p,E,g);i=[x,w,b,y]}else if(t.type==="ellipse"){let c=(s-o)/2,u=(a-r)/2,m=Math.cos(t.angle),p=Math.sin(t.angle),f=Math.hypot(c*m,u*p),E=Math.hypot(u*m,c*p);i=[l-f,d-E,l+f,d+E]}else{let[c,u]=oe(D(o,r),D(l,d),t.angle),[m,p]=oe(D(o,a),D(l,d),t.angle),[f,E]=oe(D(s,a),D(l,d),t.angle),[h,g]=oe(D(s,r),D(l,d),t.angle),x=Math.min(c,m,f,h),w=Math.min(u,p,E,g),b=Math.max(c,m,f,h),y=Math.max(u,p,E,g);i=[x,w,b,y]}return i}},W=(e,t,n=!1)=>{if(Ie(e))return wf(e);if(K(e))return R.getElementAbsoluteCoords(e,t,n);if(J(e)){let i=t?Se(e,t):null;if(H(i)){let{x:o,y:r}=R.getBoundTextElementPosition(i,e,t);return[o,r,o+e.width,r+e.height,o+e.width/2,r+e.height/2]}}return[e.x,e.y,e.x+e.width,e.y+e.height,e.x+e.width/2,e.y+e.height/2]},Zr=(e,t)=>{let n=id(e,t),[i,o,r,s,a,l]=W(e,t),d=D(a,l);if(n.type==="polycurve"){let g=n.data.map(w=>xt(w,10)),x=[];if(bt(e)&&!e.polygon||H(e))for(let w of g){let b=0;for(;b<w.length-1;)x.push(Ee(D(w[b][0],w[b][1]),D(w[b+1][0],w[b+1][1]))),b++}else{let w=g.flat(),b=0;for(;b<w.length-1;)x.push(Ee(D(w[b][0],w[b][1]),D(w[b+1][0],w[b+1][1]))),b++}return x}else{if(n.type==="polyline")return n.data;if(gf(e)){let[h,g]=vn(e),x=g.map(b=>sd(b,d,e.angle)).flat();return[...rd(h,d,e.angle),...x]}else if(e.type==="diamond"){let[h,g]=Dn(e),x=g.map(b=>sd(b,d,e.angle)).flat();return[...rd(h,d,e.angle),...x]}else if(n.type==="polygon"){if(J(e)){let x=Se(e,t);if(x&&K(x))return[Ee(D(i,o),D(r,o)),Ee(D(r,o),D(r,s)),Ee(D(r,s),D(i,s)),Ee(D(i,s),D(i,o))]}let h=n.data,g=[];for(let x=0;x<h.length-1;x++)g.push(Ee(h[x],h[x+1]));return g}else if(n.type==="ellipse")return xf(e)}let[c,u,m,p,,,f,E]=[[i,o],[r,o],[i,s],[r,s],[a,o],[a,s],[i,l],[r,l]].map(h=>oe(h,d,e.angle));return[Ee(c,u),Ee(m,p),Ee(c,m),Ee(u,p),Ee(c,E),Ee(m,E),Ee(u,f),Ee(p,f)]},gf=e=>e!=null&&(e.type==="rectangle"||e.type==="image"||e.type==="iframe"||e.type==="embeddable"||e.type==="frame"||e.type==="magicframe"||e.type==="text"&&!e.containerId),rd=(e,t,n)=>e.map(i=>Ee(oe(i[0],t,n),oe(i[1],t,n))),sd=(e,t,n)=>{let i=xt(e,10),o=0,r=[];for(;o<i.length-1;)r.push(Ee(oe(D(i[o][0],i[o][1]),t,n),oe(D(i[o+1][0],i[o+1][1]),t,n))),o++;return r},xf=e=>{let t=D(e.x+e.width/2,e.y+e.height/2),n=e.width/2,i=e.height/2,o=[],r=[],s=90,a=Math.PI*2/s;for(let l=0;l<s;l++){let d=l*a,c=t[0]+n*Math.cos(d),u=t[1]+i*Math.sin(d);r.push(oe(D(c,u),t,e.angle))}for(let l=0;l<r.length-1;l++)o.push(Ee(r[l],r[l+1]));return o.push(Ee(r[r.length-1],r[0])),o},W0=e=>[e.x,e.y,e.x+e.width,e.y+e.height,e.x+e.width/2,e.y+e.height/2],Ln=e=>{let t=Math.floor(e.width/2)+1,n=0,i=e.width,o=Math.floor(e.height/2)+1,r=t,s=e.height;return[t,n,i,o,r,s,0,o]},ad=(e,t,n,i,o)=>{let r=1-e;return Math.pow(r,3)*t+3*Math.pow(r,2)*e*n+3*r*Math.pow(e,2)*i+Math.pow(e,3)*o},ld=(e,t,n,i)=>{let o=t-e,r=n-t,s=i-n,a=3*o-6*r+3*s,l=6*r-6*o,d=3*o,c=l*l-4*a*d;if(!(c>=0))return!1;let m=null,p=null,f=1/0,E=1/0;return a===0?f=E=-d/l:(f=(-l+Math.sqrt(c))/(2*a),E=(-l-Math.sqrt(c))/(2*a)),f>=0&&f<=1&&(m=ad(f,e,t,n,i)),E>=0&&E<=1&&(p=ad(E,e,t,n,i)),[m,p]},io=(e,t,n,i)=>{let o=ld(e[0],t[0],n[0],i[0]),r=ld(e[1],t[1],n[1],i[1]),s=Math.min(e[0],i[0]),a=Math.max(e[0],i[0]);if(o){let c=o.filter(u=>u!==null);s=Math.min(s,...c),a=Math.max(a,...c)}let l=Math.min(e[1],i[1]),d=Math.max(e[1],i[1]);if(r){let c=r.filter(u=>u!==null);l=Math.min(l,...c),d=Math.max(d,...c)}return[s,l,a,d]},gi=(e,t)=>{let n=D(0,0),{minX:i,minY:o,maxX:r,maxY:s}=e.reduce((a,{op:l,data:d})=>{if(l==="move"){let c=cd(d);ns(c!=null,"Op data is not a point"),n=c}else if(l==="bcurveTo"){let c=D(d[0],d[1]),u=D(d[2],d[3]),m=D(d[4],d[5]),p=t?t(c):c,f=t?t(u):u,E=t?t(m):m,h=t?t(n):n;n=m;let[g,x,w,b]=io(h,p,f,E);a.minX=Math.min(a.minX,g),a.minY=Math.min(a.minY,x),a.maxX=Math.max(a.maxX,w),a.maxY=Math.max(a.maxY,b)}return a},{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0});return[i,o,r,s]},os=e=>{let t=1/0,n=1/0,i=-1/0,o=-1/0;for(let[r,s]of e)t=Math.min(t,r),n=Math.min(n,s),i=Math.max(i,r),o=Math.max(o,s);return[t,n,i,o]},wf=e=>{let[t,n,i,o]=os(e.points),r=t+e.x,s=n+e.y,a=i+e.x,l=o+e.y;return[r,s,a,l,(r+a)/2,(s+l)/2]},yf=e=>{switch(e){case"arrow":return 25;case"diamond":case"diamond_outline":return 12;case"crowfoot_many":case"crowfoot_one":case"crowfoot_one_or_many":return 20;default:return 15}},bf=e=>{switch(e){case"bar":return 90;case"arrow":return 20;default:return 25}},es=(e,t,n,i)=>{if(t.length<1)return null;let o=wt(t[0]);if(o.length<1)return null;let r=n==="start"?1:o.length-1,s=o[r].data;ns(s.length===6,"Op data length is not 6");let a=D(s[4],s[5]),l=D(s[2],s[3]),d=D(s[0],s[1]),c=o[r-1],u=D(0,0);if(c.op==="move"){let N=cd(c.data);ns(N!=null,"Op data is not a point"),u=N}else c.op==="bcurveTo"&&(u=D(c.data[4],c.data[5]));let m=(N,Y)=>Math.pow(1-N,3)*a[Y]+3*N*Math.pow(1-N,2)*l[Y]+3*Math.pow(N,2)*(1-N)*d[Y]+u[Y]*Math.pow(N,3),[p,f]=n==="start"?u:a,[E,h]=[m(.3,0),m(.3,1)],g=Math.hypot(p-E,f-h),x=(p-E)/g,w=(f-h)/g,b=yf(i),y=0;{let[N,Y]=n==="end"?e.points[e.points.length-1]:e.points[0],[F,T]=e.points.length>1?n==="end"?e.points[e.points.length-2]:e.points[1]:[0,0];y=Math.hypot(N-F,Y-T)}let S=Math.min(b,y*(i==="diamond"||i==="diamond_outline"?.25:.5)),A=p-x*S,M=f-w*S;if(i==="dot"||i==="circle"||i==="circle_outline"){let N=Math.hypot(M-f,A-p)+e.strokeWidth-2;return[p,f,N]}let O=bf(i);if(i==="crowfoot_many"||i==="crowfoot_one_or_many"){let[N,Y]=oe(D(p,f),D(A,M),ts(-O)),[F,T]=oe(D(p,f),D(A,M),ts(O));return[A,M,N,Y,F,T]}let[L,G]=oe(D(A,M),D(p,f),-O*Math.PI/180),[B,U]=oe(D(A,M),D(p,f),ts(O));if(i==="diamond"||i==="diamond_outline"){let N,Y;if(n==="start"){let[F,T]=e.points.length>1?e.points[1]:[0,0];[N,Y]=oe(D(p+S*2,f),D(p,f),Math.atan2(T-f,F-p))}else{let[F,T]=e.points.length>1?e.points[e.points.length-2]:[0,0];[N,Y]=oe(D(p-S*2,f),D(p,f),Math.atan2(f-T,p-F))}return[p,f,L,G,N,Y,B,U]}return[p,f,L,G,B,U]},Pf=e=>{let t=En.generator(),n=ke(e),i=e.roundness?"curve":n.fill?"polygon":"linearPath";return t[i](e.points,n)},If=(e,t,n,i)=>{let o=V(e,i);if(e.points.length<2){let[u,m]=e.points[0],[p,f]=oe(D(e.x+u,e.y+m),D(t,n),e.angle),E=[p,f,p,f];if(o){let h=R.getMinMaxXYWithBoundText(e,i,[p,f,p,f],o);E=[h[0],h[1],h[2],h[3]]}return E}let s=Me.get(e)?.[0]??Pf(e),a=wt(s),d=gi(a,([u,m])=>oe(D(e.x+u,e.y+m),D(t,n),e.angle)),c=[d[0],d[1],d[2],d[3]];if(o){let u=R.getMinMaxXYWithBoundText(e,i,c,o);c=[u[0],u[1],u[2],u[3]]}return c},se=(e,t,n=!1)=>is.getBounds(e,t,n),Ye=(e,t)=>{if(!hf(e))return[0,0,0,0];let n=1/0,i=-1/0,o=1/0,r=-1/0,s=t||dd(e);return e.forEach(a=>{let[l,d,c,u]=se(a,s);n=Math.min(n,l),o=Math.min(o,d),i=Math.max(i,c),r=Math.max(r,u)}),[n,o,i,r]},V0=(e,t)=>{let[n,i,o,r]=Ye(e);return[n+t.x,i+t.y,o+t.x,r+t.y]},Xt=(e,t,n,i)=>{if(!(K(e)||Ie(e)))return[e.x,e.y,e.x+t,e.y+n];let o=od(0,t,od(1,n,e.points,i),i),r;if(Ie(e))r=os(o);else{let c=En.generator(),u=e.roundness?c.curve(o,ke(e)):c.linearPath(o,ke(e)),m=wt(u);r=gi(m)}let[s,a,l,d]=r;return[s+e.x,a+e.y,l+e.x,d+e.y]},Yr=(e,t)=>{let n=En.generator(),i=e.roundness==null?n.linearPath(t,ke(e)):n.curve(t,ke(e)),o=wt(i),[r,s,a,l]=gi(o);return[r+e.x,s+e.y,a+e.x,l+e.y]},$0=(e,t)=>{if(!e.length)return[0,0,0,0];let n=1/0,i=e[0],o=dd(e);return e.forEach(r=>{let[s,a,l,d]=se(r,o),c=Ef(D((s+l)/2,(a+d)/2),D(t.x,t.y));c<n&&(n=c,i=r)}),se(i,o)},Rt=e=>{let[t,n,i,o]=Ye(e);return{minX:t,minY:n,maxX:i,maxY:o,width:i-t,height:o-n,midX:(t+i)/2,midY:(n+o)/2}},Z0=({scrollX:e,scrollY:t,width:n,height:i,zoom:o})=>[-e,-t,-e+n/o.value,-t+i/o.value],ct=e=>D(e[0]+(e[2]-e[0])/2,e[1]+(e[3]-e[1])/2),$e=(e,t,n)=>{let i={minX:e.x,minY:e.y,maxX:e.x+e.width,maxY:e.y+e.height,midX:e.x+e.width/2,midY:e.y+e.height/2},o=fe(e,t),[r,s]=oe(D(i.minX,i.minY),o,e.angle),[a,l]=oe(D(i.maxX,i.minY),o,e.angle),[d,c]=oe(D(i.maxX,i.maxY),o,e.angle),[u,m]=oe(D(i.minX,i.maxY),o,e.angle),p=[Math.min(r,a,d,u),Math.min(s,l,c,m),Math.max(r,a,d,u),Math.max(s,l,c,m)];if(n){let[f,E,h,g]=n;return[p[0]-g,p[1]-f,p[2]+E,p[3]+h]}return p},Zt=(e,t)=>e[0]>t[0]&&e[0]<t[2]&&e[1]>t[1]&&e[1]<t[3],bn=(e,t)=>{if(e==null||t==null)return!1;let[n,i,o,r]=e,[s,a,l,d]=t;return n<l&&o>s&&i<d&&r>a},fe=(e,t,n=0,i=0)=>{if(K(e)){let[s,a,l,d]=W(e,t),[c,u]=D((s+l)/2,(a+d)/2);return D(c+n,u+i)}let[o,r]=ct(se(e,t));return D(o+n,r+i)};var Tf=.1,md=e=>K(e)||Ie(e)?e.points.length<2||e.points.length===2&&H(e)&&Af(e.points[0],e.points[e.points.length-1],Tf):e.width===0&&e.height===0,kl=(e,t,n,i,o)=>{let[r,s,a,l]=se(e,o),d=Bo({clientX:i.offsetLeft,clientY:i.offsetTop},i),c=Bo({clientX:i.offsetLeft+t,clientY:i.offsetTop+n},i);return d.x<=a&&d.y<=l&&c.x>=r&&c.y>=s},i1=(e,t,n,i,o,r)=>{let[s,a,l,d]=Ye(e,o),c=Bo({clientX:i.offsetLeft+(r?.left||0),clientY:i.offsetTop+(r?.top||0)},i),u=Bo({clientX:i.offsetLeft+t-(r?.right||0),clientY:i.offsetTop+n-(r?.bottom||0)},i);return s>=c.x&&a>=c.y&&l<=u.x&&d<=u.y},rs=(e,t,n)=>{let i=Math.abs(t),o=Math.abs(n);if(e==="line"||e==="arrow"||e==="freedraw"){let r=Math.round(Math.atan(o/i)/Ft)*Ft;r===0?n=0:r===Math.PI/2?t=0:n=i*Math.tan(r)*Math.sign(n)||n}else e!=="selection"&&(n=i*Math.sign(n));return{width:t,height:n}},xl=(e,t,n,i,o)=>{let r=n-e,s=i-t,a=Math.atan2(s,r),l=Math.round(a/Ft)*Ft;if(o){let d=Math.floor(o/Ft)*Ft;Sf(a,d,d+Ft)&&(Mf(a,o)<Ft/6?l=o:ud(a)>ud(o)?l=d+Ft:l=d)}if(l===0)s=0;else if(l===Math.PI/2)r=0;else{let d=Math.tan(l),c=-1,u=t-d*e,m=-1/d,p=-1,f=i-m*n,E=(c*f-p*u)/(d*p-m*c),h=(u*m-f*d)/(d*p-m*c);r=E-e,s=h-t}return{width:r,height:s}},o1=e=>{let t={width:e.width,height:e.height,x:e.x,y:e.y};if(e.width<0){let n=Math.abs(e.width);t.width=n,t.x=e.x-n}if(e.height<0){let n=Math.abs(e.height);t.height=n,t.y=e.y-n}return t};P();var c1=(e,t,n,i)=>{let o=Io(e,n.getNonDeletedElementsMap(),i),r=Rt(e);return o.flatMap(s=>{let a=vf(s,r,t);return s.map(l=>{let d=n.mutateElement(l,{x:l.x+a.x,y:l.y+a.y});return Ue(l,n,{simultaneouslyUpdated:s}),d})})},vf=(e,t,{axis:n,position:i})=>{let o=Rt(e),[r,s]=n==="x"?["minX","maxX"]:["minY","maxY"],a={x:0,y:0};return i==="start"?{...a,[n]:t[r]-o[r]}:i==="end"?{...a,[n]:t[s]-o[s]}:{...a,[n]:(t[r]+t[s])/2-(o[r]+o[s])/2}};P();import{arrayToMap as Ih,arrayToObject as Nt,assertNever as Yd,isDevEnv as un,isShallowEqual as Xd,isTestEnv as mn,randomInteger as Ud}from"@excalidraw/common";P();import{assertNever as Hf,COLOR_PALETTE as zf,isDevEnv as _f,isTestEnv as Uf,randomId as Yf,Emitter as hd,toIterable as Hn}from"@excalidraw/common";P();import{ORIG_ID as Cf,randomId as fd,randomInteger as Gf,arrayToMap as Of,castArray as ss,findLastIndex as wi,getUpdatedTimestamp as kf,isTestEnv as Rf}from"@excalidraw/common";P();import{arrayToMapWithIndex as Df}from"@excalidraw/common";var Lf=e=>{let t=e.slice(),n=new Set,i=r=>{let s=r[0]?.groupIds?.join(""),a=[r[0]],l=[];for(let d of r.slice(1))d.groupIds?.join("")===s?a.push(d):l.push(d);return l.length?[...a,...i(l)]:a},o=new Map;return t.forEach((r,s)=>{if(!o.has(r.id))if(r.groupIds?.length){let a=r.groupIds[r.groupIds.length-1],l=t.slice(s).filter(d=>{let c=d?.groupIds?.some(u=>u===a);return c&&o.set(d.id,!0),c});for(let d of i(l))n.add(d)}else n.add(r)}),n.size!==e.length?(console.error("normalizeGroupElementOrder: lost some elements... bailing!"),e):[...n]},Bf=e=>{let t=Df(e),n=e.slice(),i=new Set;return n.forEach((o,r)=>{o&&(o.boundElements?.length?(i.add(o),n[r]=null,o.boundElements.forEach(s=>{let a=t.get(s.id);a&&s.type==="text"&&(i.add(a[0]),n[a[1]]=null)})):o.type==="text"&&o.containerId&&t.get(o.containerId)?.[0].boundElements?.find(a=>a.id===o.id)||(i.add(o),n[r]=null))}),i.size!==e.length?(console.error("normalizeBoundElementsOrder: lost some elements... bailing!"),e):[...i]},pd=e=>Bf(Lf(e));var Ff=(e,t,n,i)=>{let o=ls(n);return Rf()&&Nf(o,n.id),o.id=fd(),o.updated=kf(),i&&(o.seed=Gf(),Ka(o)),o.groupIds=Gl(o.groupIds,e,r=>(t.has(r)||t.set(r,fd()),t.get(r))),o},S1=e=>{let{elements:t}=e,n="appState"in e?e.appState:{editingGroupId:null,selectedGroupIds:{}},i=new Map,o=new Map,r=[],s=[],a=new Map,l=new Map,d=new Map,c=Of(t),u=e.type==="in-place"?e.idsOfElementsToDuplicate:new Map(t.map(h=>[h.id,h]));if(e.type==="in-place")for(let h of Object.keys(e.appState.selectedGroupIds))t.filter(g=>g.groupIds?.includes(h)).forEach(g=>u.set(g.id,g));t=pd(t);let m=t.slice(),p=h=>{let x=ss(h).reduce((w,b)=>{if(i.has(b.id))return w;i.set(b.id,!0);let y=Ff(n.editingGroupId,o,b,e.randomizeSeed);return i.set(y.id,!0),d.set(y.id,y),a.set(b.id,y.id),l.set(y.id,b),s.push(b),r.push(y),w.push(y),w},[]);return Array.isArray(h)?x:x[0]||null},f=(h,g)=>{if(g){if(h>m.length-1){m.push(...ss(g));return}m.splice(h+1,0,...ss(g))}},E=new Set(t.filter(h=>u.has(h.id)&&q(h)).map(h=>h.id));for(let h of t){if(i.has(h.id)||!u.has(h.id))continue;let g=Wr(n,h);if(g){let x=ve(t,g).flatMap(b=>q(b)?[...rn(t,b.id),b]:[b]),w=wi(m,b=>b.groupIds?.includes(g));f(w,p(x));continue}if(!(h.frameId&&E.has(h.frameId))){if(q(h)){let x=h.id,w=rn(t,x),b=wi(m,y=>y.frameId===x||y.id===x);f(b,p([...w,h]));continue}if(lt(h)){let x=V(h,c),w=wi(m,b=>b.id===h.id||"containerId"in b&&b.containerId===h.id);x?f(w,p([h,x])):f(w,p(h));continue}if(le(h)){let x=Se(h,c),w=wi(m,b=>b.id===h.id||b.id===x?.id);x?f(w,p([x,h])):f(w,p(h));continue}f(wi(m,x=>x.id===h.id),p(h))}}if(rl(r,a,d),Rl(m,s,a),e.overrides)for(let h of r){let g=l.get(h.id);g&&Object.assign(h,e.overrides({duplicateElement:h,origElement:g,origIdToDuplicateId:a}))}return{duplicatedElements:r,duplicateElementsMap:d,elementsWithDuplicates:m,origIdToDuplicateId:a}},as=(e,t=0)=>{if(e==null||typeof e!="object")return e;let n=Object.prototype.toString.call(e);if(n==="[object Object]"){let i=typeof e.constructor=="function"?Object.create(Object.getPrototypeOf(e)):{};for(let o in e)if(e.hasOwnProperty(o)){if(t===0&&(o==="shape"||o==="canvas"))continue;i[o]=as(e[o],t+1)}return i}if(Array.isArray(e)){let i=e.length,o=new Array(i);for(;i--;)o[i]=as(e[i],t+1);return o}return v.DEV&&n!=="[object Object]"&&n!=="[object Array]"&&n.startsWith("[object ")&&console.warn(`_deepCloneElement: unexpected object type ${n}. This value will not be cloned!`),e},ls=e=>as(e),Nf=(e,t)=>{Object.defineProperty(e,Cf,{value:t,writable:!1,enumerable:!1})};var Re={IMMEDIATELY:"IMMEDIATELY",NEVER:"NEVER",EVENTUALLY:"EVENTUALLY"},Ed=class{constructor(t){this.app=t}onDurableIncrementEmitter=new hd;onStoreIncrementEmitter=new hd;scheduledMacroActions=new Set;scheduledMicroActions=[];_snapshot=cn.empty();get snapshot(){return this._snapshot}set snapshot(t){this._snapshot=t}scheduleAction(t){this.scheduledMacroActions.add(t),this.satisfiesScheduledActionsInvariant()}scheduleCapture(){this.scheduleAction(Re.IMMEDIATELY)}scheduleMicroAction(t){let{action:n}=t,i;if("change"in t)i=t.change;else{let r=cn.create(this.app.scene.getElementsMapIncludingDeleted(),this.app.state),s=r.maybeClone(n,t.elements?wd(t.elements):void 0,t.appState);i=yi.create(r,s)}let o="delta"in t?t.delta:void 0;this.scheduledMicroActions.push(()=>this.processAction({action:n,change:i,delta:o}))}commit(t,n){this.flushMicroActions();try{let i=this.getScheduledMacroAction();this.processAction({action:i,elements:t,appState:n})}finally{this.satisfiesScheduledActionsInvariant(),this.scheduledMacroActions=new Set}}clear(){this.snapshot=cn.empty(),this.scheduledMacroActions=new Set}emitDurableIncrement(t,n=void 0,i=void 0){let o=this.snapshot,r,s;if(n?r=n:r=yi.create(o,t),i?s=i:s=us.calculate(o,t),!s.isEmpty()){let a=new ds(r,s);this.onDurableIncrementEmitter.trigger(a),this.onStoreIncrementEmitter.trigger(a)}}emitEphemeralIncrement(t,n=void 0){let i;if(n)i=n;else{let r=this.snapshot;i=yi.create(r,t)}let o=new cs(i);this.onStoreIncrementEmitter.trigger(o)}applyChangeToSnapshot(t){let n=this.snapshot,i=this.snapshot.applyChange(t);return n===i?null:i}maybeCloneSnapshot(t,n,i){if(!n&&!i)return null;let o=this.snapshot,r=this.snapshot.maybeClone(t,n,i);return o===r?null:r}flushMicroActions(){for(let t of this.scheduledMicroActions)try{t()}catch(n){console.error("Failed to execute scheduled micro action",n)}this.scheduledMicroActions=[]}processAction(t){let{action:n}=t;if(n===Re.EVENTUALLY&&!this.onStoreIncrementEmitter.subscribers.length)return;let i;if("change"in t?i=this.applyChangeToSnapshot(t.change):i=this.maybeCloneSnapshot(n,t.elements,t.appState),!i)return;let o="change"in t?t.change:void 0,r="delta"in t?t.delta:void 0;try{switch(n){case Re.IMMEDIATELY:this.emitDurableIncrement(i,o,r);break;case Re.NEVER:case Re.EVENTUALLY:this.emitEphemeralIncrement(i,o);break;default:Hf(n,"Unknown store action")}}finally{switch(n){case Re.IMMEDIATELY:case Re.NEVER:this.snapshot=i;break}}}getScheduledMacroAction(){let t;return this.scheduledMacroActions.has(Re.IMMEDIATELY)?t=Re.IMMEDIATELY:this.scheduledMacroActions.has(Re.NEVER)?t=Re.NEVER:t=Re.EVENTUALLY,t}satisfiesScheduledActionsInvariant(){if(!(this.scheduledMacroActions.size>=0&&this.scheduledMacroActions.size<=Object.keys(Re).length)){let t=`There can be at most three store actions scheduled at the same time, but there are "${this.scheduledMacroActions.size}".`;if(console.error(t,this.scheduledMacroActions.values()),Uf()||_f())throw new Error(t)}}},yi=class e{constructor(t,n){this.elements=t;this.appState=n}static create(t,n){let i=n.getChangedElements(t),o=n.getChangedAppState(t);return new e(i,o)}},Co=class{constructor(t,n){this.type=t;this.change=n}static isDurable(t){return t.type==="durable"}static isEphemeral(t){return t.type==="ephemeral"}},ds=class extends Co{constructor(n,i){super("durable",n);this.change=n;this.delta=i}},cs=class extends Co{constructor(n){super("ephemeral",n);this.change=n}},us=class e{constructor(t,n,i){this.id=t;this.elements=n;this.appState=i}static create(t,n,i={id:Yf()}){return new this(i.id,t,n)}static calculate(t,n){let i=n.metadata.didElementsChange?dn.calculate(t.elements,n.elements):dn.empty(),o=n.metadata.didAppStateChange?ln.calculate(t.appState,n.appState):ln.empty();return this.create(i,o)}static restore(t){let{id:n,elements:i,appState:o}=t;return new this(n,dn.restore(i),ln.restore(o))}static load({id:t,elements:{added:n,removed:i,updated:o},appState:{delta:r}}){let s=dn.create(n,i,o),a=ln.create(r);return new this(t,s,a)}static squash(...t){let n=e.empty();for(let i of t)n.elements.squash(i.elements),n.appState.squash(i.appState);return n}static inverse(t){return this.create(t.elements.inverse(),t.appState.inverse())}static applyTo(t,n,i,o){let[r,s]=t.elements.applyTo(n,cn.empty().elements,o),[a,l]=t.appState.applyTo(i,r);return[r,a,s||l]}static applyLatestChanges(t,n,i,o){return this.create(t.elements.applyLatestChanges(n,i,o),t.appState,{id:t.id})}static empty(){return e.create(dn.empty(),ln.empty())}isEmpty(){return this.elements.isEmpty()&&this.appState.isEmpty()}},cn=class e{constructor(t,n,i={didElementsChange:!1,didAppStateChange:!1,isEmpty:!1}){this.elements=t;this.appState=n;this.metadata=i}_lastChangedElementsHash=0;_lastChangedAppStateHash=0;static create(t,n,i={didElementsChange:!1,didAppStateChange:!1}){return new e(t,gd(n)?n:zn(n),i)}static empty(){return new e(new Map,Xf(),{didElementsChange:!1,didAppStateChange:!1,isEmpty:!0})}getChangedElements(t){let n={};for(let i of Hn(t.elements))this.elements.get(i.id)||(n[i.id]=ge(i,{isDeleted:!0}));for(let i of Hn(this.elements))t.elements.get(i.id)!==i&&(n[i.id]=i);return n}getChangedAppState(t){return _.getRightDifferences(t.appState,this.appState).reduce((n,i)=>Object.assign(n,{[i]:this.appState[i]}),{})}isEmpty(){return this.metadata.isEmpty}applyChange(t){let n=new Map(this.elements);for(let[o,r]of Object.entries(t.elements))n.set(o,r);let i=zn({...this.appState,...t.appState});return e.create(n,i,{didElementsChange:Object.keys(t.elements).length>0,didAppStateChange:Object.keys(t.appState).length>0})}maybeClone(t,n,i){let o={shouldCompareHashes:!1};t===Re.EVENTUALLY&&(o.shouldCompareHashes=!0);let r=this.maybeCreateElementsSnapshot(n,o),s=this.maybeCreateAppStateSnapshot(i,o),a=!1,l=!1;return this.elements!==r&&(a=!0),this.appState!==s&&(l=!0),!a&&!l?this:new e(r,s,{didElementsChange:a,didAppStateChange:l})}maybeCreateAppStateSnapshot(t,n={shouldCompareHashes:!1}){if(!t)return this.appState;let i=gd(t)?t:zn(t);return this.detectChangedAppState(i,n)?i:this.appState}maybeCreateElementsSnapshot(t,n={shouldCompareHashes:!1}){if(!t)return this.elements;let i=this.detectChangedElements(t,n);return i?.size?this.createElementsSnapshot(i):this.elements}detectChangedAppState(t,n={shouldCompareHashes:!1}){if(this.appState===t)return;let i=_.isRightDifferent(this.appState,t);if(!i)return;let o=bd(JSON.stringify(t));if(!(n.shouldCompareHashes&&this._lastChangedAppStateHash===o))return this._lastChangedAppStateHash=o,i}detectChangedElements(t,n={shouldCompareHashes:!1}){if(this.elements===t)return;let i=new Map;for(let r of Hn(this.elements))t.get(r.id)||i.set(r.id,ge(r,{isDeleted:!0}));for(let r of Hn(t)){let s=this.elements.get(r.id);if(!s||s.version<r.version){if(xe(r)&&!jt(r))continue;i.set(r.id,r)}}if(!i.size)return;let o=yd(i);if(!(n.shouldCompareHashes&&this._lastChangedElementsHash===o))return this._lastChangedElementsHash=o,i}createElementsSnapshot(t){let n=new Map;for(let i of Hn(this.elements))n.set(i.id,i);for(let i of Hn(t))n.set(i.id,ls(i));return n}},xd="__observedAppState",Xf=()=>({name:null,editingGroupId:null,viewBackgroundColor:zf.white,selectedElementIds:{},selectedGroupIds:{},selectedLinearElement:null,croppingElementId:null,activeLockedId:null,lockedMultiSelections:{}}),zn=e=>{let t={name:e.name,editingGroupId:e.editingGroupId,viewBackgroundColor:e.viewBackgroundColor,selectedElementIds:e.selectedElementIds,selectedGroupIds:e.selectedGroupIds,croppingElementId:e.croppingElementId,activeLockedId:e.activeLockedId,lockedMultiSelections:e.lockedMultiSelections,selectedLinearElement:e.selectedLinearElement?{elementId:e.selectedLinearElement.elementId,isEditing:!!e.selectedLinearElement.isEditing}:null};return Reflect.defineProperty(t,xd,{value:!0,enumerable:!1}),t},gd=e=>!!Reflect.get(e,xd);P();P();var Sd="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function Un(e,t,n){let i=n[0];if(t!=null&&e>=t)throw new Error(e+" >= "+t);if(e.slice(-1)===i||t&&t.slice(-1)===i)throw new Error("trailing zero");if(t){let s=0;for(;(e[s]||i)===t[s];)s++;if(s>0)return t.slice(0,s)+Un(e.slice(s),t.slice(s),n)}let o=e?n.indexOf(e[0]):0,r=t!=null?n.indexOf(t[0]):n.length;if(r-o>1){let s=Math.round(.5*(o+r));return n[s]}else return t&&t.length>1?t.slice(0,1):n[o]+Un(e.slice(1),null,n)}function Md(e){if(e.length!==Ad(e[0]))throw new Error("invalid integer part of order key: "+e)}function Ad(e){if(e>="a"&&e<="z")return e.charCodeAt(0)-97+2;if(e>="A"&&e<="Z")return 90-e.charCodeAt(0)+2;throw new Error("invalid order key head: "+e)}function bi(e){let t=Ad(e[0]);if(t>e.length)throw new Error("invalid order key: "+e);return e.slice(0,t)}function Pd(e,t){if(e==="A"+t[0].repeat(26))throw new Error("invalid order key: "+e);let n=bi(e);if(e.slice(n.length).slice(-1)===t[0])throw new Error("invalid order key: "+e)}function Id(e,t){Md(e);let[n,...i]=e.split(""),o=!0;for(let r=i.length-1;o&&r>=0;r--){let s=t.indexOf(i[r])+1;s===t.length?i[r]=t[0]:(i[r]=t[s],o=!1)}if(o){if(n==="Z")return"a"+t[0];if(n==="z")return null;let r=String.fromCharCode(n.charCodeAt(0)+1);return r>"a"?i.push(t[0]):i.pop(),r+i.join("")}else return n+i.join("")}function jf(e,t){Md(e);let[n,...i]=e.split(""),o=!0;for(let r=i.length-1;o&&r>=0;r--){let s=t.indexOf(i[r])-1;s===-1?i[r]=t.slice(-1):(i[r]=t[s],o=!1)}if(o){if(n==="a")return"Z"+t.slice(-1);if(n==="A")return null;let r=String.fromCharCode(n.charCodeAt(0)-1);return r<"Z"?i.push(t.slice(-1)):i.pop(),r+i.join("")}else return n+i.join("")}function _n(e,t,n=Sd){if(e!=null&&Pd(e,n),t!=null&&Pd(t,n),e!=null&&t!=null&&e>=t)throw new Error(e+" >= "+t);if(e==null){if(t==null)return"a"+n[0];let l=bi(t),d=t.slice(l.length);if(l==="A"+n[0].repeat(26))return l+Un("",d,n);if(l<t)return l;let c=jf(l,n);if(c==null)throw new Error("cannot decrement any more");return c}if(t==null){let l=bi(e),d=e.slice(l.length),c=Id(l,n);return c??l+Un(d,null,n)}let i=bi(e),o=e.slice(i.length),r=bi(t),s=t.slice(r.length);if(i===r)return i+Un(o,s,n);let a=Id(i,n);if(a==null)throw new Error("cannot increment any more");return a<t?a:i+Un(o,null,n)}function Go(e,t,n,i=Sd){if(n===0)return[];if(n===1)return[_n(e,t,i)];if(t==null){let s=_n(e,t,i),a=[s];for(let l=0;l<n-1;l++)s=_n(s,t,i),a.push(s);return a}if(e==null){let s=_n(e,t,i),a=[s];for(let l=0;l<n-1;l++)s=_n(e,s,i),a.push(s);return a.reverse(),a}let o=Math.floor(n/2),r=_n(e,t,i);return[...Go(e,r,o,i),r,...Go(r,t,n-o-1,i)]}import{arrayToMap as Oo}from"@excalidraw/common";var ms=class extends Error{code="ELEMENT_HAS_INVALID_INDEX"},Wf=(e,{shouldThrow:t=!1,includeBoundTextValidation:n=!1,ignoreLogs:i,reconciliationContext:o})=>{let r=[],s=l=>`${l?.index}:${l?.id}:${l?.type}:${l?.isDeleted}:${l?.version}:${l?.versionNonce}`,a=e.map(l=>l.index);for(let[l,d]of a.entries()){let c=a[l-1],u=a[l+1];if(ps(d,c,u)||r.push(`Fractional indices invariant has been compromised: "${s(e[l-1])}", "${s(e[l])}", "${s(e[l+1])}"`),n&&lt(e[l])){let m=e[l],p=V(m,Oo(e));p&&p.index<=m.index&&r.push(`Fractional indices invariant for bound elements has been compromised: "${s(p)}", "${s(m)}"`)}}if(r.length){let l=new ms,d=[];if(o&&(d.push("Additional reconciliation context:"),d.push(o.localElements.map(c=>s(c))),d.push(o.remoteElements.map(c=>s(c)))),i||console.error(r.join(`

`),l.stack,e.map(c=>s(c)),...d),t)throw l}},vd=e=>e.sort((t,n)=>Td(t)&&Td(n)?t.index<n.index?-1:t.index>n.index?1:t.id<n.id?-1:1:1),Pi=(e,t)=>{try{let n=Oo(e),i=$f(e,t),o=fs(e,i),r=e.map(s=>{let a=o.get(s);return a?{...s,index:a.index}:s});Wf(r,{includeBoundTextValidation:!1,shouldThrow:!0,ignoreLogs:!0});for(let[s,{index:a}]of o)ye(s,n,{index:a})}catch{Vf(e)}return e},Vf=e=>{let t=Oo(e),n=Dd(e),i=fs(e,n);for(let[o,{index:r}]of i)ye(o,t,{index:r});return e},wd=e=>{let t=Oo(e),n=Dd(e),i=fs(e,n);for(let[o,{index:r}]of i)t.set(o.id,ge(o,{index:r}));return t},$f=(e,t)=>{let n=[],i=0;for(;i<e.length;)if(t.has(e[i].id)){let o=[i-1,i];for(;++i<e.length&&t.has(e[i].id);)o.push(i);o.push(i),n.push(o)}else i++;return n},Dd=e=>{let t=[],n,i,o=-1,r=0,s=d=>{let c=e[o]?e[o].index:void 0,u=e[d-1]?.index;return!c&&u||c&&u&&u>c?[u,d-1]:[c,o]},a=d=>{let c=e[r]?e[r].index:void 0;if(c&&d<r)return[c,r];let u=r;for(;++u<e.length;){let m=e[u]?.index;if(!c&&m||c&&m&&m>c)return[m,u]}return[void 0,u]},l=0;for(;l<e.length;){let d=e[l].index;if([n,o]=s(l),[i,r]=a(l),ps(d,n,i))l++;else{let c=[o,l];for(;++l<e.length;){let u=e[l].index,[m,p]=s(l),[f,E]=a(l);if(ps(u,m,f))break;[n,o]=[m,p],[i,r]=[f,E],c.push(l)}c.push(r),t.push(c)}}return t},ps=(e,t,n)=>e?t&&n?t<e&&e<n:!t&&n?e<n:t&&!n?t<e:!!e:!1,fs=(e,t)=>{let n=new Map;for(let i of t){let o=i.shift(),r=i.pop(),s=Go(e[o]?.index,e[r]?.index,i.length);for(let a=0;a<i.length;a++){let l=e[i[a]];n.set(l,{index:s[a]})}}return n},Td=e=>!!e.index;P();var _d=Cc(Od(),1);import{randomInteger as mh,arrayToMap as kd,toBrandedType as Rd,isDevEnv as Fd,isTestEnv as Nd,toArray as ph}from"@excalidraw/common";import{isNonDeletedElement as fh}from"@excalidraw/element";import{isFrameLikeElement as hh}from"@excalidraw/element";import{getElementsInGroup as Eh}from"@excalidraw/element";import{syncInvalidIndices as gh,syncMovedIndices as Hd,validateFractionalIndices as xh}from"@excalidraw/element";import{getSelectedElements as wh}from"@excalidraw/element";import{mutateElement as yh}from"@excalidraw/element";var zd=e=>{let t=new Map,n=[];for(let i of e)i.isDeleted||(n.push(i),t.set(i.id,i));return{elementsMap:t,elements:n}},bh=(0,_d.default)(e=>{(Fd()||Nd()||window?.DEBUG_FRACTIONAL_INDICES)&&xh(e,{shouldThrow:Fd()||Nd(),includeBoundTextValidation:!0})},1e3*60,{leading:!0,trailing:!1}),Ph=e=>{let t=["includeBoundTextElement","includeElementsInFrames"],n="";for(let i of t)n+=`${i}:${e[i]?"1":"0"}`;return n},Ro=class{callbacks=new Set;nonDeletedElements=[];nonDeletedElementsMap=Rd(new Map);elements=[];nonDeletedFramesLikes=[];frames=[];elementsMap=Rd(new Map);selectedElementsCache={selectedElementIds:null,elements:null,cache:new Map};sceneNonce;getSceneNonce(){return this.sceneNonce}getNonDeletedElementsMap(){return this.nonDeletedElementsMap}getElementsIncludingDeleted(){return this.elements}getElementsMapIncludingDeleted(){return this.elementsMap}getNonDeletedElements(){return this.nonDeletedElements}getFramesIncludingDeleted(){return this.frames}constructor(t=null,n){t&&this.replaceAllElements(t,n)}getSelectedElements(t){let n=Ph(t),i=t?.elements||this.nonDeletedElements;if(this.selectedElementsCache.elements===i&&this.selectedElementsCache.selectedElementIds===t.selectedElementIds){let r=this.selectedElementsCache.cache.get(n);if(r)return r}else t?.elements==null&&this.selectedElementsCache.cache.clear();let o=wh(i,{selectedElementIds:t.selectedElementIds},t);return t?.elements==null&&(this.selectedElementsCache.selectedElementIds=t.selectedElementIds,this.selectedElementsCache.elements=this.nonDeletedElements,this.selectedElementsCache.cache.set(n,o)),o}getNonDeletedFramesLikes(){return this.nonDeletedFramesLikes}getElement(t){return this.elementsMap.get(t)||null}getNonDeletedElement(t){let n=this.getElement(t);return n&&fh(n)?n:null}mapElements(t){let n=!1,i=this.elements.map(o=>{let r=t(o);return r!==o&&(n=!0),r});return n&&this.replaceAllElements(i),n}replaceAllElements(t,n){let i=ph(t),o=[];n?.skipValidation||bh(i),this.elements=gh(i),this.elementsMap.clear(),this.elements.forEach(s=>{hh(s)&&o.push(s),this.elementsMap.set(s.id,s)});let r=zd(this.elements);this.nonDeletedElements=r.elements,this.nonDeletedElementsMap=r.elementsMap,this.frames=o,this.nonDeletedFramesLikes=zd(this.frames).elements,this.triggerUpdate()}triggerUpdate(){this.sceneNonce=mh();for(let t of Array.from(this.callbacks))t()}onUpdate(t){if(this.callbacks.has(t))throw new Error;return this.callbacks.add(t),()=>{if(!this.callbacks.has(t))throw new Error;this.callbacks.delete(t)}}destroy(){this.elements=[],this.nonDeletedElements=[],this.nonDeletedFramesLikes=[],this.frames=[],this.elementsMap.clear(),this.selectedElementsCache.selectedElementIds=null,this.selectedElementsCache.elements=null,this.selectedElementsCache.cache.clear(),this.callbacks.clear()}insertElementAtIndex(t,n){if(!Number.isFinite(n)||n<0)throw new Error("insertElementAtIndex can only be called with index >= 0");let i=[...this.elements.slice(0,n),t,...this.elements.slice(n)];Hd(i,kd([t])),this.replaceAllElements(i)}insertElementsAtIndex(t,n){if(!t.length)return;if(!Number.isFinite(n)||n<0)throw new Error("insertElementAtIndex can only be called with index >= 0");let i=[...this.elements.slice(0,n),...t,...this.elements.slice(n)];Hd(i,kd(t)),this.replaceAllElements(i)}insertElement=t=>{let n=t.frameId?this.getElementIndex(t.frameId):this.elements.length;this.insertElementAtIndex(t,n)};insertElements=t=>{if(!t.length)return;let n=t[0]?.frameId?this.getElementIndex(t[0].frameId):this.elements.length;this.insertElementsAtIndex(t,n)};getElementIndex(t){return this.elements.findIndex(n=>n.id===t)}getContainerElement=t=>t&&t.containerId&&this.getElement(t.containerId)||null;getElementsFromId=t=>{let n=this.getNonDeletedElementsMap(),i=n.get(t);return i?[i]:Eh(n,t)};mutateElement(t,n,i={informMutation:!0,isDragging:!1}){let o=this.getNonDeletedElementsMap(),{version:r}=t,{version:s}=yh(t,o,n,i);return this.elementsMap.has(t.id)&&r!==s&&i.informMutation&&this.triggerUpdate(),t}};var _=class e{constructor(t,n){this.deleted=t;this.inserted=n}static create(t,n,i,o){let r=i&&o!=="inserted"?i(t,"deleted"):t,s=i&&o!=="deleted"?i(n,"inserted"):n;return new e(r,s)}static calculate(t,n,i,o){if(t===n)return e.empty();let r={},s={};for(let d of this.getDifferences(t,n))r[d]=t[d],s[d]=n[d];let[a,l]=o?o(r,s):[r,s];return e.create(a,l,i)}static empty(){return new e({},{})}static isEmpty(t){return!Object.keys(t.deleted).length&&!Object.keys(t.inserted).length}static merge(t,n,i=e.empty()){return e.create({...t.deleted,...n.deleted,...i.deleted},{...t.inserted,...n.inserted,...i.inserted})}static mergeObjects(t,n,i={}){let o={...t};for(let r of Object.keys(i))delete o[r];return{...o,...n}}static mergeArrays(t,n,i,o){return Object.values(e.mergeObjects(Nt(t??[],o),Nt(n??[],o),Nt(i??[],o)))}static diffObjects(t,n,i,o){if(!t[i]&&!n[i])return;let r=t[i]!==null&&typeof t[i]=="object",s=n[i]!==null&&typeof n[i]=="object";if(r||s){let a=t[i]??{},l=n[i]??{},d=e.getLeftDifferences(a,l).reduce((u,m)=>(u[m]=o(a[m]),u),{}),c=e.getRightDifferences(a,l).reduce((u,m)=>(u[m]=o(l[m]),u),{});Object.keys(d).length||Object.keys(c).length?(Reflect.set(t,i,d),Reflect.set(n,i,c)):(Reflect.deleteProperty(t,i),Reflect.deleteProperty(n,i))}else t[i]===n[i]&&(Reflect.deleteProperty(t,i),Reflect.deleteProperty(n,i))}static diffArrays(t,n,i,o){if(!(!t[i]&&!n[i])&&(Array.isArray(t[i])||Array.isArray(n[i]))){let r=Array.isArray(t[i])?t[i]:[],s=Array.isArray(n[i])?n[i]:[],a=Nt(e.getLeftDifferences(Nt(r,o),Nt(s,o)),d=>d),l=Nt(e.getRightDifferences(Nt(r,o),Nt(s,o)),d=>d);if(Object.keys(a).length||Object.keys(l).length){let d=r.filter(u=>a[o?o(u):String(u)]),c=s.filter(u=>l[o?o(u):String(u)]);Reflect.set(t,i,d),Reflect.set(n,i,c)}else Reflect.deleteProperty(t,i),Reflect.deleteProperty(n,i)}}static isLeftDifferent(t,n,i=!1){return!!this.distinctKeysIterator("left",t,n,i).next().value}static isRightDifferent(t,n,i=!1){return!!this.distinctKeysIterator("right",t,n,i).next().value}static isInnerDifferent(t,n,i=!1){return!!!!this.distinctKeysIterator("inner",t,n,i).next().value}static isDifferent(t,n,i=!1){return!!!!this.distinctKeysIterator("full",t,n,i).next().value}static getLeftDifferences(t,n,i=!1){return Array.from(this.distinctKeysIterator("left",t,n,i)).sort()}static getRightDifferences(t,n,i=!1){return Array.from(this.distinctKeysIterator("right",t,n,i)).sort()}static getInnerDifferences(t,n,i=!1){return Array.from(this.distinctKeysIterator("inner",t,n,i)).sort()}static getDifferences(t,n,i=!1){return Array.from(this.distinctKeysIterator("full",t,n,i)).sort()}static*distinctKeysIterator(t,n,i,o=!1){if(n===i)return;let r=[];t==="left"?r=Object.keys(n):t==="right"?r=Object.keys(i):t==="inner"?r=Object.keys(n).filter(s=>s in i):t==="full"?r=Array.from(new Set([...Object.keys(n),...Object.keys(i)])):Yd(t,`Unknown distinctKeysIterator's join param "${t}"`,!0);for(let s of r){let a=n[s],l=i[s];if(a!==l){if(!o&&typeof a=="object"&&typeof l=="object"&&a!==null&&l!==null&&Xd(a,l))continue;yield s}}}},ln=class e{constructor(t){this.delta=t}static create(t){return new e(t)}static calculate(t,n){let i=_.calculate(t,n,e.orderAppStateKeys,e.postProcess);return new e(i)}static restore(t){let{delta:n}=t;return new e(n)}static empty(){return new e(_.create({},{}))}inverse(){let t=_.create(this.delta.inserted,this.delta.deleted);return new e(t)}squash(t){if(t.isEmpty())return this;let n=_.mergeObjects(this.delta.deleted.selectedElementIds??{},t.delta.deleted.selectedElementIds??{}),i=_.mergeObjects(this.delta.inserted.selectedElementIds??{},t.delta.inserted.selectedElementIds??{}),o=_.mergeObjects(this.delta.deleted.selectedGroupIds??{},t.delta.deleted.selectedGroupIds??{}),r=_.mergeObjects(this.delta.inserted.selectedGroupIds??{},t.delta.inserted.selectedGroupIds??{}),s=_.mergeObjects(this.delta.deleted.lockedMultiSelections??{},t.delta.deleted.lockedMultiSelections??{}),a=_.mergeObjects(this.delta.inserted.lockedMultiSelections??{},t.delta.inserted.lockedMultiSelections??{}),l={},d={};return(Object.keys(n).length||Object.keys(i).length)&&(d.selectedElementIds=n,l.selectedElementIds=i),(Object.keys(o).length||Object.keys(r).length)&&(d.selectedGroupIds=o,l.selectedGroupIds=r),(Object.keys(s).length||Object.keys(a).length)&&(d.lockedMultiSelections=s,l.lockedMultiSelections=a),this.delta=_.merge(this.delta,t.delta,_.create(d,l)),this}applyTo(t,n){try{let{selectedElementIds:i={},selectedGroupIds:o={},lockedMultiSelections:r={}}=this.delta.deleted,{selectedElementIds:s={},selectedGroupIds:a={},lockedMultiSelections:l={},selectedLinearElement:d,...c}=this.delta.inserted,u=_.mergeObjects(t.selectedElementIds,s,i),m=_.mergeObjects(t.selectedGroupIds,a,o),p=_.mergeObjects(t.lockedMultiSelections,l,r),f=d&&n.has(d.elementId)?new R(n.get(d.elementId),n,d.isEditing):null,E={...t,...c,selectedElementIds:u,selectedGroupIds:m,lockedMultiSelections:p,selectedLinearElement:typeof d<"u"?f:t.selectedLinearElement},h=this.filterInvisibleChanges(t,E,n);return[E,h]}catch(i){if(console.error("Couldn't apply appstate change",i),mn()||un())throw i;return[t,!1]}}isEmpty(){return _.isEmpty(this.delta)}filterInvisibleChanges(t,n,i){let o=zn(t),r=zn(n),s=_.isRightDifferent(e.stripElementsProps(o),e.stripElementsProps(r)),a=_.isRightDifferent(e.stripStandaloneProps(o),e.stripStandaloneProps(r));if(!s&&!a)return!1;let l={value:s};if(a){let d=_.getRightDifferences(e.stripStandaloneProps(o),e.stripStandaloneProps(r)),c=new Set;(d.includes("editingGroupId")||d.includes("selectedGroupIds"))&&(c=Ll(i));for(let u of d)switch(u){case"selectedElementIds":n[u]=e.filterSelectedElements(n[u],i,l);break;case"selectedGroupIds":n[u]=e.filterSelectedGroups(n[u],c,l);break;case"croppingElementId":{let x=n[u];if(!x)l.value=!0;else{let w=i.get(x);w&&!w.isDeleted?l.value=!0:n[u]=null}break}case"editingGroupId":let m=n[u];m?c.has(m)?l.value=!0:n[u]=null:l.value=!0;break;case"selectedLinearElement":let p=n[u];if(!p)l.value=!0;else{let x=i.get(p.elementId);x&&!x.isDeleted?l.value=!0:n[u]=null}break;case"lockedMultiSelections":let f=t[u]||{},E=n[u]||{};Xd(f,E)||(l.value=!0);break;case"activeLockedId":let h=t[u]||null,g=n[u]||null;h!==g&&(l.value=!0);break;default:Yd(u,`Unknown ObservedElementsAppState's key "${u}"`,!0)}}return l.value}static filterSelectedElements(t,n,i){let o=Object.keys(t);if(!o.length)return i.value=!0,t;let r={...t};for(let s of o){let a=n.get(s);a&&!a.isDeleted?i.value=!0:delete r[s]}return r}static filterSelectedGroups(t,n,i){if(!Object.keys(t).length)return i.value=!0,t;let r={...t};for(let s of Object.keys(r))n.has(s)?i.value=!0:delete r[s];return r}static stripElementsProps(t){let{editingGroupId:n,selectedGroupIds:i,selectedElementIds:o,selectedLinearElement:r,croppingElementId:s,lockedMultiSelections:a,activeLockedId:l,...d}=t;return d}static stripStandaloneProps(t){let{name:n,viewBackgroundColor:i,...o}=t;return o}static postProcess(t,n){try{_.diffObjects(t,n,"selectedElementIds",i=>!0),_.diffObjects(t,n,"selectedGroupIds",i=>i??!1),_.diffObjects(t,n,"lockedMultiSelections",i=>i??{})}catch(i){if(console.error("Couldn't postprocess appstate change deltas."),mn()||un())throw i}finally{return[t,n]}}static orderAppStateKeys(t){let n={};for(let i of Object.keys(t).sort())n[i]=t[i];return n}},dn=class e{constructor(t,n,i){this.added=t;this.removed=n;this.updated=i}static create(t,n,i,o={shouldRedistribute:!1}){let r;if(o.shouldRedistribute){let s={},a={},l={},d=[...Object.entries(t),...Object.entries(n),...Object.entries(i)];for(let[c,u]of d)this.satisfiesAddition(u)?s[c]=u:this.satisfiesRemoval(u)?a[c]=u:l[c]=u;r=new e(s,a,l)}else r=new e(t,n,i);return(mn()||un())&&(e.validate(r,"added",this.satisfiesAddition),e.validate(r,"removed",this.satisfiesRemoval),e.validate(r,"updated",this.satisfiesUpdate)),r}static restore(t){let{added:n,removed:i,updated:o}=t;return e.create(n,i,o)}static satisfiesAddition=({deleted:t,inserted:n})=>t.isDeleted===!0&&!n.isDeleted;static satisfiesRemoval=({deleted:t,inserted:n})=>!t.isDeleted&&n.isDeleted===!0;static satisfiesUpdate=({deleted:t,inserted:n})=>!!t.isDeleted==!!n.isDeleted;static satisfiesCommmonInvariants=({deleted:t,inserted:n})=>!!(Number.isInteger(t.version)&&Number.isInteger(n.version)&&t.version>=0&&n.version>=0&&t.version!==n.version);static satisfiesUniqueInvariants=(t,n)=>{let{added:i,removed:o,updated:r}=t;return[i[n],o[n],r[n]].filter(Boolean).length===1};static validate(t,n,i){for(let[o,r]of Object.entries(t[n]))if(!this.satisfiesCommmonInvariants(r)||!this.satisfiesUniqueInvariants(t,o)||!i(r))throw console.error(`Broken invariant for "${n}" delta, element "${o}", delta:`,r),new Error(`ElementsDelta invariant broken for element "${o}".`)}static calculate(t,n){if(t===n)return e.empty();let i={},o={},r={};for(let s of t.values())if(!n.get(s.id)){let l={...s},d={isDeleted:!0,version:s.version+1,versionNonce:Ud()},c=_.create(l,d,e.stripIrrelevantProps);s.isDeleted?r[s.id]=c:o[s.id]=c}for(let s of n.values()){let a=t.get(s.id);if(!a){let l={isDeleted:!0,version:s.version-1,versionNonce:Ud()},d={...s},c=_.create(l,d,e.stripIrrelevantProps);s.isDeleted?r[s.id]=c:i[s.id]=c;continue}if(a.versionNonce!==s.versionNonce){let l=_.calculate(a,s,e.stripIrrelevantProps,e.postProcess);if(typeof a.isDeleted=="boolean"&&typeof s.isDeleted=="boolean"&&a.isDeleted!==s.isDeleted){a.isDeleted&&!s.isDeleted?i[s.id]=l:o[s.id]=l;continue}r[s.id]=l}}return e.create(i,o,r)}static empty(){return e.create({},{},{})}inverse(){let t=r=>{let s={};for(let[a,{inserted:l,deleted:d}]of Object.entries(r))s[a]=_.create({...l},{...d});return s},n=t(this.added),i=t(this.removed),o=t(this.updated);return e.create(i,n,o)}isEmpty(){return Object.keys(this.added).length===0&&Object.keys(this.removed).length===0&&Object.keys(this.updated).length===0}applyLatestChanges(t,n,i){let o=(d,c)=>(u,m)=>{let p;switch(m){case"deleted":p=d;break;case"inserted":p=c;break}if(!p)return console.error("Element not found when trying to apply latest changes"),u;let f={};for(let E of Object.keys(u))switch(E){case"boundElements":f[E]=u[E];break;default:f[E]=p[E]}return f},r=d=>{let c={};for(let[u,m]of Object.entries(d)){let p=t.get(u),f=n.get(u),E=null;p||f?E=_.create(m.deleted,m.inserted,o(p,f),i):E=m,_.isInnerDifferent(E.deleted,E.inserted)&&(c[u]=E)}return c},s=r(this.added),a=r(this.removed),l=r(this.updated);return e.create(s,a,l,{shouldRedistribute:!0})}applyTo(t,n=cn.empty().elements,i){let o=new Map(t),r,s={containsVisibleDifference:!1,containsZindexDifference:!1,applyDirection:void 0};try{let a=e.createApplier(t,o,n,s,i),l=a(this.added),d=a(this.removed),c=a(this.updated),u=this.resolveConflicts(t,o,s.applyDirection);r=new Map([...l,...d,...c,...u])}catch(a){if(console.error("Couldn't apply elements delta",a),mn()||un())throw a;return[t,!0]}try{o=e.reorderElements(o,r,s),e.redrawElements(o,r)}catch(a){if(console.error("Couldn't mutate elements after applying elements change",a),mn()||un())throw a}finally{return[o,s.containsVisibleDifference]}}squash(t){if(t.isEmpty())return this;let{added:n,removed:i,updated:o}=t,r=(s,a)=>{let l=_.mergeArrays(s.deleted.boundElements??[],a.deleted.boundElements??[],void 0,c=>c.id)??[],d=_.mergeArrays(s.inserted.boundElements??[],a.inserted.boundElements??[],void 0,c=>c.id)??[];if(!(!l.length&&!d.length))return _.create({boundElements:l},{boundElements:d})};for(let[s,a]of Object.entries(n)){let l=this.added[s]??this.removed[s]??this.updated[s];if(!l)this.added[s]=a;else{let d=r(l,a);delete this.removed[s],delete this.updated[s],this.added[s]=_.merge(l,a,d)}}for(let[s,a]of Object.entries(i)){let l=this.added[s]??this.removed[s]??this.updated[s];if(!l)this.removed[s]=a;else{let d=r(l,a);delete this.added[s],delete this.updated[s],this.removed[s]=_.merge(l,a,d)}}for(let[s,a]of Object.entries(o)){let l=this.added[s]??this.removed[s]??this.updated[s];if(!l)this.updated[s]=a;else{let d=r(l,a),c=_.merge(l,a,d);l===this.added[s]?this.added[s]=c:l===this.removed[s]?this.removed[s]=c:this.updated[s]=c}}return(mn()||un())&&(e.validate(this,"added",e.satisfiesAddition),e.validate(this,"removed",e.satisfiesRemoval),e.validate(this,"updated",e.satisfiesUpdate)),this}static createApplier=(t,n,i,o,r)=>s=>{let a=e.createGetter(n,i,o);return Object.entries(s).reduce((l,[d,c])=>{let u=a(d,c.inserted);if(u){let m=e.applyDelta(u,c,o,r);if(n.set(m.id,m),l.set(m.id,m),!o.applyDirection){let p=t.get(d);p&&(o.applyDirection=p.version>m.version?"backward":"forward")}}return l},new Map)};static createGetter=(t,n,i)=>(o,r)=>{let s=t.get(o);return s||(s=n.get(o),s?(i.containsZindexDifference=!0,(!r.isDeleted||r.isDeleted&&!s.isDeleted)&&(i.containsVisibleDifference=!0)):s=ge({id:o,version:1},{...r})),s};static applyDelta(t,n,i,o){let r={};for(let s of Object.keys(n.inserted)){if(s==="boundElements"||o?.excludedProperties?.has(s))continue;let a=n.inserted[s];Reflect.set(r,s,a)}if(n.deleted.boundElements?.length||n.inserted.boundElements?.length){let s=_.mergeArrays(t.boundElements,n.inserted.boundElements,n.deleted.boundElements,a=>a.id);Object.assign(r,{boundElements:s})}if(!i.containsVisibleDifference){let{index:s,...a}=r,l=e.checkForVisibleDifference(t,a);i.containsVisibleDifference=l}return i.containsZindexDifference||(i.containsZindexDifference=n.deleted.index!==n.inserted.index),ge(t,r,!0)}static checkForVisibleDifference(t,n){return t.isDeleted&&n.isDeleted!==!1?!1:t.isDeleted&&n.isDeleted===!1||t.isDeleted===!1&&n.isDeleted?!0:_.isRightDifferent(t,n)}resolveConflicts(t,n,i="forward"){let o=new Map,r=(a,l)=>{let d=n.get(a.id);if(!d)return;let c=t.get(a.id),u=i==="forward"?d.version+1:d.version-1,m=l,p;c===d?p=ge(d,{...m,version:u},!0):p=ye(d,n,{...m,version:c?.version!==d.version?d.version:u}),o.set(p.id,p),n.set(p.id,p)};for(let a of Object.keys(this.removed))e.unbindAffected(t,n,a,r);for(let a of Object.keys(this.added))e.rebindAffected(t,n,a,r);for(let[a]of Array.from(Object.entries(this.updated)).filter(([l,d])=>Object.keys({...d.deleted,...d.inserted}).find(c=>sl.has(c)))){let l=n.get(a);!l||l.isDeleted||e.rebindAffected(t,n,a,r)}let s=new Map(Array.from(t).filter(([a])=>o.has(a)));return this.squash(e.calculate(s,o)),o}static unbindAffected(t,n,i,o){let r=()=>t.get(i),s=()=>n.get(i);en.unbindAffected(n,r(),o),en.unbindAffected(n,s(),o),tn.unbindAffected(n,r(),o),tn.unbindAffected(n,s(),o)}static rebindAffected(t,n,i,o){let r=()=>t.get(i),s=()=>n.get(i);en.unbindAffected(n,r(),o),en.rebindAffected(n,s(),o),tn.unbindAffected(n,r(),(a,l)=>{J(a)&&o(a,l)}),tn.rebindAffected(n,s(),o)}static redrawElements(t,n){try{let i=new Ro(t,{skipValidation:!0});e.redrawTextBoundingBoxes(i,n),e.redrawBoundArrows(i,n)}catch(i){if(console.error("Couldn't redraw elements",i),mn()||un())throw i}finally{return t}}static redrawTextBoundingBoxes(t,n){let i=t.getNonDeletedElementsMap(),o=new Map;for(let r of n.values()){if(le(r)){let{containerId:s}=r,a=s?i.get(s):void 0;a&&o.set(a.id,{container:a,boundText:r})}if(lt(r)){let s=Tt(r),a=s?i.get(s):void 0;a&&o.set(r.id,{container:r,boundText:a})}}for(let{container:r,boundText:s}of o.values())r.isDeleted||s.isDeleted||Oa(s,r,t)}static redrawBoundArrows(t,n){for(let i of n.values())!i.isDeleted&&He(i)&&Ue(i,t,{changedElements:n})}static reorderElements(t,n,i){if(!i.containsZindexDifference)return t;let o=Array.from(t.values()),r=vd([...o]),s=_.getRightDifferences(o,r,!0).reduce((a,l)=>{let d=o[Number(l)];return d&&n.has(d.id)&&a.set(d.id,d),a},new Map);return!i.containsVisibleDifference&&s.size&&(i.containsVisibleDifference=!0),Ih(Pi(r,s))}static postProcess(t,n){try{_.diffArrays(t,n,"boundElements",r=>r.id);let i=t.points??[],o=n.points??[];_.isDifferent(i,o)||(Reflect.deleteProperty(t,"points"),Reflect.deleteProperty(n,"points"))}catch(i){if(console.error("Couldn't postprocess elements delta."),mn()||un())throw i}finally{return[t,n]}}static stripIrrelevantProps(t){let{id:n,updated:i,...o}=t;return o}};P();var EP=(e,t,n,i)=>{let[o,r,s,a]=n.axis==="x"?["minX","midX","maxX","width"]:["minY","midY","maxY","height"],l=Rt(e),d=Io(e,t,i).map(p=>[p,Rt(p)]).sort((p,f)=>p[1][r]-f[1][r]),c=0;for(let p of d)c+=p[1][a];let u=(l[a]-c)/(d.length-1);if(u<0){let p=d.findIndex(g=>g[1][o]===l[o]),f=d.findIndex(g=>g[1][s]===l[s]),E=(d[f][1][r]-d[p][1][r])/(d.length-1),h=d[p][1][r];return d.flatMap(([g,x],w)=>{let b={x:0,y:0};return w!==p&&w!==f&&(h+=E,b[n.axis]=h-x[r]),g.map(y=>ge(y,{x:y.x+b.x,y:y.y+b.y}))})}let m=l[o];return d.flatMap(([p,f])=>{let E={x:0,y:0};return E[n.axis]=m-f[o],m+=u,m+=f[a],p.map(h=>ge(h,{x:h.x+E.x,y:h.y+E.y}))})};P();import{TEXT_AUTOWRAP_THRESHOLD as Sh,getGridPoint as Mh,getFontString as Ah,DRAGGING_THRESHOLD as Th}from"@excalidraw/common";var AP=(e,t,n,i,o,r)=>{if(t.length===1&&X(t[0])&&(t[0].startBinding||t[0].endBinding))return;let s=t.filter(m=>{if(X(m)&&m.startBinding&&m.endBinding){let p=t.find(E=>E.id===m.startBinding?.elementId),f=t.find(E=>E.id===m.endBinding?.elementId);return p&&f}return!0}),a=new Set(s),l=s.filter(m=>q(m)).map(m=>m.id);if(l.length>0)for(let m of i.getNonDeletedElements())m.frameId!==null&&l.includes(m.frameId)&&a.add(m);let d=[];for(let m of a){let p=e.originalElements.get(m.id);if(!p)return;d.push(p)}let c=vh(Ye(d),n,o,r),u=new Set(Array.from(a,m=>m.id));a.forEach(m=>{let p=!H(m),f=p||(m.startBinding?u.has(m.startBinding.elementId):!1),E=p||(m.endBinding?u.has(m.endBinding.elementId):!1);if(H(m)){if(a.size>1||Math.max(Math.abs(c.x),Math.abs(c.y))>Th||!m.startBinding&&!m.endBinding){Es(e,m,i,c);let h=m.startBinding&&!f,g=m.endBinding&&!E;(h||g)&&(h&&Ze(m,"start",i),g&&Ze(m,"end",i))}}else{Es(e,m,i,c);let h=V(m,i.getNonDeletedElementsMap());h&&Es(e,h,i,c),Ue(m,i,{simultaneouslyUpdated:Array.from(a)})}})},vh=(e,t,n,i)=>{let[o,r]=e,s=o+t.x+n.x,a=r+t.y+n.y;if(n.x===0||n.y===0){let[l,d]=Mh(o+t.x,r+t.y,i);n.x===0&&(s=l),n.y===0&&(a=d)}return{x:s-o,y:a-r}},Es=(e,t,n,i)=>{let o=e.originalElements.get(t.id)??t,r=o.x+i.x,s=o.y+i.y;n.mutateElement(t,{x:r,y:s})},TP=(e,t,n)=>{let[i,o]=Ye(e);return[t-i,n-o]},vP=({newElement:e,elementType:t,originX:n,originY:i,x:o,y:r,width:s,height:a,shouldMaintainAspectRatio:l,shouldResizeFromCenter:d,zoom:c,scene:u,widthAspectRatio:m=null,originOffset:p=null,informMutation:f=!0})=>{l&&e.type!=="selection"&&(m?a=s/m:(Math.abs(r-i)>Math.abs(o-n)?{width:s,height:a}=rs(t,a,o<n?-s:s):{width:s,height:a}=rs(t,s,r<i?-a:a),a<0&&(a=-a)));let E=o<n?n-s:n,h=r<i?i-a:i;d&&(s+=s,a+=a,E=n-s/2,h=i-a/2);let g=null;if(J(e)){a=e.height;let x=qi(Ah({fontSize:e.fontSize,fontFamily:e.fontFamily}),e.lineHeight);s=Math.max(s,x),Math.abs(o-n)>Sh/c&&(g={autoResize:!1}),h=i,d&&(E=n-s/2)}if(s!==0&&a!==0){let x=null;xe(e)&&(x={initialWidth:s,initialHeight:a}),u.mutateElement(e,{x:E+(p?.x??0),y:h+(p?.y??0),width:s,height:a,...g,...x},{informMutation:f,isDragging:!1})}};P();import{ELEMENT_LINK_KEY as Fo,normalizeLink as jd}from"@excalidraw/common";var GP=(e,t)=>{let n=window.location.href;try{let i=new URL(n);return i.searchParams.set(Fo,e),jd(i.toString())}catch(i){console.error(i)}return jd(n)},OP=(e,t)=>{if(e.length>0&&Dh(e)){if(e.length===1)return{id:e[0].id,type:"element"};if(e.length>1){let n=Object.keys(t.selectedGroupIds)[0];return n?{id:n,type:"group"}:{id:e[0].groupIds[0],type:"group"}}}return null},Dh=e=>!!(e.length===1||e.length>1&&Bl(e)),kP=e=>{try{let t=new URL(e);return t.searchParams.has(Fo)&&t.host===window.location.host}catch{return!1}},RP=e=>{try{let{searchParams:t}=new URL(e);if(t.has(Fo))return t.get(Fo)}catch{}return null};P();import{FONT_FAMILY as _h,VERTICAL_ALIGN as Uh,escapeDoubleQuotes as xs,getFontString as Yh}from"@excalidraw/common";P();import{DEFAULT_ELEMENT_PROPS as pn,DEFAULT_FONT_FAMILY as Lh,DEFAULT_FONT_SIZE as Bh,DEFAULT_TEXT_ALIGN as Ch,DEFAULT_VERTICAL_ALIGN as Gh,VERTICAL_ALIGN as Oh,randomInteger as kh,randomId as Rh,getFontString as No,getUpdatedTimestamp as Fh,getLineHeight as Nh}from"@excalidraw/common";var ot=(e,{x:t,y:n,strokeColor:i=pn.strokeColor,backgroundColor:o=pn.backgroundColor,fillStyle:r=pn.fillStyle,strokeWidth:s=pn.strokeWidth,strokeStyle:a=pn.strokeStyle,roughness:l=pn.roughness,opacity:d=pn.opacity,width:c=0,height:u=0,angle:m=0,groupIds:p=[],frameId:f=null,index:E=null,roundness:h=null,boundElements:g=null,link:x=null,locked:w=pn.locked,...b})=>((t<-1e6||t>1e6||n<-1e6||n>1e6||c<-1e6||c>1e6||u<-1e6||u>1e6)&&console.error("New element size or position is too large",{x:t,y:n,width:c,height:u,points:b.points}),{id:b.id||Rh(),type:e,x:t,y:n,width:c,height:u,angle:m,strokeColor:i,backgroundColor:o,fillStyle:r,strokeWidth:s,strokeStyle:a,roughness:l,opacity:d,groupIds:p,frameId:f,index:E,roundness:h,seed:b.seed??kh(),version:b.version||1,versionNonce:b.versionNonce??0,isDeleted:!1,boundElements:g,updated:Fh(),link:x,locked:w,customData:b.customData}),gs=e=>ot(e.type,e),WP=e=>ot("embeddable",e),VP=e=>({...ot("iframe",e)}),$P=e=>ge({...ot("frame",e),type:"frame",name:e?.name||null},{}),ZP=e=>ge({...ot("magicframe",e),type:"magicframe",name:e?.name||null},{}),Wd=(e,t)=>({x:e.textAlign==="center"?t.width/2:e.textAlign==="right"?t.width:0,y:e.verticalAlign==="middle"?t.height/2:0}),Vd=e=>{let t=e.fontFamily||Lh,n=e.fontSize||Bh,i=e.lineHeight||Nh(t),o=Er(e.text),r=et(o,No({fontFamily:t,fontSize:n}),i),s=e.textAlign||Ch,a=e.verticalAlign||Gh,l=Wd({textAlign:s,verticalAlign:a},r),d={...ot("text",e),text:o,fontSize:n,fontFamily:t,textAlign:s,verticalAlign:a,x:e.x-l.x,y:e.y-l.y,width:r.width,height:r.height,containerId:e.containerId||null,originalText:e.originalText??o,autoResize:e.autoResize??!0,lineHeight:i};return ge(d,{})},Hh=(e,t,n)=>{let{width:i,height:o}=et(n,No(e),e.lineHeight);e.autoResize||(i=e.width);let{textAlign:r,verticalAlign:s}=e,a,l;if(r==="center"&&s===Oh.MIDDLE&&!e.containerId&&e.autoResize){let d=et(e.text,No(e),e.lineHeight),c=Wd(e,{width:i-d.width,height:o-d.height});a=e.x-c.x,l=e.y-c.y}else{let[d,c,u,m]=W(e,t),[p,f,E,h]=Xt(e,i,o,!1),g=(d-p)/2,x=(c-f)/2,w=(u-E)/2,b=(m-h)/2;[a,l]=zh({s:!0,e:r==="center"||r==="left",w:r==="center"||r==="right"},e.x,e.y,e.angle,g,x,w,b)}return{width:i,height:o,x:Number.isFinite(a)?a:e.x,y:Number.isFinite(l)?l:e.y}},zh=(e,t,n,i,o,r,s,a)=>{let l=Math.cos(i),d=Math.sin(i);return e.e&&e.w?t+=o+s:e.e?(t+=o*(1+l),n+=o*d,t+=s*(1-l),n+=s*-d):e.w&&(t+=o*(1-l),n+=o*-d,t+=s*(1+l),n+=s*d),e.n&&e.s?n+=r+a:e.n?(t+=r*d,n+=r*(1-l),t+=a*-d,n+=a*(1+l)):e.s&&(t+=r*-d,n+=r*(1+l),t+=a*d,n+=a*(1-l)),[t,n]},qP=(e,t,n,i=e.text)=>{if(e.isDeleted)return;(t||!e.autoResize)&&(i=At(i,No(e),t?tt(t,e):e.width));let o=Hh(e,n,i);return{text:i,...o}},KP=e=>({...ot(e.type,e),points:e.points||[],pressures:e.pressures||[],simulatePressure:e.simulatePressure}),QP=e=>{let t={...ot(e.type,e),points:e.points||[],startBinding:null,endBinding:null,startArrowhead:null,endArrowhead:null};return bt(t)?{...t,polygon:e.polygon??!1}:t},$d=e=>e.elbowed?{...ot(e.type,e),points:e.points||[],startBinding:null,endBinding:null,startArrowhead:e.startArrowhead||null,endArrowhead:e.endArrowhead||null,elbowed:!0,fixedSegments:e.fixedSegments||[],startIsSpecial:!1,endIsSpecial:!1}:{...ot(e.type,e),points:e.points||[],startBinding:null,endBinding:null,startArrowhead:e.startArrowhead||null,endArrowhead:e.endArrowhead||null,elbowed:!1},JP=e=>({...ot("image",e),strokeColor:"transparent",status:e.status??"pending",fileId:e.fileId??null,scale:e.scale??[1,1],crop:e.crop??null});var ft=new Map,Xh=/^(?:http(?:s)?:\/\/)?(?:www\.)?youtu(?:be\.com|\.be)\/(embed\/|watch\?v=|shorts\/|playlist\?list=|embed\/videoseries\?list=)?([a-zA-Z0-9_-]+)/,jh=/^(?:http(?:s)?:\/\/)?(?:(?:w){3}\.)?(?:player\.)?vimeo\.com\/(?:video\/)?([^?\s]+)(?:\?.*)?$/,Wh=/^https:\/\/(?:www\.)?figma\.com/,Zd=/^https:\/\/gist\.github\.com\/([\w_-]+)\/([\w_-]+)/,Vh=/^<script[\s\S]*?\ssrc=["'](https:\/\/gist\.github\.com\/.*?)\.js["']/i,$h=/^(?:https?:\/\/)?forms\.microsoft\.com\//,qd=/(?:https?:\/\/)?(?:(?:w){3}\.)?(?:twitter|x)\.com\/[^/]+\/status\/(\d+)/,Zh=/^<blockquote[\s\S]*?\shref=["'](https?:\/\/(?:twitter|x)\.com\/[^"']*)/i,qh=/^https:\/\/(?:www\.)?val\.town\/(v|embed)\/[a-zA-Z_$][0-9a-zA-Z_$]+\.[a-zA-Z_$][0-9a-zA-Z_$]+/,Kh=/^<(?:iframe|blockquote)[\s\S]*?\s(?:src|href)=["']([^"']*)["'][\s\S]*?>$/i,Kd=/giphy.com\/(?:clips|embed|gifs)\/[a-zA-Z0-9]*?-?([a-zA-Z0-9]+)(?:[^a-zA-Z0-9]|$)/,Qd=/^(?:http(?:s)?:\/\/)?(?:www\.)?reddit\.com\/r\/([a-zA-Z0-9_]+)\/comments\/([a-zA-Z0-9_]+)\/([a-zA-Z0-9_]+)\/?(?:\?[^#\s]*)?(?:#[^\s]*)?$/,Qh=/^<blockquote[\s\S]*?\shref=["'](https?:\/\/(?:www\.)?reddit\.com\/[^"']*)/i,Jh=e=>{let t;try{let s=new URL(e.startsWith("http")?e:`https://${e}`);t=s.searchParams.get("t")||s.searchParams.get("start")}catch{t=e.match(/[?&#](?:t|start)=([^&#\s]+)/)?.[1]}if(!t)return 0;if(/^\d+$/.test(t))return parseInt(t,10);let n=t.match(/^(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?$/);if(!n)return 0;let[,i="0",o="0",r="0"]=n;return parseInt(i)*3600+parseInt(o)*60+parseInt(r)},ys=new Set(["youtube.com","youtu.be","vimeo.com","player.vimeo.com","figma.com","link.excalidraw.com","gist.github.com","twitter.com","x.com","*.simplepdf.eu","stackblitz.com","val.town","giphy.com","reddit.com","forms.microsoft.com"]),Jd=new Set(["youtube.com","youtu.be","vimeo.com","player.vimeo.com","figma.com","twitter.com","x.com","*.simplepdf.eu","stackblitz.com","reddit.com","forms.microsoft.com"]),ws=e=>`<html><body>${e}</body></html>`,sI=e=>{if(!e)return null;if(ft.has(e))return ft.get(e);let t=e,n=Jd.has(bs(e,Jd)||""),i="generic",o={w:560,h:840},r=e.match(Xh);if(r?.[2]){let d=Jh(t),c=d>0?`&start=${d}`:"",u=e.includes("shorts");switch(i="video",r[1]){case"embed/":case"watch?v=":case"shorts/":e=`https://www.youtube.com/embed/${r[2]}?enablejsapi=1${c}`;break;case"playlist?list=":case"embed/videoseries?list=":e=`https://www.youtube.com/embed/videoseries?list=${r[2]}&enablejsapi=1${c}`;break;default:e=`https://www.youtube.com/embed/${r[2]}?enablejsapi=1${c}`;break}return o=u?{w:315,h:560}:{w:560,h:315},ft.set(t,{link:e,intrinsicSize:o,type:i,sandbox:{allowSameOrigin:n}}),{link:e,intrinsicSize:o,type:i,sandbox:{allowSameOrigin:n}}}let s=e.match(jh);if(s?.[1]){let d=s?.[1],c=/^\d+$/.test(d)?void 0:new URIError("Invalid embed link format");return i="video",e=`https://player.vimeo.com/video/${d}?api=1`,o={w:560,h:315},ft.set(t,{link:e,intrinsicSize:o,type:i,sandbox:{allowSameOrigin:n}}),{link:e,intrinsicSize:o,type:i,error:c,sandbox:{allowSameOrigin:n}}}if(e.match(Wh))return i="generic",e=`https://www.figma.com/embed?embed_host=share&url=${encodeURIComponent(e)}`,o={w:550,h:550},ft.set(t,{link:e,intrinsicSize:o,type:i,sandbox:{allowSameOrigin:n}}),{link:e,intrinsicSize:o,type:i,sandbox:{allowSameOrigin:n}};let l=e.match(qh);if(l)return e=l[1]==="embed"?l[0]:l[0].replace("/v","/embed"),ft.set(t,{link:e,intrinsicSize:o,type:i,sandbox:{allowSameOrigin:n}}),{link:e,intrinsicSize:o,type:i,sandbox:{allowSameOrigin:n}};if($h.test(e)&&!e.includes("embed=true")&&(e+=e.includes("?")?"&embed=true":"?embed=true"),qd.test(e)){let d=e.match(qd)[1],c=xs(`https://twitter.com/x/status/${d}`),u={type:"document",srcdoc:m=>ws(`<blockquote class="twitter-tweet" data-dnt="true" data-theme="${m}"><a href="${c}"></a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"><\/script>`),intrinsicSize:{w:480,h:480},sandbox:{allowSameOrigin:n}};return ft.set(t,u),u}if(Qd.test(e)){let[,d,c,u]=e.match(Qd),m=xs(`https://reddit.com/r/${d}/comments/${c}/${u}`),p={type:"document",srcdoc:f=>ws(`<blockquote class="reddit-embed-bq" data-embed-theme="${f}"><a href="${m}"></a><br></blockquote><script async="" src="https://embed.reddit.com/widgets.js" charset="UTF-8"><\/script>`),intrinsicSize:{w:480,h:480},sandbox:{allowSameOrigin:n}};return ft.set(t,p),p}if(Zd.test(e)){let[,d,c]=e.match(Zd),u=xs(`https://gist.github.com/${d}/${c}`),m={type:"document",srcdoc:()=>ws(`
          <script src="${u}.js"><\/script>
          <style type="text/css">
            * { margin: 0px; }
            table, .gist { height: 100%; }
            .gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
          </style>
        `),intrinsicSize:{w:550,h:720},sandbox:{allowSameOrigin:n}};return ft.set(e,m),m}return ft.set(e,{link:e,intrinsicSize:o,type:i,sandbox:{allowSameOrigin:n}}),{link:e,intrinsicSize:o,type:i,sandbox:{allowSameOrigin:n}}},aI=e=>{let t;Xi(e)?t="IFrame element":t=!e.link||e?.link===""?"Empty Web-Embed":e.link;let n=Math.max(Math.min(e.width/2,e.width/t.length),e.width/30),i=_h.Helvetica,o=Yh({fontSize:n,fontFamily:i});return Vd({x:e.x+e.width/2,y:e.y+e.height/2,strokeColor:e.strokeColor!=="transparent"?e.strokeColor:"black",backgroundColor:"transparent",fontFamily:i,fontSize:n,text:At(t,o,e.width-20),textAlign:"center",verticalAlign:Uh.MIDDLE,angle:e.angle??0})},bs=(e,t)=>{try{let{hostname:n}=new URL(e),i=n.replace(/^www\./,"");if(t instanceof Set){if(ys.has(i))return i;let r=i.replace(/^([^.]+)/,"*");return ys.has(r)?r:null}let o=t.replace(/^www\./,"");if(i===o)return o}catch{}return null},lI=e=>{let t=e.match(Zh);if(t&&t.length===2)return t[1];let n=e.match(Qh);if(n&&n.length===2)return n[1];let i=e.match(Vh);if(i&&i.length===2)return i[1];if(Kd.test(e))return`https://giphy.com/embed/${Kd.exec(e)[1]}`;let o=e.match(Kh);return o&&o.length===2?o[1]:e},dI=(e,t)=>{if(!e)return!1;if(t!=null)if(typeof t=="function"){let n=t(e);if(typeof n=="boolean")return n}else{if(typeof t=="boolean")return t;if(t instanceof RegExp)return t.test(e);if(Array.isArray(t)){for(let n of t)if(n instanceof RegExp){if(e.match(n))return!0}else if(bs(e,n))return!0;return!1}}return!!bs(e,ys)};P();import{KEYS as Ho,invariant as zo,toBrandedType as eE}from"@excalidraw/common";import{pointFrom as ec}from"@excalidraw/math";var Yn=100,Sn=100,II=e=>{switch(e){case Ho.ARROW_UP:return"up";case Ho.ARROW_DOWN:return"down";case Ho.ARROW_RIGHT:return"right";case Ho.ARROW_LEFT:return"left";default:return"right"}},ic=(e,t,n,i)=>{let o=[...n.values()].reduce((r,s)=>{let a;if(X(s)&&(a=s[e==="predecessors"?"startBinding":"endBinding"])&&s[e==="predecessors"?"endBinding":"startBinding"]?.elementId===t.id){let l=n.get(a.elementId);if(!l)return r;zo(He(l),"not an ExcalidrawBindableElement");let d=e==="predecessors"?s.points[s.points.length-1]:[0,0],c=ai(t,$e(t,n),[d[0]+s.x,d[1]+s.y]);r.push({relative:l,heading:c})}return r},[]);switch(i){case"up":return o.filter(r=>ue(r.heading,_e)).map(r=>r.relative);case"down":return o.filter(r=>ue(r.heading,we)).map(r=>r.relative);case"right":return o.filter(r=>ue(r.heading,me)).map(r=>r.relative);case"left":return o.filter(r=>ue(r.heading,Ge)).map(r=>r.relative)}},Ps=(e,t,n)=>ic("successors",e,t,n),Is=(e,t,n)=>ic("predecessors",e,t,n),tE=(e,t,n)=>{let i=Sn+e.width;if(n==="up"||n==="down"){let a=Yn+e.height,l=e.x,d=e.x+e.width;if(t.every(c=>c.x+c.width<l||c.x>d))return{x:0,y:a*(n==="up"?-1:1)}}else if(n==="right"||n==="left"){let a=e.y,l=e.y+e.height;if(t.every(d=>d.y+d.height<a||d.y>l))return{x:(Sn+e.width)*(n==="left"?-1:1),y:0}}if(n==="up"||n==="down"){let a=Yn+e.height,l=(t.length===0,a),d=t.length===0?0:(t.length+1)%2===0?(t.length+1)/2*i:t.length/2*i*-1;return n==="up"?{x:d,y:l*-1}:{x:d,y:l}}let o=Yn+e.height,r=(t.length===0,Sn+e.width),s=t.length===0?0:(t.length+1)%2===0?(t.length+1)/2*o:t.length/2*o*-1;return n==="left"?{x:r*-1,y:s}:{x:r,y:s}},nE=(e,t,n,i)=>{let o=i.getNonDeletedElementsMap(),r=Ps(e,o,n),s=Is(e,o,n),a=tE(e,[...r,...s],n),l=gs({type:e.type,x:e.x+a.x,y:e.y+a.y,width:e.width,height:e.height,roundness:e.roundness,roughness:e.roughness,backgroundColor:e.backgroundColor,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,opacity:e.opacity,fillStyle:e.fillStyle,strokeStyle:e.strokeStyle});zo(lr(l),"not an ExcalidrawFlowchartNodeElement");let d=oc(e,l,n,t,i);return{nextNode:l,bindingArrow:d}},iE=(e,t,n,i,o)=>{let r=[];for(let s=0;s<o;s++){let a,l;if(n==="left"||n==="right"){let u=Yn*(o-1)+o*e.height,m=e.y+e.height/2-u/2,p=Sn+e.width;n==="left"&&(p*=-1),a=e.x+p;let f=(Yn+e.height)*s;l=m+f}else{let u=Sn*(o-1)+o*e.width,m=e.x+e.width/2-u/2,p=Yn+e.height;n==="up"&&(p*=-1),l=e.y+p;let f=(Sn+e.width)*s;a=m+f}let d=gs({type:e.type,x:a,y:l,width:e.width,height:e.height,roundness:e.roundness,roughness:e.roughness,backgroundColor:e.backgroundColor,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,opacity:e.opacity,fillStyle:e.fillStyle,strokeStyle:e.strokeStyle});zo(lr(d),"not an ExcalidrawFlowchartNodeElement");let c=oc(e,d,n,t,i);r.push(d),r.push(c)}return r},oc=(e,t,n,i,o)=>{let r,s;switch(n){case"up":{r=e.x+e.width/2,s=e.y-6;break}case"down":{r=e.x+e.width/2,s=e.y+e.height+6;break}case"right":{r=e.x+e.width+6,s=e.y+e.height/2;break}case"left":{r=e.x-6,s=e.y+e.height/2;break}}let l,d;switch(n){case"up":{l=t.x+t.width/2-r,d=t.y+t.height-s+6;break}case"down":{l=t.x+t.width/2-r,d=t.y-s-6;break}case"right":{l=t.x-r-6,d=t.y-s+t.height/2;break}case"left":{l=t.x+t.width-r+6,d=t.y-s+t.height/2;break}}let c=$d({type:"arrow",x:r,y:s,startArrowhead:null,endArrowhead:i.currentItemEndArrowhead,strokeColor:e.strokeColor,strokeStyle:e.strokeStyle,strokeWidth:e.strokeWidth,opacity:e.opacity,roughness:e.roughness,points:[ec(0,0),ec(l,d)],elbowed:!0}),u=o.getNonDeletedElementsMap();go(c,e,"orbit","start",o),go(c,t,"orbit","end",o);let m=new Map;m.set(e.id,e),m.set(t.id,t),m.set(c.id,c),R.movePoints(c,o,new Map([[1,{point:c.points[1]}]]));let p=Gn(c,eE(new Map([...u.entries(),[e.id,e],[t.id,t],[c.id,c]])),{points:c.points});return{...c,...p}},tc=class{isExploring=!1;sameLevelNodes=[];sameLevelIndex=0;direction=null;visitedNodes=new Set;clear(){this.isExploring=!1,this.sameLevelNodes=[],this.sameLevelIndex=0,this.direction=null,this.visitedNodes.clear()}exploreByDirection(t,n,i){if(!He(t))return null;if(i!==this.direction&&this.clear(),this.visitedNodes.has(t.id)||this.visitedNodes.add(t.id),this.isExploring&&i===this.direction&&this.sameLevelNodes.length>1)return this.sameLevelIndex=(this.sameLevelIndex+1)%this.sameLevelNodes.length,this.sameLevelNodes[this.sameLevelIndex].id;let o=[...Ps(t,n,i),...Is(t,n,i)];if(o.length>0)return this.sameLevelIndex=0,this.isExploring=!0,this.sameLevelNodes=o,this.direction=i,this.visitedNodes.add(o[0].id),o[0].id;if(i===this.direction||!this.isExploring){this.isExploring||this.visitedNodes.add(t.id);let s=["up","right","down","left"].filter(a=>a!==i).map(a=>[...Ps(t,n,a),...Is(t,n,a)]).flat().filter(a=>!this.visitedNodes.has(a.id));for(let a of s)if(!this.visitedNodes.has(a.id))return this.visitedNodes.add(a.id),this.isExploring=!0,this.direction=i,a.id}return null}},nc=class{isCreatingChart=!1;numberOfNodes=0;direction="right";pendingNodes=null;createNodes(t,n,i,o){let r=o.getNonDeletedElementsMap();if(i!==this.direction){let{nextNode:s,bindingArrow:a}=nE(t,n,i,o);this.numberOfNodes=1,this.isCreatingChart=!0,this.direction=i,this.pendingNodes=[s,a]}else{this.numberOfNodes+=1;let s=iE(t,n,i,o,this.numberOfNodes);this.isCreatingChart=!0,this.direction=i,this.pendingNodes=s}if(t.frameId){let s=r.get(t.frameId);zo(s&&Wi(s),"not an ExcalidrawFrameElement"),s&&this.pendingNodes.every(a=>sn([a],s,r)||on(a,s,r))&&(this.pendingNodes=this.pendingNodes.map(a=>ye(a,r,{frameId:t.frameId})))}}clear(){this.isCreatingChart=!1,this.pendingNodes=null,this.direction=null,this.numberOfNodes=0}},SI=(e,t)=>{for(let[,n]of t)if(n.type==="arrow"&&(n.startBinding?.elementId===e.id||n.endBinding?.elementId===e.id))return!0;return!1};P();import{MIME_TYPES as rc,SVG_NS as oE}from"@excalidraw/common";var rE=e=>new Promise((t,n)=>{let i=new Image;i.onload=()=>{t(i)},i.onerror=o=>{n(o)},i.src=e}),DI=async({fileIds:e,files:t,imageCache:n})=>{let i=new Map,o=new Map;return await Promise.all(e.reduce((r,s)=>{let a=t[s];return a&&!i.has(s)?(i.set(s,!0),r.concat((async()=>{try{if(a.mimeType===rc.binary)throw new Error("Only images can be added to ImageCache");let l=rE(a.dataURL),d={image:l,mimeType:a.mimeType};n.set(s,d);let c=await l;n.set(s,{...d,image:c})}catch{o.set(s,!0)}})())):r},[])),{imageCache:n,updatedFiles:i,erroredFiles:o}},LI=e=>e.filter(t=>jt(t)),sE=e=>e?.nodeName.toLowerCase()==="svg",BI=e=>{let t=new DOMParser().parseFromString(e,rc.svg),n=t.querySelector("svg");if(t.querySelector("parsererror")||!sE(n))throw new Error("Invalid SVG");{n.hasAttribute("xmlns")||n.setAttribute("xmlns",oE);let o=n.getAttribute("width"),r=n.getAttribute("height");(o?.includes("%")||o==="auto")&&(o=null),(r?.includes("%")||r==="auto")&&(r=null);let s=n.getAttribute("viewBox");if(!o||!r){if(o=o||"50",r=r||"50",s){let a=s.match(/\d+ +\d+ +(\d+(?:\.\d+)?) +(\d+(?:\.\d+)?)/);a&&([,o,r]=a)}n.setAttribute("width",o),n.setAttribute("height",r)}return s||n.setAttribute("viewBox",`0 0 ${o} ${r}`),n.outerHTML}};P();var RI=(e,t,n,i=50)=>{if(!e||e.length===0)return[];let o=[],r=Array.isArray(e[0])?e:e.map(p=>[p]),s=r.length,a=Math.max(1,Math.ceil(Math.sqrt(s))),l=[];for(let p=0;p<s;p+=a)l.push(r.slice(p,p+a));let d=0,c=l.map(p=>{let f=0,E=0,h=p.map(g=>{let[x,w,b,y]=Ye(g);return{elements:g,bounds:[x,w,b,y],width:b-x,height:y-w}});return h.forEach((g,x)=>{f+=g.width,x<h.length-1&&(f+=i),g.height>E&&(E=g.height)}),d+=E,{unitBounds:h,width:f,maxHeight:E}}),u=d+Math.max(0,l.length-1)*i,m=n-u/2;return c.forEach(p=>{let{unitBounds:f,width:E,maxHeight:h}=p,g=t-E/2;f.forEach(x=>{let[w,b]=x.bounds,y=g-w,I=m-b;x.elements.forEach(S=>{o.push(ge(S,{x:S.x+y,y:S.y+I}))}),g+=x.width+i}),m+=h+i}),o};P();import{pointCenter as aE,normalizeRadians as Uo,pointFrom as ie,pointRotateRads as rt}from"@excalidraw/math";import{MIN_FONT_SIZE as Ms,SHIFT_LOCKING_ANGLE as Yo,rescalePoints as sc,getFontString as _o}from"@excalidraw/common";var ZI=(e,t,n,i,o,r,s,a,l,d,c)=>{let u=i.getNonDeletedElementsMap();if(n.length===1){let[m]=n;if(t==="rotation")X(m)||(lE(m,i,a,l,o),Ue(m,i));else if(t){let p=n[0].id,f=u.get(p),E=e.get(p);if(f&&E){let{nextWidth:h,nextHeight:g}=pE(f,E,t,a,l,{shouldMaintainAspectRatio:s,shouldResizeFromCenter:r});mE(h,g,f,E,e,i,t,{shouldMaintainAspectRatio:s,shouldResizeFromCenter:r})}}return J(m)&&Ue(m,i),!0}else if(n.length>1){if(t==="rotation")return cE(e,n,i,a,l,o,d,c),!0;if(t){let{nextWidth:m,nextHeight:p,flipByX:f,flipByY:E,originalBoundingBox:h}=fE(n,e,u,t,a,l,{shouldMaintainAspectRatio:s,shouldResizeFromCenter:r});return hE(n,u,t,i,e,{shouldResizeFromCenter:r,shouldMaintainAspectRatio:s,flipByX:f,flipByY:E,nextWidth:m,nextHeight:p,originalBoundingBox:h}),!0}}return!1},lE=(e,t,n,i,o)=>{let[r,s,a,l]=W(e,t.getNonDeletedElementsMap()),d=(r+a)/2,c=(s+l)/2,u;q(e)?u=0:(u=5*Math.PI/2+Math.atan2(i-c,n-d),o&&(u=u+Yo/2,u=u-u%Yo),u=Uo(u));let m=Tt(e),p={angle:u};if(Le(e)&&(p={...p},e.startBinding&&Ze(e,"start",t),e.endBinding&&Ze(e,"end",t)),t.mutateElement(e,p),m){let f=t.getElement(m);if(f&&!H(e)){let{x:E,y:h}=oi(e,f,t.getNonDeletedElementsMap());t.mutateElement(f,{angle:u,x:E,y:h})}}},ac=(e,t,n,i)=>K(e)||Ie(e)?{points:sc(0,t,sc(1,n,e.points,i),i)}:{},As=(e,t,n)=>{let i=e.width;if(le(e)){let s=Se(e,t);s&&(i=tt(s,e))}let r=e.fontSize*(n/i);return r<Ms?null:{size:r}},dE=(e,t,n,i,o,r,s)=>{let a=n.getNonDeletedElementsMap(),l=t.width*(s/t.height),d=As(t,a,l);if(d!==null){if(i.includes("n")||i.includes("s")){let c=ie(e.x,e.y),u=Ss(c,e.width,e.height,l,s,e.angle,i,!1,o);n.mutateElement(t,{fontSize:d.size,width:l,height:s,x:u.x,y:u.y});return}if(i==="e"||i==="w"){let c=qi(_o({fontSize:t.fontSize,fontFamily:t.fontFamily}),t.lineHeight),u=Math.max(c,r),m=At(t.originalText,_o(t),Math.abs(u)),p=et(m,_o(t),t.lineHeight),f=p.height,E=ie(e.x,e.y),h=Ss(E,e.width,e.height,u,f,t.angle,i,!1,o),g={width:Math.abs(u),height:Math.abs(p.height),x:h.x,y:h.y,text:m,autoResize:!1};n.mutateElement(t,g)}}},cE=(e,t,n,i,o,r,s,a)=>{let l=n.getNonDeletedElementsMap(),d=5*Math.PI/2+Math.atan2(o-a,i-s);r&&(d+=Yo/2,d-=d%Yo);let c=new Map(t.map(u=>[u.id,u]));for(let u of t)if(!q(u)){let[m,p,f,E]=W(u,l),h=(m+f)/2,g=(p+E)/2,x=e.get(u.id)?.angle??u.angle,[w,b]=rt(ie(h,g),ie(s,a),d+x-u.angle),y=X(u)?{points:al(u,l)}:{x:u.x+(w-h),y:u.y+(b-g),angle:Uo(d+x)};n.mutateElement(u,y),Ue(u,n,{simultaneouslyUpdated:t}),Le(u)&&(u.startBinding&&(c.has(u.startBinding.elementId)||Ze(u,"start",n)),u.endBinding&&(c.has(u.endBinding.elementId)||Ze(u,"end",n)));let I=V(u,l);if(I&&!H(u)){let{x:S,y:A}=oi(u,I,l);n.mutateElement(I,{x:S,y:A,angle:Uo(d+x)})}}n.triggerUpdate()},qI=(e,t,n,i,o)=>{let[r,s,a,l]=t.length===1?W(t[0],n):Ye(t),d=(r+a)/2,c=(s+l)/2,u=t.length===1?t[0].angle:0;switch([i,o]=rt(ie(i,o),ie(d,c),-u),e){case"n":return rt(ie(i-(r+a)/2,o-s),ie(0,0),u);case"s":return rt(ie(i-(r+a)/2,o-l),ie(0,0),u);case"w":return rt(ie(i-r,o-(s+l)/2),ie(0,0),u);case"e":return rt(ie(i-a,o-(s+l)/2),ie(0,0),u);case"nw":return rt(ie(i-r,o-s),ie(0,0),u);case"ne":return rt(ie(i-a,o-s),ie(0,0),u);case"sw":return rt(ie(i-r,o-l),ie(0,0),u);case"se":return rt(ie(i-a,o-l),ie(0,0),u);default:return[0,0]}},KI=(e,t)=>{let[,[n,i]]=t.points;return e==="nw"&&(n<0||i<0)||e==="ne"&&n>=0||e==="sw"&&n<=0||e==="se"&&(n>0||i>0)?"end":"origin"},uE=(e,t,n)=>{if(n)return"center";if(t)switch(e){case"n":return"south-side";case"e":return"west-side";case"s":return"north-side";case"w":return"east-side";case"ne":return"bottom-left";case"nw":return"bottom-right";case"se":return"top-left";case"sw":return"top-right"}return["e","se","s"].includes(e)?"top-left":["n","nw","w"].includes(e)?"bottom-right":e==="ne"?"bottom-left":"top-right"},Ss=(e,t,n,i,o,r,s,a,l)=>{let d=uE(s,a,l),[c,u]=e;switch(d){case"top-left":return{x:c+(t-i)/2+(i-t)/2*Math.cos(r)+(n-o)/2*Math.sin(r),y:u+(n-o)/2+(i-t)/2*Math.sin(r)+(o-n)/2*Math.cos(r)};case"top-right":return{x:c+(t-i)/2*(Math.cos(r)+1)+(n-o)/2*Math.sin(r),y:u+(n-o)/2+(t-i)/2*Math.sin(r)+(o-n)/2*Math.cos(r)};case"bottom-left":return{x:c+(t-i)/2*(1-Math.cos(r))+(o-n)/2*Math.sin(r),y:u+(n-o)/2*(Math.cos(r)+1)+(i-t)/2*Math.sin(r)};case"bottom-right":return{x:c+(t-i)/2*(Math.cos(r)+1)+(o-n)/2*Math.sin(r),y:u+(n-o)/2*(Math.cos(r)+1)+(t-i)/2*Math.sin(r)};case"center":return{x:c-(i-t)/2,y:u-(o-n)/2};case"east-side":return{x:c+(t-i)/2*(Math.cos(r)+1),y:u+(t-i)/2*Math.sin(r)+(n-o)/2};case"west-side":return{x:c+(t-i)/2*(1-Math.cos(r)),y:u+(i-t)/2*Math.sin(r)+(n-o)/2};case"north-side":return{x:c+(t-i)/2+(n-o)/2*Math.sin(r),y:u+(o-n)/2*(Math.cos(r)-1)};case"south-side":return{x:c+(t-i)/2+(o-n)/2*Math.sin(r),y:u+(n-o)/2*(Math.cos(r)+1)}}},mE=(e,t,n,i,o,r,s,{shouldInformMutation:a=!0,shouldMaintainAspectRatio:l=!1,shouldResizeFromCenter:d=!1}={})=>{if(J(n)&&J(i))return dE(i,n,r,s,d,e,t);let c={},u=r.getNonDeletedElementsMap(),m=V(n,u);if(m){let h=o.get(m.id);if(h&&(c={fontSize:h.fontSize}),l){let g={...n,width:e,height:t},x=As(m,u,tt(g,m));if(x===null)return;c={fontSize:x.size}}else{let g=va(_o(m),m.lineHeight),x=Da(m.fontSize,m.lineHeight);e=Math.max(e,g),t=Math.max(t,x)}}let p=ac(i,e,t,!0),f=ie(i.x,i.y);if(K(i)){let[h,g]=se(i,o);f=ie(h,g)}let E=Ss(f,i.width,i.height,e,t,i.angle,s,l,d);if(K(i)&&p.points){let h=i.x-f[0],g=i.y-f[1];E.x+=h,E.y+=g;let x=p.points[0][0],w=p.points[0][1];E.x+=x,E.y+=w,p.points=p.points.map(b=>ie(b[0]-x,b[1]-w))}if(e<0&&(E.x=E.x+e),t<0&&(E.y=E.y+t),"scale"in n&&"scale"in i&&r.mutateElement(n,{scale:[(Math.sign(e)||i.scale[0])*i.scale[0],(Math.sign(t)||i.scale[1])*i.scale[1]]}),H(n)&&m&&l){let h=e/n.width*m.fontSize;if(h<Ms)return;c.fontSize=h}if(e!==0&&t!==0&&Number.isFinite(E.x)&&Number.isFinite(E.y)){let h={...E,width:Math.abs(e),height:Math.abs(t),...p};Le(n)&&(n.startBinding&&(h={...h},n.startBinding&&Ze(n,"start",r)),n.endBinding&&(h={...h,endBinding:null})),r.mutateElement(n,h,{informMutation:a,isDragging:!1}),m&&c!=null&&r.mutateElement(m,{fontSize:c.fontSize}),wn(n,r,s,l),Ue(n,r)}},pE=(e,t,n,i,o,{shouldMaintainAspectRatio:r=!1,shouldResizeFromCenter:s=!1}={})=>{let[a,l,d,c]=Xt(t,t.width,t.height,!0),u=ie(a,l),m=ie(d,c),p=aE(u,m),f=rt(ie(i,o),p,-t.angle),[E,h,g,x]=Xt(e,e.width,e.height,!0),w=g-E,b=x-h,y=m[0]-u[0],I=m[1]-u[1],S=y/w,A=I/b;n.includes("e")&&(S=(f[0]-u[0])/w),n.includes("s")&&(A=(f[1]-u[1])/b),n.includes("w")&&(S=(m[0]-f[0])/w),n.includes("n")&&(A=(m[1]-f[1])/b);let M=e.width*S,O=e.height*A;if(s&&(M=2*M-t.width,O=2*O-t.height),r){let L=Math.abs(M)/t.width,G=Math.abs(O)/t.height;if(n.length===1&&(O*=L,M*=G),n.length===2){let B=Math.max(L,G);M=t.width*B*Math.sign(M),O=t.height*B*Math.sign(O)}}return{nextWidth:M,nextHeight:O}},fE=(e,t,n,i,o,r,{shouldMaintainAspectRatio:s=!1,shouldResizeFromCenter:a=!1}={})=>{let l=e.map(B=>t.get(B.id)),d=l.reduce((B,U)=>{if(!K(U))return B;let N=Tt(U);if(!N)return B;let Y=t.get(N)??null;return le(Y)?[...B,{...Y,...R.getBoundTextElementPosition(U,Y,n)}]:B},[]),c=Rt(l.map(B=>B).concat(d)),{minX:u,minY:m,maxX:p,maxY:f,midX:E,midY:h}=c,g=p-u,x=f-m,w={ne:[u,f],se:[u,m],sw:[p,m],nw:[p,f],e:[u,m+x/2],w:[p,m+x/2],n:[u+g/2,f],s:[u+g/2,m]},[b,y]=a?[E,h]:w[i],I=a?2:1,S=Math.max(Math.abs(o-b)/g||0,Math.abs(r-y)/x||0)*I,A=i.includes("e")||i.includes("w")?Math.abs(o-b)*I:g,M=i.includes("n")||i.includes("s")?Math.abs(r-y)*I:x;s&&(A=g*S*Math.sign(o-b),M=x*S*Math.sign(r-y));let O={ne:[o<b,r>y],se:[o<b,r<y],sw:[o>b,r<y],nw:[o>b,r>y],e:[o<b,!1],w:[o>b,!1],n:[!1,r>y],s:[!1,r<y]},[L,G]=O[i].map(B=>B);return{originalBoundingBox:c,nextWidth:A,nextHeight:M,flipByX:L,flipByY:G}},hE=(e,t,n,i,o,{shouldMaintainAspectRatio:r=!1,shouldResizeFromCenter:s=!1,flipByX:a=!1,flipByY:l=!1,nextHeight:d,nextWidth:c,originalBoundingBox:u}={})=>{if(c===void 0&&d===void 0&&a===void 0&&l===void 0||d===0||c===0)return;o||(o=t);let m=e.reduce((I,S)=>{let A=o.get(S.id);return A&&I.push({orig:A,latest:S}),I},[]),p;if(u)p=u;else{let I=m.reduce((S,{orig:A})=>{if(!K(A))return S;let M=Tt(A);if(!M)return S;let O=o.get(M)??null;return le(O)?[...S,{...O,...R.getBoundTextElementPosition(A,O,t)}]:S},[]);p=Rt(m.map(({orig:S})=>S).concat(I))}let{minX:f,minY:E,maxX:h,maxY:g,midX:x,midY:w}=p,b=h-f,y=g-E;if(c===void 0&&d===void 0&&(c=b,d=y),r&&(c===void 0?c=d*(b/y):d===void 0?d=c*(y/b):Math.abs(c/d-b/y)>.001&&(c=d*(b/y))),c&&d){let I=n.includes("e")||n.includes("w")?Math.abs(c)/b:1,S=n.includes("n")||n.includes("s")?Math.abs(d)/y:1,A;n.length===1?A=n.includes("e")||n.includes("w")?I:S:A=Math.max(Math.abs(c)/b||0,Math.abs(d)/y||0);let M={ne:[f,g],se:[f,E],sw:[h,E],nw:[h,g],e:[f,E+y/2],w:[h,E+y/2],n:[f+b/2,g],s:[f+b/2,E]},[O,L]=s?[x,w]:M[n],G=r||m.some(T=>T.latest.angle!==0||J(T.latest)||Cl(T.latest));G&&(I=A,S=A);let[B,U]=[a?-1:1,l?-1:1],N=[];for(let{orig:T,latest:$}of m){if(J(T)&&le(T))continue;let Z=T.width*I,ht=T.height*S,st=Uo(T.angle*B*U),Ii=K(T)||Ie(T),Wo=T.x-O,Si=T.y-L,Xn=a&&!Ii?Z:0,Vo=l&&!Ii?ht:0,Mi=O+B*(Wo*I+Xn),Ai=L+U*(Si*S+Vo),Fe=ac(T,Z*B,ht*U,!1),Xe={x:Mi,y:Ai,width:Z,height:ht,angle:st,...Fe};if(X(T)&&(T.startBinding&&(Xe.startBinding={...T.startBinding,fixedPoint:[a?-T.startBinding.fixedPoint[0]+1:T.startBinding.fixedPoint[0],l?-T.startBinding.fixedPoint[1]+1:T.startBinding.fixedPoint[1]]}),T.endBinding&&(Xe.endBinding={...T.endBinding,fixedPoint:[a?-T.endBinding.fixedPoint[0]+1:T.endBinding.fixedPoint[0],l?-T.endBinding.fixedPoint[1]+1:T.endBinding.fixedPoint[1]]}),T.fixedSegments&&Fe.points&&(Xe.fixedSegments=T.fixedSegments.map(Et=>({...Et,start:Fe.points[Et.index-1],end:Fe.points[Et.index]})))),xe(T)&&(Xe.scale=[T.scale[0]*B,T.scale[1]*U]),J(T)){let Et=As(T,t,Z);if(!Et)return;Xe.fontSize=Et.size}let zt=o.get(Tt(T)??"");if(zt)if(G){let Et=zt.fontSize*A;if(Et<Ms)return;Xe.boundTextFontSize=Et}else Xe.boundTextFontSize=zt.fontSize;N.push({element:$,update:Xe})}let Y=N.map(({element:T})=>T),F=new Map(N.map(({element:T})=>[T.id,T]));for(let{element:T,update:{boundTextFontSize:$,...Z}}of N){let{angle:ht}=Z;i.mutateElement(T,Z),Ue(T,i,{simultaneouslyUpdated:Y}),Le(T)&&(T.startBinding&&(F.has(T.startBinding.elementId)||Ze(T,"start",i)),T.endBinding&&(F.has(T.endBinding.elementId)||Ze(T,"end",i)));let st=V(T,t);st&&$&&(i.mutateElement(st,{fontSize:$,angle:K(T)?void 0:ht}),wn(T,i,n,!0))}i.triggerUpdate()}};P();import{pointFrom as qe,pointOnLineSegment as pc,pointRotateRads as jo}from"@excalidraw/math";import{SIDE_RESIZING_THRESHOLD as Cs}from"@excalidraw/common";P();import{DEFAULT_TRANSFORM_HANDLE_SPACING as vs}from"@excalidraw/common";import{pointFrom as lc,pointRotateRads as EE}from"@excalidraw/math";var dc={mouse:8,pen:16,touch:28},gE=16,uc={e:!0,s:!0,n:!0,w:!0},oS={e:!0,s:!0,n:!0,w:!0},rS={e:!0,s:!0,n:!0,w:!0,rotation:!0},cc={e:!0,s:!0,n:!0,w:!0,nw:!0,se:!0},Ts={e:!0,s:!0,n:!0,w:!0},Ht=(e,t,n,i,o,r,s)=>{let[a,l]=EE(lc(e+n/2,t+i/2),lc(o,r),s);return[a-n/2,l-i/2,n,i]},Xo=e=>!(e.formFactor==="phone"&&e.userAgent.isMobileDevice),Ds=e=>Xo(e)?uc:{},Ls=([e,t,n,i,o,r],s,a,l,d={},c=4,u=vs)=>{let m=dc[l],p=m/a.value,f=m/a.value,E=m/a.value,h=m/a.value,g=n-e,x=i-t,w=c/a.value,b=(m-u*2)/(2*a.value),y={nw:d.nw?void 0:Ht(e-w-E+b,t-w-h+b,p,f,o,r,s),ne:d.ne?void 0:Ht(n+w-b,t-w-h+b,p,f,o,r,s),sw:d.sw?void 0:Ht(e-w-E+b,i+w-b,p,f,o,r,s),se:d.se?void 0:Ht(n+w-b,i+w-b,p,f,o,r,s),rotation:d.rotation?void 0:Ht(e+g/2-p/2,t-w-h+b-gE/a.value,p,f,o,r,s)},I=5*dc.mouse/a.value;return Math.abs(g)>I&&(d.n||(y.n=Ht(e+g/2-p/2,t-w-h+b,p,f,o,r,s)),d.s||(y.s=Ht(e+g/2-p/2,i+w-b,p,f,o,r,s))),Math.abs(x)>I&&(d.w||(y.w=Ht(e-w-E+b,t+x/2-f/2,p,f,o,r,s)),d.e||(y.e=Ht(n+w-b,t+x/2-f/2,p,f,o,r,s))),y},mc=(e,t,n,i="mouse",o=uc)=>{if(e.locked||X(e))return{};if(e.type==="freedraw"||K(e)){if(e.points.length===2){let[,s]=e.points;s[0]===0||s[1]===0?o=Ts:s[0]>0&&s[1]<0?o=cc:s[0]>0&&s[1]>0?o=Ts:s[0]<0&&s[1]>0?o=cc:s[0]<0&&s[1]<0&&(o=Ts)}}else q(e)&&(o={...o,rotation:!0});let r=K(e)?vs+8:xe(e)?0:vs;return Ls(W(e,n,!0),e.angle,t,i,o,r,xe(e)?0:void 0)},sS=(e,t,n)=>{if(t.selectedLinearElement?.isEditing||t.selectedLinearElement?.isDragging)return!1;if(e.length>1)return!0;let i=e[0];return X(i)?!1:K(i)?i.points.length>2&&!n.userAgent.isMobileDevice:!0};var Gs=(e,t,n)=>t>=e[0]&&t<=e[0]+e[2]&&n>=e[1]&&n<=e[1]+e[3],xE=(e,t,n,i,o,r,s,a)=>{if(!n.selectedElementIds[e.id])return!1;let{rotation:l,...d}=mc(e,r,t,s,Ds(a));if(l&&Gs(l,i,o))return"rotation";let c=Object.keys(d).filter(u=>{let m=d[u];return m?Gs(m,i,o):!1});if(c.length>0)return c[0];if(Xo(a)){let[u,m,p,f,E,h]=W(e,t);if(!(K(e)&&e.points.length<=2)){let g=xe(e)?0:Cs/r.value,x=Cs/r.value,w=fc(qe(u-g,m-g),qe(p+g,f+g),qe(E,h),e.angle);for(let[b,y]of Object.entries(w))if(pc(qe(i,o),y,x))return b}}return!1},fS=(e,t,n,i,o,r,s,a)=>e.reduce((l,d)=>{if(l)return l;let c=xE(d,s,t,n,i,o,r,a);return c?{element:d,transformHandleType:c}:null},null),hS=([e,t,n,i],o,r,s,a,l)=>{let d=Ls([e,t,n,i,(e+n)/2,(t+i)/2],0,s,a,Ds(l)),c=Object.keys(d).find(u=>{let m=d[u];return m&&Gs(m,o,r)});if(c)return c;if(Xo(l)){let u=(e+n)/2,m=(t+i)/2,p=Cs/s.value,f=fc(qe(e-p,t-p),qe(n+p,i+p),qe(u,m),0);for(let[E,h]of Object.entries(f))if(pc(qe(o,r),h,p))return E}return!1},Bs=["ns","nesw","ew","nwse"],wE=(e,t)=>{let n=Bs.indexOf(e);if(n>=0){let i=Math.round(t/(Math.PI/4));e=Bs[(n+i)%Bs.length]}return e},ES=e=>{let{element:t,transformHandleType:n}=e,i=t&&Math.sign(t.height)*Math.sign(t.width)===-1,o=null;switch(n){case"n":case"s":o="ns";break;case"w":case"e":o="ew";break;case"nw":case"se":i?o="nesw":o="nwse";break;case"ne":case"sw":i?o="nwse":o="nesw";break;case"rotation":return"grab"}return o&&t&&(o=wE(o,t.angle)),o?`${o}-resize`:""},fc=([e,t],[n,i],o,r)=>{let s=jo(qe(e,t),o,r),a=jo(qe(n,t),o,r),l=jo(qe(e,i),o,r),d=jo(qe(n,i),o,r);return{n:[s,a],e:[a,d],s:[d,l],w:[l,s]}};P();var yS=(e,t)=>!!(!e.viewModeEnabled&&e.openDialog?.name!=="elementLinkSelector"&&(e.activeTool.type!=="custom"&&(e.editingTextElement||e.activeTool.type!=="selection"&&e.activeTool.type!=="lasso"&&e.activeTool.type!=="eraser"&&e.activeTool.type!=="hand"&&e.activeTool.type!=="laser")||mt(t,e).length));P();import{arrayToMap as Ec,findIndex as gc,findLastIndex as xc}from"@excalidraw/common";var Os=(e,t)=>e.frameId===t||e.id===t,wc=(e,t,n)=>{let i=[],o=[],r=null,s=-1,a=Ec(n||mt(e,t,{includeBoundTextElement:!0,includeElementsInFrames:!0}));for(;++s<e.length;){let l=e[s];a.get(l.id)?(o.length&&(i=i.concat(o),o=[]),i.push(s),r=s+1):l.isDeleted&&r===s?(r=s+1,o.push(s)):o=[]}return i},yE=e=>{let t=0;return e.reduce((n,i,o)=>(o>0&&e[o-1]!==i-1&&(t=++t),(n[t]||(n[t]=[])).push(i),n),[])},hc=(e,t,n,i)=>{if("containerId"in e&&e.containerId){let o=i.getElement(e.containerId);if(o)return n==="left"?Math.min(t.indexOf(o),t.indexOf(e)):Math.max(t.indexOf(o),t.indexOf(e))}else{let o=e.boundElements?.find(r=>r.type!=="arrow")?.id;if(o){let r=i.getElement(o);if(r)return n==="left"?Math.min(t.indexOf(r),t.indexOf(e)):Math.max(t.indexOf(r),t.indexOf(e))}}},bE=(e,t)=>{let n=-1,i=-1;return e.forEach((o,r)=>{Os(o,t)&&(n===-1&&(n=r),i=r)}),n===-1?[]:e.slice(n,i+1)},LS=(e,t,n,i,o)=>{let r=vt(e,n,i);if(!r)return n;let s=V(r,i),a=J(r)?Se(r,i):null,l=[r.id,s?.id,a?.id].filter(u=>!!u),d=n.findIndex(u=>l.includes(u.id)),c=n.findIndex(u=>u.id===t.id);if(c!==-1&&d!==-1&&c<d){let u=Array.from(n),m=u.splice(c,1)[0];u.splice(d,0,m),o.replaceAllElements(u)}return n},PE=(e,t,n,i,o,r)=>{let s=t[n],a=m=>m.isDeleted?!1:o?m.frameId===o:e.editingGroupId?m.groupIds.includes(e.editingGroupId):!0,l=i==="left"?xc(t,m=>a(m),Math.max(0,n-1)):gc(t,m=>a(m),n+1),d=t[l];if(!d)return-1;if(e.editingGroupId){if(s?.groupIds.join("")===d?.groupIds.join(""))return hc(d,t,i,r)??l;if(!d?.groupIds.includes(e.editingGroupId))return-1}if(!o&&(d.frameId||q(d))){let m=bE(t,d.frameId||d.id);return i==="left"?t.indexOf(m[0]):t.indexOf(m[m.length-1])}if(!d.groupIds.length)return hc(d,t,i,r)??l;let c=e.editingGroupId?d.groupIds[d.groupIds.indexOf(e.editingGroupId)-1]:d.groupIds[d.groupIds.length-1],u=ve(t,c);return u.length?i==="left"?t.indexOf(u[0]):t.indexOf(u[u.length-1]):l},yc=(e,t)=>t.reduce((n,i)=>{let o=e[i];return n.set(o.id,o),n},new Map),bc=(e,t,n,i)=>{let o=wc(e,t),r=yc(e,o),s=yE(o);n==="right"&&(s=s.reverse());let a=new Set(o.filter(l=>q(e[l])).map(l=>e[l].id));return s.forEach((l,d)=>{let c=l[0],u=l[l.length-1],m=n==="left"?c:u,p=l.some(w=>{let b=e[w];return b.frameId&&a.has(b.frameId)})?null:e[m]?.frameId,f=PE(t,e,m,n,p,i);if(f===-1||m===f)return;let E=n==="left"?e.slice(0,f):e.slice(0,c),h=e.slice(c,u+1),g=n==="left"?e.slice(f,c):e.slice(u+1,f+1),x=n==="left"?e.slice(u+1):e.slice(f+1);e=n==="left"?[...E,...h,...g,...x]:[...E,...g,...h,...x]}),Pi(e,r),e},Pc=(e,t,n,i,o)=>{let r=wc(e,t,o),s=yc(e,r),a=[],l,d;if(n==="left"){if(i)l=gc(e,f=>Os(f,i));else if(t.editingGroupId){let f=ve(e,t.editingGroupId);if(!f.length)return e;l=e.indexOf(f[0])}else l=0;d=r[r.length-1]}else{if(i)d=xc(e,f=>Os(f,i));else if(t.editingGroupId){let f=ve(e,t.editingGroupId);if(!f.length)return e;d=e.indexOf(f[f.length-1])}else d=e.length-1;l=r[0]}l===-1&&(l=0);for(let f=l;f<d+1;f++)r.includes(f)||a.push(e[f]);let c=Array.from(s.values()),u=e.slice(0,l),m=e.slice(d+1),p=n==="left"?[...u,...c,...a,...m]:[...u,...a,...c,...m];return Pi(p,s),p};function Ic(e,t,n,i){let o=Ec(mt(e,t,{includeBoundTextElement:!0,includeElementsInFrames:!0})),r={regularElements:[],frameChildren:new Map},s=new Set;for(let d of e)o.has(d.id)&&q(d)&&s.add(d.id);for(let d of e)if(o.has(d.id))if(q(d)||d.frameId&&s.has(d.frameId))r.regularElements.push(d);else if(!d.frameId)r.regularElements.push(d);else{let c=r.frameChildren.get(d.frameId)||[];c.push(d),r.frameChildren.set(d.frameId,c)}let a=e,l=Array.from(r.frameChildren.entries());for(let[d,c]of l)a=i(e,t,n,d,c);return i(a,t,n,null,r.regularElements)}var BS=(e,t,n)=>bc(e,t,"left",n),CS=(e,t,n)=>bc(e,t,"right",n),GS=(e,t)=>Ic(e,t,"left",Pc),OS=(e,t)=>Ic(e,t,"right",Pc);var HS=e=>e.reduce((t,n)=>t+n.version,0),yd=e=>{let t=5381;for(let n of IE(e))t=(t<<5)+t+n.versionNonce;return t>>>0},bd=e=>{let t=5381;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);t=(t<<5)+t+i}return t>>>0},zS=e=>e.filter(t=>!t.isDeleted&&!md(t)),_S=e=>e.filter(t=>!t.isDeleted),US=e=>!e.isDeleted;export{ln as AppStateDelta,tl as BASE_BINDING_GAP,Pn as BASE_BINDING_GAP_ELBOW,te as BASE_PADDING,tn as BindableElement,en as BoundElement,Re as CaptureUpdateAction,r0 as DEFAULT_LINK_SIZE,uc as DEFAULT_OMIT_SIDES,_ as Delta,ds as DurableIncrement,is as ElementBounds,dn as ElementsDelta,cs as EphemeralIncrement,nc as FlowChartCreator,tc as FlowChartNavigator,we as HEADING_DOWN,Ge as HEADING_LEFT,me as HEADING_RIGHT,_e as HEADING_UP,Qp as IMAGE_INVERT_FILTER,Tf as INVISIBLY_SMALL_ELEMENT_SIZE,ms as InvalidFractionalIndexError,R as LinearElementEditor,Pe as MINIMAL_CROP_SIZE,rS as OMIT_SIDES_FOR_FRAME,oS as OMIT_SIDES_FOR_MULTIPLE_ELEMENTS,Ro as Scene,Me as ShapeCache,Ed as Store,yi as StoreChange,us as StoreDelta,Co as StoreIncrement,cn as StoreSnapshot,$e as aabbForElement,Hp as addElementsToFrame,iE as addNewNodes,tb as addToGroup,c1 as alignElements,ol as avoidRectangularCorner,go as bindBindingElement,Rl as bindElementsToFramesAfterDuplication,nl as bindOrUnbindBindingElement,Py as bindOrUnbindBindingElements,po as bindPointToSnapToElementOutline,sl as bindingProperties,Ka as bumpVersion,sp as calculateFixedPointForElbowArrowBinding,xo as calculateFixedPointForNonElbowArrowBinding,vx as canApplyRoundnessTypeToElement,xa as canBecomePolygon,Kl as canChangeRoundness,Dh as canCreateLinkFromElements,E0 as canHaveArrowheads,Xo as canResizeFromSides,Bn as charWidth,ue as compareHeading,oi as computeBoundTextPosition,br as computeContainerDimensionForBoundText,nw as containsCJK,aI as createPlaceholderEmbeddableLabel,ws as createSrcDoc,wx as cropElement,Dn as deconstructDiamondElement,Vi as deconstructLinearOrFreeDrawElement,vn as deconstructRectanguloidElement,ls as deepCopyElement,GP as defaultGetElementLinkFromSelection,Zx as detectLineHeight,yn as distanceToElement,EP as distributeElements,bn as doBoundsIntersect,vP as dragNewElement,AP as dragSelectedElements,Ff as duplicateElement,S1 as duplicateElements,eb as editGroupForSelectedElement,fe as elementCenterPoint,on as elementOverlapsWithFrame,Do as elementWithCanvasCache,sn as elementsAreInFrameBounds,Bl as elementsAreInSameGroup,dI as embeddableURLValidator,Ol as excludeElementsInFramesFromSelection,Fb as filterElementsEligibleAsFrameChildren,Sy as fixBindingsAfterDeletion,rl as fixDuplicatedBindingsAfterDuplication,vr as flipHeading,Yb as frameAndChildrenSelectedTogether,ql as generateFreeDrawShape,Sa as generateLinearCollisionShape,ke as generateRoughOptions,no as getAllHoveredElementAtPoint,Da as getApproxMinLineHeight,va as getApproxMinLineWidth,al as getArrowLocalFixedPoints,bf as getArrowheadAngle,es as getArrowheadPoints,yf as getArrowheadSize,Lt as getBindingGap,_r as getBindingStrategyForDraggingBindingElementEndpoints,V as getBoundTextElement,Tt as getBoundTextElementId,fw as getBoundTextElementPosition,ri as getBoundTextMaxHeight,tt as getBoundTextMaxWidth,os as getBoundsFromPoints,ct as getCenterForBounds,$0 as getClosestElementBounds,Rt as getCommonBoundingBox,Ye as getCommonBounds,mw as getContainerCenter,Pr as getContainerCoords,Se as getContainerElement,Ot as getContainingFrame,It as getCornerRadius,io as getCubicBezierCurveBound,ES as getCursorForResizingElement,Xp as getDefaultFrameName,Dx as getDefaultRoundnessTypeForElement,Ln as getDiamondPoints,TP as getDragOffsetXY,V0 as getDraggedElementsBounds,W as getElementAbsoluteCoords,se as getElementBounds,Zr as getElementLineSegments,Yr as getElementPointsCoords,id as getElementShape,fS as getElementWithTransformHandleType,Fl as getElementsCompletelyInFrame,ve as getElementsInGroup,Rb as getElementsInNewFrame,kb as getElementsInResizingFrame,Db as getElementsIntersectingFrame,Ub as getElementsOverlappingFrame,Vr as getElementsWithinSelection,sI as getEmbedLink,yx as getFlipAdjustedCropPosition,rn as getFrameChildren,Fp as getFrameLikeElements,_b as getFrameLikeTitle,nf as getFreeDrawPath2D,of as getFreeDrawSvgPath,l0 as getFreedrawOutlineAsSegments,rf as getFreedrawOutlinePoints,Jt as getGlobalFixedPointForBindableElement,ap as getGlobalFixedPoints,qa as getHeadingForElbowArrowSnap,vt as getHoveredElementForBinding,LI as getInitializedImageElements,Ki as getLineHeightInPx,Vt as getLineWidth,Bx as getLinearElementSubType,II as getLinkDirectionFromKey,OP as getLinkIdAndTypeFromSelection,xl as getLockedLinearCursorAlignSize,Nu as getMaxCharWidth,ib as getMaximumGroups,Kx as getMinCharWidth,gi as getMinMaxXYFromCurvePathOps,qi as getMinTextElementWidth,Gl as getNewGroupIdsForDuplication,_S as getNonDeletedElements,Ll as getNonDeletedGroupIds,o1 as getNormalizedDimensions,zn as getObservedAppState,Ds as getOmitSidesForEditorInterface,Xx as getOriginalContainerHeightFromCache,rs as getPerfectElementSize,Is as getPredecessors,W0 as getRectangleBoxAbsoluteCoords,Jp as getRenderOpacity,KI as getResizeArrowDirection,qI as getResizeOffsetXY,Xt as getResizedElementAbsoluteCoords,Ob as getRootElements,HS as getSceneVersion,mt as getSelectedElements,Io as getSelectedElementsByGroup,Wr as getSelectedGroupForElement,Cp as getSelectedGroupIdForElement,Lp as getSelectedGroupIds,Eb as getSelectionStateForElements,hb as getTargetElements,_p as getTargetFrame,pw as getTextElementAngle,xw as getTextFromElements,Fu as getTextHeight,La as getTextWidth,hS as getTransformHandleTypeFromCoords,mc as getTransformHandles,Ls as getTransformHandlesFromCoords,ma as getUncroppedImageElement,rr as getUncroppedWidthAndHeight,pb as getVisibleAndNonSelectedElements,zS as getVisibleElements,Z0 as getVisibleSceneBounds,Gb as groupByFrameLikes,Bb as groupsAreAtLeastIntersectingTheFrame,Cb as groupsAreCompletelyOutOfFrame,wn as handleBindTextResize,u0 as hasBackground,lt as hasBoundTextElement,sS as hasBoundingBox,m0 as hasStrokeColor,f0 as hasStrokeStyle,p0 as hasStrokeWidth,yd as hashElementsVersion,bd as hashString,Ce as headingForPoint,ai as headingForPointFromElement,nt as headingForPointIsHorizontal,Oe as headingIsHorizontal,Yw as headingIsVertical,ym as hitElementBoundText,wm as hitElementBoundingBox,Fw as hitElementBoundingBoxOnly,xm as hitElementItself,$t as intersectElementWithLineSegment,Tx as isArrowBoundToElement,H as isArrowElement,He as isBindableElement,Ar as isBindableElementInsideOtherBindable,Le as isBindingElement,Pu as isBindingElementType,fi as isBindingEnabled,le as isBoundToContainer,Lx as isBounds,Lb as isCursorInFrame,yu as isCurvedArrow,X as isElbowArrow,i1 as isElementCompletelyInViewport,qr as isElementContainingFrame,Hl as isElementInFrame,Bp as isElementInGroup,kl as isElementInViewport,Nn as isElementIntersectingFrame,kP as isElementLink,fa as isEmbeddableElement,Ax as isExcalidrawElement,lr as isFlowchartNodeElement,Wi as isFrameElement,q as isFrameLikeElement,Ie as isFreeDrawElement,xu as isFreeDrawElementType,sE as isHTMLSVGElement,Xi as isIframeElement,ji as isIframeLikeElement,xe as isImageElement,Cl as isInGroup,jt as isInitializedImageElement,md as isInvisiblySmallElement,bt as isLineElement,K as isLinearElement,bu as isLinearElementType,ha as isMagicFrameElement,$x as isMeasureTextSupported,SI as isNodeInFlowchart,US as isNonDeletedElement,gn as isPathALoop,St as isPointInElement,ar as isRectangularElement,sr as isRectanguloidElement,Dp as isSelectedViaGroup,wu as isSharpArrow,Mx as isSimpleArrow,fb as isSomeElementSelected,Iu as isTextBindableContainer,J as isTextElement,Ea as isUsingAdaptiveRadius,ga as isUsingProportionalRadius,Cx as isValidPolygon,gw as isValidTextContainer,rE as loadHTMLImageElement,jr as makeNextSelectedElementIds,ci as maxBindingDistance_simple,lI as maybeParseEmbedSrc,As as measureFontSizeFromWidth,et as measureText,GS as moveAllLeft,OS as moveAllRight,LS as moveArrowAboveBindable,BS as moveOneLeft,CS as moveOneRight,ye as mutateElement,$d as newArrowElement,gs as newElement,ge as newElementWith,WP as newEmbeddableElement,$P as newFrameElement,KP as newFreeDrawElement,VP as newIframeElement,JP as newImageElement,QP as newLinearElement,ZP as newMagicFrameElement,Vd as newTextElement,pd as normalizeElementOrder,wo as normalizeFixedPoint,BI as normalizeSVG,Er as normalizeText,So as omitGroupsContainingFrameLikes,Np as omitPartialGroups,vd as orderByFractionalIndex,ii as originalContainerCache,RP as parseElementLinkFromURL,ju as parseTokens,Zl as pathsCache,Zt as pointInsideBounds,RI as positionElementsOnGrid,fr as projectFixedPointOntoDiagonal,Oa as redrawTextBoundingBox,qP as refreshTextDimensions,zp as removeAllElementsFromFrame,Nl as removeElementsFromFrame,nb as removeFromSelectedGroups,a0 as renderElement,s0 as renderSelectionElement,Nb as replaceAllElementsInFrame,ac as rescalePointsInElement,Aa as resetOriginalContainerCache,hE as resizeMultipleElements,mE as resizeSingleElement,dE as resizeSingleTextElement,xE as resizeTest,vp as selectGroup,vl as selectGroupsForSelectedElements,Dl as selectGroupsFromGivenElements,qx as setCustomTextMetricsProvider,hw as shouldAllowVerticalAlign,zb as shouldApplyFrameClip,by as shouldEnableBindingForPointerEvent,to as shouldTestInside,yS as showSelectedShapeActions,Ew as suppportsHorizontalAlign,Vf as syncInvalidIndices,wd as syncInvalidIndicesImmutable,Pi as syncMovedIndices,gl as toggleLinePolygonState,h0 as toolIsArrow,ZI as transformElements,Ze as unbindBindingElement,Iy as updateBindings,Ue as updateBoundElements,Fn as updateBoundPoint,Gn as updateElbowArrowPoints,Hb as updateFrameMembershipOfSelectedElements,DI as updateImageCache,Ma as updateOriginalContainerCache,Za as validateElbowPoints,Wf as validateFractionalIndices,Dt as vectorToHeading,At as wrapText};
